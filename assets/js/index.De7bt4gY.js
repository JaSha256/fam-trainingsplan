const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/js/virtual_pwa-register.CoWl0VS2.js","assets/js/vendor-alpine.D9MLegQT.js","assets/js/vendor-map.zdHhRoWp.js","assets/js/vendor-utils.Dw8P0qyA.js"])))=>i.map(i=>d[i]);
import{m as w,a as pe,b as fe,c as me,d as ge}from"./vendor-alpine.D9MLegQT.js";import{r as _e,g as ve}from"./vendor-map.zdHhRoWp.js";import{F as ye}from"./vendor-utils.Dw8P0qyA.js";function we(r,t){for(var i=0;i<t.length;i++){const o=t[i];if(typeof o!="string"&&!Array.isArray(o)){for(const s in o)if(s!=="default"&&!(s in r)){const e=Object.getOwnPropertyDescriptor(o,s);e&&Object.defineProperty(r,s,e.get?e:{enumerable:!0,get:()=>o[s]})}}}return Object.freeze(Object.defineProperty(r,Symbol.toStringTag,{value:"Module"}))}(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))o(s);new MutationObserver(s=>{for(const e of s)if(e.type==="childList")for(const n of e.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&o(n)}).observe(document,{childList:!0,subtree:!0});function i(s){const e={};return s.integrity&&(e.integrity=s.integrity),s.referrerPolicy&&(e.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?e.credentials="include":s.crossOrigin==="anonymous"?e.credentials="omit":e.credentials="same-origin",e}function o(s){if(s.ep)return;s.ep=!0;const e=i(s);fetch(s.href,e)}})();const Le="modulepreload",be=function(r){return"/fam-trainingsplan/"+r},X={},Ce=function(t,i,o){let s=Promise.resolve();if(i&&i.length>0){let l=function(c){return Promise.all(c.map(d=>Promise.resolve(d).then(u=>({status:"fulfilled",value:u}),u=>({status:"rejected",reason:u}))))};document.getElementsByTagName("link");const n=document.querySelector("meta[property=csp-nonce]"),a=n?.nonce||n?.getAttribute("nonce");s=l(i.map(c=>{if(c=be(c),c in X)return;X[c]=!0;const d=c.endsWith(".css"),u=d?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${c}"]${u}`))return;const p=document.createElement("link");if(p.rel=d?"stylesheet":Le,d||(p.as="script"),p.crossOrigin="",p.href=c,a&&p.setAttribute("nonce",a),document.head.appendChild(p),d)return new Promise((f,_)=>{p.addEventListener("load",f),p.addEventListener("error",()=>_(new Error(`Unable to preload CSS for ${c}`)))})}))}function e(n){const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=n,window.dispatchEvent(a),!a.defaultPrevented)throw n}return s.then(n=>{for(const a of n||[])a.status==="rejected"&&e(a.reason);return t().catch(e)})};var v=_e();const xe=ve(v),ke=we({__proto__:null,default:xe},[v]);var P={exports:{}},Me=P.exports,J;function Te(){return J||(J=1,(function(r,t){(function(i,o){o(t)})(Me,function(i){var o=L.MarkerClusterGroup=L.FeatureGroup.extend({options:{maxClusterRadius:80,iconCreateFunction:null,clusterPane:L.Marker.prototype.options.pane,spiderfyOnEveryZoom:!1,spiderfyOnMaxZoom:!0,showCoverageOnHover:!0,zoomToBoundsOnClick:!0,singleMarkerMode:!1,disableClusteringAtZoom:null,removeOutsideVisibleBounds:!0,animate:!0,animateAddingMarkers:!1,spiderfyShapePositions:null,spiderfyDistanceMultiplier:1,spiderLegPolylineOptions:{weight:1.5,color:"#222",opacity:.5},chunkedLoading:!1,chunkInterval:200,chunkDelay:50,chunkProgress:null,polygonOptions:{}},initialize:function(e){L.Util.setOptions(this,e),this.options.iconCreateFunction||(this.options.iconCreateFunction=this._defaultIconCreateFunction),this._featureGroup=L.featureGroup(),this._featureGroup.addEventParent(this),this._nonPointGroup=L.featureGroup(),this._nonPointGroup.addEventParent(this),this._inZoomAnimation=0,this._needsClustering=[],this._needsRemoving=[],this._currentShownBounds=null,this._queue=[],this._childMarkerEventHandlers={dragstart:this._childMarkerDragStart,move:this._childMarkerMoved,dragend:this._childMarkerDragEnd};var n=L.DomUtil.TRANSITION&&this.options.animate;L.extend(this,n?this._withAnimation:this._noAnimation),this._markerCluster=n?L.MarkerCluster:L.MarkerClusterNonAnimated},addLayer:function(e){if(e instanceof L.LayerGroup)return this.addLayers([e]);if(!e.getLatLng)return this._nonPointGroup.addLayer(e),this.fire("layeradd",{layer:e}),this;if(!this._map)return this._needsClustering.push(e),this.fire("layeradd",{layer:e}),this;if(this.hasLayer(e))return this;this._unspiderfy&&this._unspiderfy(),this._addLayer(e,this._maxZoom),this.fire("layeradd",{layer:e}),this._topClusterLevel._recalculateBounds(),this._refreshClustersIcons();var n=e,a=this._zoom;if(e.__parent)for(;n.__parent._zoom>=a;)n=n.__parent;return this._currentShownBounds.contains(n.getLatLng())&&(this.options.animateAddingMarkers?this._animationAddLayer(e,n):this._animationAddLayerNonAnimated(e,n)),this},removeLayer:function(e){return e instanceof L.LayerGroup?this.removeLayers([e]):e.getLatLng?this._map?e.__parent?(this._unspiderfy&&(this._unspiderfy(),this._unspiderfyLayer(e)),this._removeLayer(e,!0),this.fire("layerremove",{layer:e}),this._topClusterLevel._recalculateBounds(),this._refreshClustersIcons(),e.off(this._childMarkerEventHandlers,this),this._featureGroup.hasLayer(e)&&(this._featureGroup.removeLayer(e),e.clusterShow&&e.clusterShow()),this):this:(!this._arraySplice(this._needsClustering,e)&&this.hasLayer(e)&&this._needsRemoving.push({layer:e,latlng:e._latlng}),this.fire("layerremove",{layer:e}),this):(this._nonPointGroup.removeLayer(e),this.fire("layerremove",{layer:e}),this)},addLayers:function(e,n){if(!L.Util.isArray(e))return this.addLayer(e);var a=this._featureGroup,l=this._nonPointGroup,c=this.options.chunkedLoading,d=this.options.chunkInterval,u=this.options.chunkProgress,p=e.length,f=0,_=!0,m;if(this._map){var b=new Date().getTime(),y=L.bind(function(){var x=new Date().getTime();for(this._map&&this._unspiderfy&&this._unspiderfy();f<p;f++){if(c&&f%200===0){var A=new Date().getTime()-x;if(A>d)break}if(m=e[f],m instanceof L.LayerGroup){_&&(e=e.slice(),_=!1),this._extractNonGroupLayers(m,e),p=e.length;continue}if(!m.getLatLng){l.addLayer(m),n||this.fire("layeradd",{layer:m});continue}if(!this.hasLayer(m)&&(this._addLayer(m,this._maxZoom),n||this.fire("layeradd",{layer:m}),m.__parent&&m.__parent.getChildCount()===2)){var S=m.__parent.getAllChildMarkers(),he=S[0]===m?S[1]:S[0];a.removeLayer(he)}}u&&u(f,p,new Date().getTime()-b),f===p?(this._topClusterLevel._recalculateBounds(),this._refreshClustersIcons(),this._topClusterLevel._recursivelyAddChildrenToMap(null,this._zoom,this._currentShownBounds)):setTimeout(y,this.options.chunkDelay)},this);y()}else for(var M=this._needsClustering;f<p;f++){if(m=e[f],m instanceof L.LayerGroup){_&&(e=e.slice(),_=!1),this._extractNonGroupLayers(m,e),p=e.length;continue}if(!m.getLatLng){l.addLayer(m);continue}this.hasLayer(m)||M.push(m)}return this},removeLayers:function(e){var n,a,l=e.length,c=this._featureGroup,d=this._nonPointGroup,u=!0;if(!this._map){for(n=0;n<l;n++){if(a=e[n],a instanceof L.LayerGroup){u&&(e=e.slice(),u=!1),this._extractNonGroupLayers(a,e),l=e.length;continue}this._arraySplice(this._needsClustering,a),d.removeLayer(a),this.hasLayer(a)&&this._needsRemoving.push({layer:a,latlng:a._latlng}),this.fire("layerremove",{layer:a})}return this}if(this._unspiderfy){this._unspiderfy();var p=e.slice(),f=l;for(n=0;n<f;n++){if(a=p[n],a instanceof L.LayerGroup){this._extractNonGroupLayers(a,p),f=p.length;continue}this._unspiderfyLayer(a)}}for(n=0;n<l;n++){if(a=e[n],a instanceof L.LayerGroup){u&&(e=e.slice(),u=!1),this._extractNonGroupLayers(a,e),l=e.length;continue}if(!a.__parent){d.removeLayer(a),this.fire("layerremove",{layer:a});continue}this._removeLayer(a,!0,!0),this.fire("layerremove",{layer:a}),c.hasLayer(a)&&(c.removeLayer(a),a.clusterShow&&a.clusterShow())}return this._topClusterLevel._recalculateBounds(),this._refreshClustersIcons(),this._topClusterLevel._recursivelyAddChildrenToMap(null,this._zoom,this._currentShownBounds),this},clearLayers:function(){return this._map||(this._needsClustering=[],this._needsRemoving=[],delete this._gridClusters,delete this._gridUnclustered),this._noanimationUnspiderfy&&this._noanimationUnspiderfy(),this._featureGroup.clearLayers(),this._nonPointGroup.clearLayers(),this.eachLayer(function(e){e.off(this._childMarkerEventHandlers,this),delete e.__parent},this),this._map&&this._generateInitialClusters(),this},getBounds:function(){var e=new L.LatLngBounds;this._topClusterLevel&&e.extend(this._topClusterLevel._bounds);for(var n=this._needsClustering.length-1;n>=0;n--)e.extend(this._needsClustering[n].getLatLng());return e.extend(this._nonPointGroup.getBounds()),e},eachLayer:function(e,n){var a=this._needsClustering.slice(),l=this._needsRemoving,c,d,u;for(this._topClusterLevel&&this._topClusterLevel.getAllChildMarkers(a),d=a.length-1;d>=0;d--){for(c=!0,u=l.length-1;u>=0;u--)if(l[u].layer===a[d]){c=!1;break}c&&e.call(n,a[d])}this._nonPointGroup.eachLayer(e,n)},getLayers:function(){var e=[];return this.eachLayer(function(n){e.push(n)}),e},getLayer:function(e){var n=null;return e=parseInt(e,10),this.eachLayer(function(a){L.stamp(a)===e&&(n=a)}),n},hasLayer:function(e){if(!e)return!1;var n,a=this._needsClustering;for(n=a.length-1;n>=0;n--)if(a[n]===e)return!0;for(a=this._needsRemoving,n=a.length-1;n>=0;n--)if(a[n].layer===e)return!1;return!!(e.__parent&&e.__parent._group===this)||this._nonPointGroup.hasLayer(e)},zoomToShowLayer:function(e,n){var a=this._map;typeof n!="function"&&(n=function(){});var l=function(){(a.hasLayer(e)||a.hasLayer(e.__parent))&&!this._inZoomAnimation&&(this._map.off("moveend",l,this),this.off("animationend",l,this),a.hasLayer(e)?n():e.__parent._icon&&(this.once("spiderfied",n,this),e.__parent.spiderfy()))};e._icon&&this._map.getBounds().contains(e.getLatLng())?n():e.__parent._zoom<Math.round(this._map._zoom)?(this._map.on("moveend",l,this),this._map.panTo(e.getLatLng())):(this._map.on("moveend",l,this),this.on("animationend",l,this),e.__parent.zoomToBounds())},onAdd:function(e){this._map=e;var n,a,l;if(!isFinite(this._map.getMaxZoom()))throw"Map has no maxZoom specified";for(this._featureGroup.addTo(e),this._nonPointGroup.addTo(e),this._gridClusters||this._generateInitialClusters(),this._maxLat=e.options.crs.projection.MAX_LATITUDE,n=0,a=this._needsRemoving.length;n<a;n++)l=this._needsRemoving[n],l.newlatlng=l.layer._latlng,l.layer._latlng=l.latlng;for(n=0,a=this._needsRemoving.length;n<a;n++)l=this._needsRemoving[n],this._removeLayer(l.layer,!0),l.layer._latlng=l.newlatlng;this._needsRemoving=[],this._zoom=Math.round(this._map._zoom),this._currentShownBounds=this._getExpandedVisibleBounds(),this._map.on("zoomend",this._zoomEnd,this),this._map.on("moveend",this._moveEnd,this),this._spiderfierOnAdd&&this._spiderfierOnAdd(),this._bindEvents(),a=this._needsClustering,this._needsClustering=[],this.addLayers(a,!0)},onRemove:function(e){e.off("zoomend",this._zoomEnd,this),e.off("moveend",this._moveEnd,this),this._unbindEvents(),this._map._mapPane.className=this._map._mapPane.className.replace(" leaflet-cluster-anim",""),this._spiderfierOnRemove&&this._spiderfierOnRemove(),delete this._maxLat,this._hideCoverage(),this._featureGroup.remove(),this._nonPointGroup.remove(),this._featureGroup.clearLayers(),this._map=null},getVisibleParent:function(e){for(var n=e;n&&!n._icon;)n=n.__parent;return n||null},_arraySplice:function(e,n){for(var a=e.length-1;a>=0;a--)if(e[a]===n)return e.splice(a,1),!0},_removeFromGridUnclustered:function(e,n){for(var a=this._map,l=this._gridUnclustered,c=Math.floor(this._map.getMinZoom());n>=c&&l[n].removeObject(e,a.project(e.getLatLng(),n));n--);},_childMarkerDragStart:function(e){e.target.__dragStart=e.target._latlng},_childMarkerMoved:function(e){if(!this._ignoreMove&&!e.target.__dragStart){var n=e.target._popup&&e.target._popup.isOpen();this._moveChild(e.target,e.oldLatLng,e.latlng),n&&e.target.openPopup()}},_moveChild:function(e,n,a){e._latlng=n,this.removeLayer(e),e._latlng=a,this.addLayer(e)},_childMarkerDragEnd:function(e){var n=e.target.__dragStart;delete e.target.__dragStart,n&&this._moveChild(e.target,n,e.target._latlng)},_removeLayer:function(e,n,a){var l=this._gridClusters,c=this._gridUnclustered,d=this._featureGroup,u=this._map,p=Math.floor(this._map.getMinZoom());n&&this._removeFromGridUnclustered(e,this._maxZoom);var f=e.__parent,_=f._markers,m;for(this._arraySplice(_,e);f&&(f._childCount--,f._boundsNeedUpdate=!0,!(f._zoom<p));)n&&f._childCount<=1?(m=f._markers[0]===e?f._markers[1]:f._markers[0],l[f._zoom].removeObject(f,u.project(f._cLatLng,f._zoom)),c[f._zoom].addObject(m,u.project(m.getLatLng(),f._zoom)),this._arraySplice(f.__parent._childClusters,f),f.__parent._markers.push(m),m.__parent=f.__parent,f._icon&&(d.removeLayer(f),a||d.addLayer(m))):f._iconNeedsUpdate=!0,f=f.__parent;delete e.__parent},_isOrIsParent:function(e,n){for(;n;){if(e===n)return!0;n=n.parentNode}return!1},fire:function(e,n,a){if(n&&n.layer instanceof L.MarkerCluster){if(n.originalEvent&&this._isOrIsParent(n.layer._icon,n.originalEvent.relatedTarget))return;e="cluster"+e}L.FeatureGroup.prototype.fire.call(this,e,n,a)},listens:function(e,n){return L.FeatureGroup.prototype.listens.call(this,e,n)||L.FeatureGroup.prototype.listens.call(this,"cluster"+e,n)},_defaultIconCreateFunction:function(e){var n=e.getChildCount(),a=" marker-cluster-";return n<10?a+="small":n<100?a+="medium":a+="large",new L.DivIcon({html:"<div><span>"+n+"</span></div>",className:"marker-cluster"+a,iconSize:new L.Point(40,40)})},_bindEvents:function(){var e=this._map,n=this.options.spiderfyOnMaxZoom,a=this.options.showCoverageOnHover,l=this.options.zoomToBoundsOnClick,c=this.options.spiderfyOnEveryZoom;(n||l||c)&&this.on("clusterclick clusterkeypress",this._zoomOrSpiderfy,this),a&&(this.on("clustermouseover",this._showCoverage,this),this.on("clustermouseout",this._hideCoverage,this),e.on("zoomend",this._hideCoverage,this))},_zoomOrSpiderfy:function(e){var n=e.layer,a=n;if(!(e.type==="clusterkeypress"&&e.originalEvent&&e.originalEvent.keyCode!==13)){for(;a._childClusters.length===1;)a=a._childClusters[0];a._zoom===this._maxZoom&&a._childCount===n._childCount&&this.options.spiderfyOnMaxZoom?n.spiderfy():this.options.zoomToBoundsOnClick&&n.zoomToBounds(),this.options.spiderfyOnEveryZoom&&n.spiderfy(),e.originalEvent&&e.originalEvent.keyCode===13&&this._map._container.focus()}},_showCoverage:function(e){var n=this._map;this._inZoomAnimation||(this._shownPolygon&&n.removeLayer(this._shownPolygon),e.layer.getChildCount()>2&&e.layer!==this._spiderfied&&(this._shownPolygon=new L.Polygon(e.layer.getConvexHull(),this.options.polygonOptions),n.addLayer(this._shownPolygon)))},_hideCoverage:function(){this._shownPolygon&&(this._map.removeLayer(this._shownPolygon),this._shownPolygon=null)},_unbindEvents:function(){var e=this.options.spiderfyOnMaxZoom,n=this.options.showCoverageOnHover,a=this.options.zoomToBoundsOnClick,l=this.options.spiderfyOnEveryZoom,c=this._map;(e||a||l)&&this.off("clusterclick clusterkeypress",this._zoomOrSpiderfy,this),n&&(this.off("clustermouseover",this._showCoverage,this),this.off("clustermouseout",this._hideCoverage,this),c.off("zoomend",this._hideCoverage,this))},_zoomEnd:function(){this._map&&(this._mergeSplitClusters(),this._zoom=Math.round(this._map._zoom),this._currentShownBounds=this._getExpandedVisibleBounds())},_moveEnd:function(){if(!this._inZoomAnimation){var e=this._getExpandedVisibleBounds();this._topClusterLevel._recursivelyRemoveChildrenFromMap(this._currentShownBounds,Math.floor(this._map.getMinZoom()),this._zoom,e),this._topClusterLevel._recursivelyAddChildrenToMap(null,Math.round(this._map._zoom),e),this._currentShownBounds=e}},_generateInitialClusters:function(){var e=Math.ceil(this._map.getMaxZoom()),n=Math.floor(this._map.getMinZoom()),a=this.options.maxClusterRadius,l=a;typeof a!="function"&&(l=function(){return a}),this.options.disableClusteringAtZoom!==null&&(e=this.options.disableClusteringAtZoom-1),this._maxZoom=e,this._gridClusters={},this._gridUnclustered={};for(var c=e;c>=n;c--)this._gridClusters[c]=new L.DistanceGrid(l(c)),this._gridUnclustered[c]=new L.DistanceGrid(l(c));this._topClusterLevel=new this._markerCluster(this,n-1)},_addLayer:function(e,n){var a=this._gridClusters,l=this._gridUnclustered,c=Math.floor(this._map.getMinZoom()),d,u;for(this.options.singleMarkerMode&&this._overrideMarkerIcon(e),e.on(this._childMarkerEventHandlers,this);n>=c;n--){d=this._map.project(e.getLatLng(),n);var p=a[n].getNearObject(d);if(p){p._addChild(e),e.__parent=p;return}if(p=l[n].getNearObject(d),p){var f=p.__parent;f&&this._removeLayer(p,!1);var _=new this._markerCluster(this,n,p,e);a[n].addObject(_,this._map.project(_._cLatLng,n)),p.__parent=_,e.__parent=_;var m=_;for(u=n-1;u>f._zoom;u--)m=new this._markerCluster(this,u,m),a[u].addObject(m,this._map.project(p.getLatLng(),u));f._addChild(m),this._removeFromGridUnclustered(p,n);return}l[n].addObject(e,d)}this._topClusterLevel._addChild(e),e.__parent=this._topClusterLevel},_refreshClustersIcons:function(){this._featureGroup.eachLayer(function(e){e instanceof L.MarkerCluster&&e._iconNeedsUpdate&&e._updateIcon()})},_enqueue:function(e){this._queue.push(e),this._queueTimeout||(this._queueTimeout=setTimeout(L.bind(this._processQueue,this),300))},_processQueue:function(){for(var e=0;e<this._queue.length;e++)this._queue[e].call(this);this._queue.length=0,clearTimeout(this._queueTimeout),this._queueTimeout=null},_mergeSplitClusters:function(){var e=Math.round(this._map._zoom);this._processQueue(),this._zoom<e&&this._currentShownBounds.intersects(this._getExpandedVisibleBounds())?(this._animationStart(),this._topClusterLevel._recursivelyRemoveChildrenFromMap(this._currentShownBounds,Math.floor(this._map.getMinZoom()),this._zoom,this._getExpandedVisibleBounds()),this._animationZoomIn(this._zoom,e)):this._zoom>e?(this._animationStart(),this._animationZoomOut(this._zoom,e)):this._moveEnd()},_getExpandedVisibleBounds:function(){if(this.options.removeOutsideVisibleBounds){if(L.Browser.mobile)return this._checkBoundsMaxLat(this._map.getBounds())}else return this._mapBoundsInfinite;return this._checkBoundsMaxLat(this._map.getBounds().pad(1))},_checkBoundsMaxLat:function(e){var n=this._maxLat;return n!==void 0&&(e.getNorth()>=n&&(e._northEast.lat=1/0),e.getSouth()<=-n&&(e._southWest.lat=-1/0)),e},_animationAddLayerNonAnimated:function(e,n){if(n===e)this._featureGroup.addLayer(e);else if(n._childCount===2){n._addToMap();var a=n.getAllChildMarkers();this._featureGroup.removeLayer(a[0]),this._featureGroup.removeLayer(a[1])}else n._updateIcon()},_extractNonGroupLayers:function(e,n){var a=e.getLayers(),l=0,c;for(n=n||[];l<a.length;l++){if(c=a[l],c instanceof L.LayerGroup){this._extractNonGroupLayers(c,n);continue}n.push(c)}return n},_overrideMarkerIcon:function(e){var n=e.options.icon=this.options.iconCreateFunction({getChildCount:function(){return 1},getAllChildMarkers:function(){return[e]}});return n}});L.MarkerClusterGroup.include({_mapBoundsInfinite:new L.LatLngBounds(new L.LatLng(-1/0,-1/0),new L.LatLng(1/0,1/0))}),L.MarkerClusterGroup.include({_noAnimation:{_animationStart:function(){},_animationZoomIn:function(e,n){this._topClusterLevel._recursivelyRemoveChildrenFromMap(this._currentShownBounds,Math.floor(this._map.getMinZoom()),e),this._topClusterLevel._recursivelyAddChildrenToMap(null,n,this._getExpandedVisibleBounds()),this.fire("animationend")},_animationZoomOut:function(e,n){this._topClusterLevel._recursivelyRemoveChildrenFromMap(this._currentShownBounds,Math.floor(this._map.getMinZoom()),e),this._topClusterLevel._recursivelyAddChildrenToMap(null,n,this._getExpandedVisibleBounds()),this.fire("animationend")},_animationAddLayer:function(e,n){this._animationAddLayerNonAnimated(e,n)}},_withAnimation:{_animationStart:function(){this._map._mapPane.className+=" leaflet-cluster-anim",this._inZoomAnimation++},_animationZoomIn:function(e,n){var a=this._getExpandedVisibleBounds(),l=this._featureGroup,c=Math.floor(this._map.getMinZoom()),d;this._ignoreMove=!0,this._topClusterLevel._recursively(a,e,c,function(u){var p=u._latlng,f=u._markers,_;for(a.contains(p)||(p=null),u._isSingleParent()&&e+1===n?(l.removeLayer(u),u._recursivelyAddChildrenToMap(null,n,a)):(u.clusterHide(),u._recursivelyAddChildrenToMap(p,n,a)),d=f.length-1;d>=0;d--)_=f[d],a.contains(_._latlng)||l.removeLayer(_)}),this._forceLayout(),this._topClusterLevel._recursivelyBecomeVisible(a,n),l.eachLayer(function(u){!(u instanceof L.MarkerCluster)&&u._icon&&u.clusterShow()}),this._topClusterLevel._recursively(a,e,n,function(u){u._recursivelyRestoreChildPositions(n)}),this._ignoreMove=!1,this._enqueue(function(){this._topClusterLevel._recursively(a,e,c,function(u){l.removeLayer(u),u.clusterShow()}),this._animationEnd()})},_animationZoomOut:function(e,n){this._animationZoomOutSingle(this._topClusterLevel,e-1,n),this._topClusterLevel._recursivelyAddChildrenToMap(null,n,this._getExpandedVisibleBounds()),this._topClusterLevel._recursivelyRemoveChildrenFromMap(this._currentShownBounds,Math.floor(this._map.getMinZoom()),e,this._getExpandedVisibleBounds())},_animationAddLayer:function(e,n){var a=this,l=this._featureGroup;l.addLayer(e),n!==e&&(n._childCount>2?(n._updateIcon(),this._forceLayout(),this._animationStart(),e._setPos(this._map.latLngToLayerPoint(n.getLatLng())),e.clusterHide(),this._enqueue(function(){l.removeLayer(e),e.clusterShow(),a._animationEnd()})):(this._forceLayout(),a._animationStart(),a._animationZoomOutSingle(n,this._map.getMaxZoom(),this._zoom)))}},_animationZoomOutSingle:function(e,n,a){var l=this._getExpandedVisibleBounds(),c=Math.floor(this._map.getMinZoom());e._recursivelyAnimateChildrenInAndAddSelfToMap(l,c,n+1,a);var d=this;this._forceLayout(),e._recursivelyBecomeVisible(l,a),this._enqueue(function(){if(e._childCount===1){var u=e._markers[0];this._ignoreMove=!0,u.setLatLng(u.getLatLng()),this._ignoreMove=!1,u.clusterShow&&u.clusterShow()}else e._recursively(l,a,c,function(p){p._recursivelyRemoveChildrenFromMap(l,c,n+1)});d._animationEnd()})},_animationEnd:function(){this._map&&(this._map._mapPane.className=this._map._mapPane.className.replace(" leaflet-cluster-anim","")),this._inZoomAnimation--,this.fire("animationend")},_forceLayout:function(){L.Util.falseFn(document.body.offsetWidth)}}),L.markerClusterGroup=function(e){return new L.MarkerClusterGroup(e)};var s=L.MarkerCluster=L.Marker.extend({options:L.Icon.prototype.options,initialize:function(e,n,a,l){L.Marker.prototype.initialize.call(this,a?a._cLatLng||a.getLatLng():new L.LatLng(0,0),{icon:this,pane:e.options.clusterPane}),this._group=e,this._zoom=n,this._markers=[],this._childClusters=[],this._childCount=0,this._iconNeedsUpdate=!0,this._boundsNeedUpdate=!0,this._bounds=new L.LatLngBounds,a&&this._addChild(a),l&&this._addChild(l)},getAllChildMarkers:function(e,n){e=e||[];for(var a=this._childClusters.length-1;a>=0;a--)this._childClusters[a].getAllChildMarkers(e,n);for(var l=this._markers.length-1;l>=0;l--)n&&this._markers[l].__dragStart||e.push(this._markers[l]);return e},getChildCount:function(){return this._childCount},zoomToBounds:function(e){for(var n=this._childClusters.slice(),a=this._group._map,l=a.getBoundsZoom(this._bounds),c=this._zoom+1,d=a.getZoom(),u;n.length>0&&l>c;){c++;var p=[];for(u=0;u<n.length;u++)p=p.concat(n[u]._childClusters);n=p}l>c?this._group._map.setView(this._latlng,c):l<=d?this._group._map.setView(this._latlng,d+1):this._group._map.fitBounds(this._bounds,e)},getBounds:function(){var e=new L.LatLngBounds;return e.extend(this._bounds),e},_updateIcon:function(){this._iconNeedsUpdate=!0,this._icon&&this.setIcon(this)},createIcon:function(){return this._iconNeedsUpdate&&(this._iconObj=this._group.options.iconCreateFunction(this),this._iconNeedsUpdate=!1),this._iconObj.createIcon()},createShadow:function(){return this._iconObj.createShadow()},_addChild:function(e,n){this._iconNeedsUpdate=!0,this._boundsNeedUpdate=!0,this._setClusterCenter(e),e instanceof L.MarkerCluster?(n||(this._childClusters.push(e),e.__parent=this),this._childCount+=e._childCount):(n||this._markers.push(e),this._childCount++),this.__parent&&this.__parent._addChild(e,!0)},_setClusterCenter:function(e){this._cLatLng||(this._cLatLng=e._cLatLng||e._latlng)},_resetBounds:function(){var e=this._bounds;e._southWest&&(e._southWest.lat=1/0,e._southWest.lng=1/0),e._northEast&&(e._northEast.lat=-1/0,e._northEast.lng=-1/0)},_recalculateBounds:function(){var e=this._markers,n=this._childClusters,a=0,l=0,c=this._childCount,d,u,p,f;if(c!==0){for(this._resetBounds(),d=0;d<e.length;d++)p=e[d]._latlng,this._bounds.extend(p),a+=p.lat,l+=p.lng;for(d=0;d<n.length;d++)u=n[d],u._boundsNeedUpdate&&u._recalculateBounds(),this._bounds.extend(u._bounds),p=u._wLatLng,f=u._childCount,a+=p.lat*f,l+=p.lng*f;this._latlng=this._wLatLng=new L.LatLng(a/c,l/c),this._boundsNeedUpdate=!1}},_addToMap:function(e){e&&(this._backupLatlng=this._latlng,this.setLatLng(e)),this._group._featureGroup.addLayer(this)},_recursivelyAnimateChildrenIn:function(e,n,a){this._recursively(e,this._group._map.getMinZoom(),a-1,function(l){var c=l._markers,d,u;for(d=c.length-1;d>=0;d--)u=c[d],u._icon&&(u._setPos(n),u.clusterHide())},function(l){var c=l._childClusters,d,u;for(d=c.length-1;d>=0;d--)u=c[d],u._icon&&(u._setPos(n),u.clusterHide())})},_recursivelyAnimateChildrenInAndAddSelfToMap:function(e,n,a,l){this._recursively(e,l,n,function(c){c._recursivelyAnimateChildrenIn(e,c._group._map.latLngToLayerPoint(c.getLatLng()).round(),a),c._isSingleParent()&&a-1===l?(c.clusterShow(),c._recursivelyRemoveChildrenFromMap(e,n,a)):c.clusterHide(),c._addToMap()})},_recursivelyBecomeVisible:function(e,n){this._recursively(e,this._group._map.getMinZoom(),n,null,function(a){a.clusterShow()})},_recursivelyAddChildrenToMap:function(e,n,a){this._recursively(a,this._group._map.getMinZoom()-1,n,function(l){if(n!==l._zoom)for(var c=l._markers.length-1;c>=0;c--){var d=l._markers[c];a.contains(d._latlng)&&(e&&(d._backupLatlng=d.getLatLng(),d.setLatLng(e),d.clusterHide&&d.clusterHide()),l._group._featureGroup.addLayer(d))}},function(l){l._addToMap(e)})},_recursivelyRestoreChildPositions:function(e){for(var n=this._markers.length-1;n>=0;n--){var a=this._markers[n];a._backupLatlng&&(a.setLatLng(a._backupLatlng),delete a._backupLatlng)}if(e-1===this._zoom)for(var l=this._childClusters.length-1;l>=0;l--)this._childClusters[l]._restorePosition();else for(var c=this._childClusters.length-1;c>=0;c--)this._childClusters[c]._recursivelyRestoreChildPositions(e)},_restorePosition:function(){this._backupLatlng&&(this.setLatLng(this._backupLatlng),delete this._backupLatlng)},_recursivelyRemoveChildrenFromMap:function(e,n,a,l){var c,d;this._recursively(e,n-1,a-1,function(u){for(d=u._markers.length-1;d>=0;d--)c=u._markers[d],(!l||!l.contains(c._latlng))&&(u._group._featureGroup.removeLayer(c),c.clusterShow&&c.clusterShow())},function(u){for(d=u._childClusters.length-1;d>=0;d--)c=u._childClusters[d],(!l||!l.contains(c._latlng))&&(u._group._featureGroup.removeLayer(c),c.clusterShow&&c.clusterShow())})},_recursively:function(e,n,a,l,c){var d=this._childClusters,u=this._zoom,p,f;if(n<=u&&(l&&l(this),c&&u===a&&c(this)),u<n||u<a)for(p=d.length-1;p>=0;p--)f=d[p],f._boundsNeedUpdate&&f._recalculateBounds(),e.intersects(f._bounds)&&f._recursively(e,n,a,l,c)},_isSingleParent:function(){return this._childClusters.length>0&&this._childClusters[0]._childCount===this._childCount}});L.Marker.include({clusterHide:function(){var e=this.options.opacity;return this.setOpacity(0),this.options.opacity=e,this},clusterShow:function(){return this.setOpacity(this.options.opacity)}}),L.DistanceGrid=function(e){this._cellSize=e,this._sqCellSize=e*e,this._grid={},this._objectPoint={}},L.DistanceGrid.prototype={addObject:function(e,n){var a=this._getCoord(n.x),l=this._getCoord(n.y),c=this._grid,d=c[l]=c[l]||{},u=d[a]=d[a]||[],p=L.Util.stamp(e);this._objectPoint[p]=n,u.push(e)},updateObject:function(e,n){this.removeObject(e),this.addObject(e,n)},removeObject:function(e,n){var a=this._getCoord(n.x),l=this._getCoord(n.y),c=this._grid,d=c[l]=c[l]||{},u=d[a]=d[a]||[],p,f;for(delete this._objectPoint[L.Util.stamp(e)],p=0,f=u.length;p<f;p++)if(u[p]===e)return u.splice(p,1),f===1&&delete d[a],!0},eachObject:function(e,n){var a,l,c,d,u,p,f,_=this._grid;for(a in _){u=_[a];for(l in u)for(p=u[l],c=0,d=p.length;c<d;c++)f=e.call(n,p[c]),f&&(c--,d--)}},getNearObject:function(e){var n=this._getCoord(e.x),a=this._getCoord(e.y),l,c,d,u,p,f,_,m,b=this._objectPoint,y=this._sqCellSize,M=null;for(l=a-1;l<=a+1;l++)if(u=this._grid[l],u){for(c=n-1;c<=n+1;c++)if(p=u[c],p)for(d=0,f=p.length;d<f;d++)_=p[d],m=this._sqDist(b[L.Util.stamp(_)],e),(m<y||m<=y&&M===null)&&(y=m,M=_)}return M},_getCoord:function(e){var n=Math.floor(e/this._cellSize);return isFinite(n)?n:e},_sqDist:function(e,n){var a=n.x-e.x,l=n.y-e.y;return a*a+l*l}},(function(){L.QuickHull={getDistant:function(e,n){var a=n[1].lat-n[0].lat,l=n[0].lng-n[1].lng;return l*(e.lat-n[0].lat)+a*(e.lng-n[0].lng)},findMostDistantPointFromBaseLine:function(e,n){var a=0,l=null,c=[],d,u,p;for(d=n.length-1;d>=0;d--){if(u=n[d],p=this.getDistant(u,e),p>0)c.push(u);else continue;p>a&&(a=p,l=u)}return{maxPoint:l,newPoints:c}},buildConvexHull:function(e,n){var a=[],l=this.findMostDistantPointFromBaseLine(e,n);return l.maxPoint?(a=a.concat(this.buildConvexHull([e[0],l.maxPoint],l.newPoints)),a=a.concat(this.buildConvexHull([l.maxPoint,e[1]],l.newPoints)),a):[e[0]]},getConvexHull:function(e){var n=!1,a=!1,l=!1,c=!1,d=null,u=null,p=null,f=null,_=null,m=null,b;for(b=e.length-1;b>=0;b--){var y=e[b];(n===!1||y.lat>n)&&(d=y,n=y.lat),(a===!1||y.lat<a)&&(u=y,a=y.lat),(l===!1||y.lng>l)&&(p=y,l=y.lng),(c===!1||y.lng<c)&&(f=y,c=y.lng)}a!==n?(m=u,_=d):(m=f,_=p);var M=[].concat(this.buildConvexHull([m,_],e),this.buildConvexHull([_,m],e));return M}}})(),L.MarkerCluster.include({getConvexHull:function(){var e=this.getAllChildMarkers(),n=[],a,l;for(l=e.length-1;l>=0;l--)a=e[l].getLatLng(),n.push(a);return L.QuickHull.getConvexHull(n)}}),L.MarkerCluster.include({_2PI:Math.PI*2,_circleFootSeparation:25,_circleStartAngle:0,_spiralFootSeparation:28,_spiralLengthStart:11,_spiralLengthFactor:5,_circleSpiralSwitchover:9,spiderfy:function(){if(!(this._group._spiderfied===this||this._group._inZoomAnimation)){var e=this.getAllChildMarkers(null,!0),n=this._group,a=n._map,l=a.latLngToLayerPoint(this._latlng),c;this._group._unspiderfy(),this._group._spiderfied=this,this._group.options.spiderfyShapePositions?c=this._group.options.spiderfyShapePositions(e.length,l):e.length>=this._circleSpiralSwitchover?c=this._generatePointsSpiral(e.length,l):(l.y+=10,c=this._generatePointsCircle(e.length,l)),this._animationSpiderfy(e,c)}},unspiderfy:function(e){this._group._inZoomAnimation||(this._animationUnspiderfy(e),this._group._spiderfied=null)},_generatePointsCircle:function(e,n){var a=this._group.options.spiderfyDistanceMultiplier*this._circleFootSeparation*(2+e),l=a/this._2PI,c=this._2PI/e,d=[],u,p;for(l=Math.max(l,35),d.length=e,u=0;u<e;u++)p=this._circleStartAngle+u*c,d[u]=new L.Point(n.x+l*Math.cos(p),n.y+l*Math.sin(p))._round();return d},_generatePointsSpiral:function(e,n){var a=this._group.options.spiderfyDistanceMultiplier,l=a*this._spiralLengthStart,c=a*this._spiralFootSeparation,d=a*this._spiralLengthFactor*this._2PI,u=0,p=[],f;for(p.length=e,f=e;f>=0;f--)f<e&&(p[f]=new L.Point(n.x+l*Math.cos(u),n.y+l*Math.sin(u))._round()),u+=c/l+f*5e-4,l+=d/u;return p},_noanimationUnspiderfy:function(){var e=this._group,n=e._map,a=e._featureGroup,l=this.getAllChildMarkers(null,!0),c,d;for(e._ignoreMove=!0,this.setOpacity(1),d=l.length-1;d>=0;d--)c=l[d],a.removeLayer(c),c._preSpiderfyLatlng&&(c.setLatLng(c._preSpiderfyLatlng),delete c._preSpiderfyLatlng),c.setZIndexOffset&&c.setZIndexOffset(0),c._spiderLeg&&(n.removeLayer(c._spiderLeg),delete c._spiderLeg);e.fire("unspiderfied",{cluster:this,markers:l}),e._ignoreMove=!1,e._spiderfied=null}}),L.MarkerClusterNonAnimated=L.MarkerCluster.extend({_animationSpiderfy:function(e,n){var a=this._group,l=a._map,c=a._featureGroup,d=this._group.options.spiderLegPolylineOptions,u,p,f,_;for(a._ignoreMove=!0,u=0;u<e.length;u++)_=l.layerPointToLatLng(n[u]),p=e[u],f=new L.Polyline([this._latlng,_],d),l.addLayer(f),p._spiderLeg=f,p._preSpiderfyLatlng=p._latlng,p.setLatLng(_),p.setZIndexOffset&&p.setZIndexOffset(1e6),c.addLayer(p);this.setOpacity(.3),a._ignoreMove=!1,a.fire("spiderfied",{cluster:this,markers:e})},_animationUnspiderfy:function(){this._noanimationUnspiderfy()}}),L.MarkerCluster.include({_animationSpiderfy:function(e,n){var a=this,l=this._group,c=l._map,d=l._featureGroup,u=this._latlng,p=c.latLngToLayerPoint(u),f=L.Path.SVG,_=L.extend({},this._group.options.spiderLegPolylineOptions),m=_.opacity,b,y,M,x,A,S;for(m===void 0&&(m=L.MarkerClusterGroup.prototype.options.spiderLegPolylineOptions.opacity),f?(_.opacity=0,_.className=(_.className||"")+" leaflet-cluster-spider-leg"):_.opacity=m,l._ignoreMove=!0,b=0;b<e.length;b++)y=e[b],S=c.layerPointToLatLng(n[b]),M=new L.Polyline([u,S],_),c.addLayer(M),y._spiderLeg=M,f&&(x=M._path,A=x.getTotalLength()+.1,x.style.strokeDasharray=A,x.style.strokeDashoffset=A),y.setZIndexOffset&&y.setZIndexOffset(1e6),y.clusterHide&&y.clusterHide(),d.addLayer(y),y._setPos&&y._setPos(p);for(l._forceLayout(),l._animationStart(),b=e.length-1;b>=0;b--)S=c.layerPointToLatLng(n[b]),y=e[b],y._preSpiderfyLatlng=y._latlng,y.setLatLng(S),y.clusterShow&&y.clusterShow(),f&&(M=y._spiderLeg,x=M._path,x.style.strokeDashoffset=0,M.setStyle({opacity:m}));this.setOpacity(.3),l._ignoreMove=!1,setTimeout(function(){l._animationEnd(),l.fire("spiderfied",{cluster:a,markers:e})},200)},_animationUnspiderfy:function(e){var n=this,a=this._group,l=a._map,c=a._featureGroup,d=e?l._latLngToNewLayerPoint(this._latlng,e.zoom,e.center):l.latLngToLayerPoint(this._latlng),u=this.getAllChildMarkers(null,!0),p=L.Path.SVG,f,_,m,b,y,M;for(a._ignoreMove=!0,a._animationStart(),this.setOpacity(1),_=u.length-1;_>=0;_--)f=u[_],f._preSpiderfyLatlng&&(f.closePopup(),f.setLatLng(f._preSpiderfyLatlng),delete f._preSpiderfyLatlng,M=!0,f._setPos&&(f._setPos(d),M=!1),f.clusterHide&&(f.clusterHide(),M=!1),M&&c.removeLayer(f),p&&(m=f._spiderLeg,b=m._path,y=b.getTotalLength()+.1,b.style.strokeDashoffset=y,m.setStyle({opacity:0})));a._ignoreMove=!1,setTimeout(function(){var x=0;for(_=u.length-1;_>=0;_--)f=u[_],f._spiderLeg&&x++;for(_=u.length-1;_>=0;_--)f=u[_],f._spiderLeg&&(f.clusterShow&&f.clusterShow(),f.setZIndexOffset&&f.setZIndexOffset(0),x>1&&c.removeLayer(f),l.removeLayer(f._spiderLeg),delete f._spiderLeg);a._animationEnd(),a.fire("unspiderfied",{cluster:n,markers:u})},200)}}),L.MarkerClusterGroup.include({_spiderfied:null,unspiderfy:function(){this._unspiderfy.apply(this,arguments)},_spiderfierOnAdd:function(){this._map.on("click",this._unspiderfyWrapper,this),this._map.options.zoomAnimation&&this._map.on("zoomstart",this._unspiderfyZoomStart,this),this._map.on("zoomend",this._noanimationUnspiderfy,this),L.Browser.touch||this._map.getRenderer(this)},_spiderfierOnRemove:function(){this._map.off("click",this._unspiderfyWrapper,this),this._map.off("zoomstart",this._unspiderfyZoomStart,this),this._map.off("zoomanim",this._unspiderfyZoomAnim,this),this._map.off("zoomend",this._noanimationUnspiderfy,this),this._noanimationUnspiderfy()},_unspiderfyZoomStart:function(){this._map&&this._map.on("zoomanim",this._unspiderfyZoomAnim,this)},_unspiderfyZoomAnim:function(e){L.DomUtil.hasClass(this._map._mapPane,"leaflet-touching")||(this._map.off("zoomanim",this._unspiderfyZoomAnim,this),this._unspiderfy(e))},_unspiderfyWrapper:function(){this._unspiderfy()},_unspiderfy:function(e){this._spiderfied&&this._spiderfied.unspiderfy(e)},_noanimationUnspiderfy:function(){this._spiderfied&&this._spiderfied._noanimationUnspiderfy()},_unspiderfyLayer:function(e){e._spiderLeg&&(this._featureGroup.removeLayer(e),e.clusterShow&&e.clusterShow(),e.setZIndexOffset&&e.setZIndexOffset(0),this._map.removeLayer(e._spiderLeg),delete e._spiderLeg)}}),L.MarkerClusterGroup.include({refreshClusters:function(e){return e?e instanceof L.MarkerClusterGroup?e=e._topClusterLevel.getAllChildMarkers():e instanceof L.LayerGroup?e=e._layers:e instanceof L.MarkerCluster?e=e.getAllChildMarkers():e instanceof L.Marker&&(e=[e]):e=this._topClusterLevel.getAllChildMarkers(),this._flagParentsIconsNeedUpdate(e),this._refreshClustersIcons(),this.options.singleMarkerMode&&this._refreshSingleMarkerModeMarkers(e),this},_flagParentsIconsNeedUpdate:function(e){var n,a;for(n in e)for(a=e[n].__parent;a;)a._iconNeedsUpdate=!0,a=a.__parent},_refreshSingleMarkerModeMarkers:function(e){var n,a;for(n in e)a=e[n],this.hasLayer(a)&&a.setIcon(this._overrideMarkerIcon(a))}}),L.Marker.include({refreshIconOptions:function(e,n){var a=this.options.icon;return L.setOptions(a,e),this.setIcon(a),n&&this.__parent&&this.__parent._group.refreshClusters(this),this}}),i.MarkerClusterGroup=o,i.MarkerCluster=s,Object.defineProperty(i,"__esModule",{value:!0})})})(P,P.exports)),P.exports}Te();const Se=!1,I=Object.freeze({SECOND:1e3,MINUTE:60*1e3,HOUR:3600*1e3,DAY:1440*60*1e3}),g=Object.freeze({jsonUrl:"https://jasha256.github.io/fam-trainingsplan/trainingsplan.json",versionUrl:"https://jasha256.github.io/fam-trainingsplan/version.json",cacheEnabled:!0,cacheKey:"trainingsplan_cache_v3",cacheDuration:I.HOUR,favoritesKey:"trainingsplan_favorites_v1",search:Object.freeze({debounceDelay:300,minQueryLength:2,maxResults:100,fuseOptions:Object.freeze({keys:Object.freeze([{name:"training",weight:2},{name:"ort",weight:1.5},{name:"trainer",weight:1},{name:"wochentag",weight:.8},{name:"altersgruppe",weight:.5}]),threshold:.3,distance:100,minMatchCharLength:2,includeScore:!0,includeMatches:!0,ignoreLocation:!0,useExtendedSearch:!1})}),filters:Object.freeze({persistInUrl:!0,debounceDelay:100,urlParams:Object.freeze({wochentag:"tag",ort:"ort",training:"art",altersgruppe:"alter",searchTerm:"suche",nearby:"naehe"})}),map:Object.freeze({defaultCenter:Object.freeze([48.137154,11.576124]),defaultZoom:12,maxZoom:19,minZoom:10,tileLayerUrl:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a>',geolocation:Object.freeze({enableHighAccuracy:!0,timeout:10*I.SECOND,maximumAge:5*I.MINUTE,maxDistance:50,errorMessages:Object.freeze({PERMISSION_DENIED:"Standort-Berechtigung verweigert",POSITION_UNAVAILABLE:"Standort nicht verfügbar",TIMEOUT:"Standort-Anfrage Timeout",UNKNOWN:"Unbekannter Standort-Fehler"})}),clustering:Object.freeze({enabled:!0,maxClusterRadius:80,spiderfyOnMaxZoom:!0,showCoverageOnHover:!0,zoomToBoundsOnClick:!0})}),ui:Object.freeze({mobileBreakpoint:768,filterDebounce:100,notificationDuration:3e3,animationDuration:300,touch:Object.freeze({swipeThreshold:100,swipeVelocity:.3,swipeMaxTime:1e3,swipeMaxVertical:100}),lazyLoadThreshold:"50px",lazyLoadRootMargin:"100px"}),performance:Object.freeze({enableVirtualScroll:!1,lazyLoadImages:!0,prefetchData:!0,useRequestIdleCallback:typeof requestIdleCallback<"u"}),features:Object.freeze({enableMap:!0,enableSearch:!0,enableQuickFilters:!0,enablePersistence:!0,enableLazyLoading:!0,enableAnalytics:!1,enableShareLinks:!0,enablePrintView:!0,enableDarkMode:!1,enableNotifications:!0,enableOfflineMode:!0,enableFavorites:!0,enableGeolocation:!0,enableUpdateCheck:!0,enableCalendarExport:!0,enableTouchGestures:!0,enableBulkExport:!0}),favorites:Object.freeze({maxCount:100,syncAcrossDevices:!1}),errors:Object.freeze({maxRetries:3,retryDelay:I.SECOND,retryBackoff:2,showUserFriendlyMessages:!0,logToConsole:!0}),logging:Object.freeze({enabled:Se,level:"error",logToConsole:!0,logToServer:!1,levels:Object.freeze({debug:0,info:1,warn:2,error:3})}),iframe:Object.freeze({enabled:!0,parentOrigin:"https://www.freeartsofmovement.com",allowedOrigins:Object.freeze(["https://www.freeartsofmovement.com","http://localhost:5173","http://127.0.0.1:5173"]),debounceDelay:50,minHeight:400,maxHeight:1e4,autoResize:!0}),pwa:Object.freeze({enabled:!0,name:"FAM Trainingsplan",shortName:"FAM",description:"Trainingsplan für Free Arts of Movement",version:"3.0.0",themeColor:"#005892",backgroundColor:"#005892",display:"standalone",orientation:"portrait-primary",scope:"/",startUrl:"/",updateStrategy:"prompt",updateCheckInterval:I.HOUR,offlinePages:Object.freeze(["/","/offline.html"])})});function Fe(r){if(!g.logging.enabled)return!1;const t=g.logging.levels[g.logging.level]??3;return(g.logging.levels[r]??0)>=t}function h(r,t,...i){if(!Fe(r))return;const o=`[trainingsplan:${r}]`,s=new Date().toISOString(),e=i.length>0?i:[];({debug:console.log,info:console.info,warn:console.warn,error:console.error}[r]||console.log)(o,s,t,...e)}let $=null;function W(){if($)return $;const r=()=>{try{const t="__storage_test__";return localStorage.setItem(t,t),localStorage.removeItem(t),!0}catch{return!1}};return $=Object.freeze({isMobile:window.innerWidth<g.ui.mobileBreakpoint,isTouch:"ontouchstart"in window||navigator.maxTouchPoints>0,supportsLocalStorage:r(),supportsGeolocation:"geolocation"in navigator,supportsIntersectionObserver:"IntersectionObserver"in window,supportsResizeObserver:"ResizeObserver"in window,supportsMutationObserver:"MutationObserver"in window,supportsServiceWorker:"serviceWorker"in navigator,supportsShareAPI:"share"in navigator,supportsClipboardAPI:"clipboard"in navigator,isStandalone:window.matchMedia("(display-mode: standalone)").matches||window.navigator.standalone===!0,connection:navigator.connection?Object.freeze({effectiveType:navigator.connection.effectiveType,downlink:navigator.connection.downlink,rtt:navigator.connection.rtt,saveData:navigator.connection.saveData}):null}),$}const B=new Map;function Oe(r){return B.has(r)||B.set(r,structuredClone(g[r])),B.get(r)}function Ae(){return Oe("map")}function Ee(r,t=300){let i;return function(...s){const e=()=>{clearTimeout(i),r(...s)};clearTimeout(i),i=setTimeout(e,t)}}function q(r,t=100){let i;return function(...s){i||(r(...s),i=!0,setTimeout(()=>{i=!1},t))}}function Ie(r){if(typeof r!="string")return"0";let t=0;for(let i=0;i<r.length;i++){const o=r.charCodeAt(i);t=(t<<5)-t+o,t=t&t}return t.toString()}function Pe(r,t){if(!r||!t)return"";const i=o=>{const[s,e]=o.split(":");return`${parseInt(s,10)}:${e}`};return`${i(r)} - ${i(t)} Uhr`}function K(r){return r?r.altersgruppe&&typeof r.altersgruppe=="string"?r.altersgruppe:r.alterVon&&r.alterBis?`${r.alterVon} - ${r.alterBis} Jahre`:r.alterVon?`ab ${r.alterVon} Jahren`:"Alle Altersgruppen":""}function $e(r){if(typeof r!="string")return"";const t=document.createElement("div");return t.textContent=r,t.innerHTML}function De(r){try{const t=new URL(r);return t.protocol==="http:"||t.protocol==="https:"}catch{return!1}}function Ne(r,t,i){return r===1?t:i}function ze(r){return typeof r!="number"||Number.isNaN(r)?"0":r>=1e6?(r/1e6).toFixed(1)+"M":r>=1e3?(r/1e3).toFixed(1)+"k":r.toString()}function ie(r,t=2){const i=10**t;return Math.round(r*i)/i}function Ue(r,t){if(!Array.isArray(r))return[];const i=r.map(o=>o[t]).filter(o=>o!=null&&String(o).trim()!=="");return[...new Set(i.map(o=>String(o)))].sort((o,s)=>o.localeCompare(s,"de"))}function Re(r,t){if(!Array.isArray(r))return{};if(Object.groupBy)return Object.groupBy(r,o=>String(o[t]||"undefined"));const i={};return r.reduce((o,s)=>{const e=String(s[t]||"undefined");return o[e]||(o[e]=[]),o[e].push(s),o},i)}function Ge(r){if(!Array.isArray(r))return[];const t=[...r];for(let i=t.length-1;i>0;i--){const o=Math.floor(Math.random()*(i+1));[t[i],t[o]]=[t[o],t[i]]}return t}async function Be(){const r=Ae().geolocation;if(!navigator.geolocation)throw new Error("Geolocation nicht unterstützt");return new Promise((t,i)=>{const o={enableHighAccuracy:r.enableHighAccuracy,timeout:r.timeout,maximumAge:r.maximumAge};navigator.geolocation.getCurrentPosition(s=>{t({lat:s.coords.latitude,lng:s.coords.longitude,accuracy:s.coords.accuracy})},s=>{const e=r.errorMessages;let n=e.UNKNOWN;switch(s.code){case s.PERMISSION_DENIED:n=e.PERMISSION_DENIED;break;case s.POSITION_UNAVAILABLE:n=e.POSITION_UNAVAILABLE;break;case s.TIMEOUT:n=e.TIMEOUT;break}i(new Error(n))},o)})}function re(r,t,i,o){const e=D(i-r),n=D(o-t),a=Math.sin(e/2)*Math.sin(e/2)+Math.cos(D(r))*Math.cos(D(i))*Math.sin(n/2)*Math.sin(n/2),c=6371*(2*Math.atan2(Math.sqrt(a),Math.sqrt(1-a)));return ie(c,1)}function D(r){return r*(Math.PI/180)}function He(r,t){return!Array.isArray(r)||!t?r:r.map(i=>{if(i.lat&&i.lng){const o=re(t.lat,t.lng,i.lat,i.lng);return{...i,distance:o}}return i})}function N(r){if(!r)return null;const i={Montag:1,Dienstag:2,Mittwoch:3,Donnerstag:4,Freitag:5,Samstag:6,Sonntag:0}[r];if(i===void 0)return null;const o=new Date,s=o.getDay();let e=i-s;e<0&&(e+=7),e===0&&o.getHours()>=20&&(e=7);const n=new Date(o);return n.setDate(o.getDate()+e),n.setHours(0,0,0,0),n}function E(r){return r.toISOString().replace(/[-:]/g,"").split(".")[0]+"Z"}function je(r){if(!r||typeof r!="string")return 0;const[t,i]=r.split(":").map(o=>parseInt(o,10));return Number.isNaN(t)||Number.isNaN(i)?0:t*60+i}function Q(r){const t=N(r.wochentag);if(!t)return null;const i=r.von.split(":"),o=r.bis.split(":"),s=new Date(t);s.setHours(parseInt(i[0],10),parseInt(i[1],10),0);const e=new Date(t);e.setHours(parseInt(o[0],10),parseInt(o[1],10),0);const n=[r.training,"Altersgruppe: "+K(r),r.trainer?"Trainer: "+r.trainer:"",r.anmerkung?"Hinweis: "+r.anmerkung:"",r.link?"Anmeldung: "+r.link:""].filter(Boolean).join("\\n");return["BEGIN:VCALENDAR","VERSION:2.0","PRODID:-//FAM Trainingsplan//DE","CALSCALE:GREGORIAN","METHOD:PUBLISH","BEGIN:VEVENT",`UID:${r.id}@fam-trainingsplan`,`DTSTAMP:${E(new Date)}`,`DTSTART:${E(s)}`,`DTEND:${E(e)}`,`SUMMARY:${r.training} - ${r.ort}`,`DESCRIPTION:${n}`,`LOCATION:${r.ort}`,r.link?`URL:${r.link}`:"","STATUS:CONFIRMED","SEQUENCE:0","END:VEVENT","END:VCALENDAR"].filter(Boolean).join(`\r
`)}function Ze(r){if(!Array.isArray(r)||r.length===0)throw new Error("Trainings array is empty or invalid");const t=[];if(r.forEach(i=>{const o=N(i.wochentag);if(o)try{const s=i.von.split(":"),e=i.bis.split(":"),n=new Date(o);n.setHours(parseInt(s[0],10),parseInt(s[1],10),0);const a=new Date(o);a.setHours(parseInt(e[0],10),parseInt(e[1],10),0);const l=[i.training,"Altersgruppe: "+K(i),i.trainer?"Trainer: "+i.trainer:"",i.anmerkung?"Hinweis: "+i.anmerkung:"",i.link?"Anmeldung: "+i.link:""].filter(Boolean).join("\\n"),d={Montag:"MO",Dienstag:"TU",Mittwoch:"WE",Donnerstag:"TH",Freitag:"FR",Samstag:"SA",Sonntag:"SU"}[i.wochentag]||"MO",u=["BEGIN:VEVENT",`UID:${i.id}@fam-trainingsplan`,`DTSTAMP:${E(new Date)}`,`DTSTART:${E(n)}`,`DTEND:${E(a)}`,`SUMMARY:${i.training} - ${i.ort}`,`DESCRIPTION:${l}`,`LOCATION:${i.ort}`,i.link?`URL:${i.link}`:"","STATUS:CONFIRMED",`RRULE:FREQ=WEEKLY;BYDAY=${d};COUNT=52`,"END:VEVENT"].filter(Boolean).join(`\r
`);t.push(u)}catch(s){h("warn",`Skipping invalid training: ${i.id}`,s)}}),t.length===0)throw new Error("No valid events to export");return["BEGIN:VCALENDAR","VERSION:2.0","PRODID:-//FAM Trainingsplan//DE","CALSCALE:GREGORIAN","METHOD:PUBLISH","X-WR-CALNAME:FAM Trainingsplan","X-WR-CALDESC:Free Arts of Movement München","X-WR-TIMEZONE:Europe/Berlin",...t,"END:VCALENDAR"].join(`\r
`)}function Ve(r,t="training.ics"){try{const i=new Blob([r],{type:"text/calendar;charset=utf-8"}),o=window.URL.createObjectURL(i),s=document.createElement("a");s.href=o,s.download=t,document.body.appendChild(s),s.click(),document.body.removeChild(s),window.URL.revokeObjectURL(o),h("info","iCal file downloaded",{filename:t})}catch(i){throw h("error","iCal download failed",i),i}}function We(r){const t=new URLSearchParams,i=g.filters.urlParams;Object.entries(r).forEach(([e,n])=>{if(!n||n===null||e==="activeQuickFilter"||e.startsWith("_custom"))return;const a=i[e]||e;Array.isArray(n)&&n.length>0?t.set(a,n.join(",")):n!==""&&typeof n!="object"&&t.set(a,String(n))});const o=t.toString(),s=window.location.origin+window.location.pathname;return o?`${s}?${o}`:s}function qe(){const r=new URLSearchParams(window.location.search),t=g.filters.urlParams,i=Object.fromEntries(Object.entries(t).map(([s,e])=>[e,s])),o={wochentag:[],ort:[],training:[],altersgruppe:[],searchTerm:"",nearby:!1};return r.forEach((s,e)=>{const n=i[e]||e;n in o&&(["wochentag","ort","training","altersgruppe"].includes(n)?o[n]=s?s.split(",").map(a=>a.trim()).filter(a=>a):[]:n==="nearby"?o[n]=s==="true":o[n]=s)}),o}async function Ke(r){if(navigator.clipboard&&navigator.clipboard.writeText)try{return await navigator.clipboard.writeText(r),h("info","Text copied to clipboard"),!0}catch(t){h("warn","Clipboard API failed, falling back",t)}try{const t=document.createElement("textarea");t.value=r,t.style.position="fixed",t.style.left="-9999px",t.style.opacity="0",document.body.appendChild(t),t.select();const i=document.execCommand("copy");return document.body.removeChild(t),i&&h("info","Text copied (fallback)"),i}catch(t){return h("error","Copy to clipboard failed",t),!1}}const H={get(r,t=null){try{const i=localStorage.getItem(r);return i?JSON.parse(i):t}catch(i){return h("error","localStorage.get failed",i),t}},set(r,t){try{return localStorage.setItem(r,JSON.stringify(t)),!0}catch(i){return h("error","localStorage.set failed",i),!1}},remove(r){try{return localStorage.removeItem(r),!0}catch(t){return h("error","localStorage.remove failed",t),!1}},clear(){try{return localStorage.clear(),!0}catch(r){return h("error","localStorage.clear failed",r),!1}},has(r){return localStorage.getItem(r)!==null},keys(){return Object.keys(localStorage)}},Qe={load(){return H.get(g.favoritesKey,[])},save(r){const i=(Array.isArray(r)?r.filter(o=>typeof o=="number"||typeof o=="string"):[]).slice(0,g.favorites.maxCount);return H.set(g.favoritesKey,i)},add(r){const t=this.load();return t.includes(r)?!1:(t.push(r),this.save(t))},remove(r){const t=this.load(),i=t.filter(o=>o!==r);return i.length!==t.length?this.save(i):!1},toggle(r){return this.has(r)?(this.remove(r),!1):(this.add(r),!0)},has(r){return this.load().includes(r)},count(){return this.load().length},clear(){return this.save([])}},k={debounce:Ee,throttle:q,generateHash:Ie,formatZeitrange:Pe,formatAlter:K,sanitizeHtml:$e,isValidUrl:De,pluralize:Ne,formatNumber:ze,roundTo:ie,extractUnique:Ue,groupBy:Re,shuffle:Ge,getCurrentPosition:Be,calculateDistance:re,addDistanceToTrainings:He,getNextTrainingDate:N,formatICalDate:E,zeitZuMinuten:je,createICalEvent:Q,createICalBundle:Ze,downloadICalFile:Ve,createShareLink:We,getFiltersFromUrl:qe,copyToClipboard:Ke,storage:H,favorites:Qe};function Ye(){return{allTrainings:[],filteredTrainings:[],metadata:null,loading:!0,error:null,fromCache:!1,searchTimeout:null,fuse:null,map:null,markers:[],markerClusterGroup:null,userHasInteractedWithMap:!1,tileLayer:null,tileLayers:null,layerControl:null,geolocationControl:null,resetControl:null,ariaLiveRegion:null,userPosition:null,geolocationError:null,geolocationLoading:!1,favorites:[],updateAvailable:!1,latestVersion:null,updateCheckInterval:null,wochentagOrder:{Montag:1,Dienstag:2,Mittwoch:3,Donnerstag:4,Freitag:5,Samstag:6,Sonntag:7}}}class Xe{constructor(t){this.context=t}loadFiltersFromUrl(){const t=k.getFiltersFromUrl();Object.assign(this.context.$store.ui.filters,t),h("debug","URL filters loaded",t)}updateUrlWithFilters(){if(!g.filters.persistInUrl)return;const t=k.createShareLink(this.context.$store.ui.filters);window.history.replaceState({},"",t)}}class Je{constructor(t,i,o){this.state=t,this.context=i,this.isFavorite=o.isFavorite,this.updateUrl=o.updateUrl}applyFilters(){const t=this.context.$store.ui.filters;let i=[...this.context.allTrainings];if(this.matchesCustomPersonalFilter(t._customPersonalFilter)){i=i.filter(o=>this.isFavorite(o.id)),this._finalizeFiltering(i);return}this.hasCustomTimeFilter(t._customTimeFilter)?i=this.applyCustomTimeFilter(i,t._customTimeFilter):i=this.applyStandardWeekdayFilter(i,t.wochentag),this.hasCustomFeatureFilter(t._customFeatureFilter)&&(i=this.applyCustomFeatureFilter(i,t._customFeatureFilter)),this.hasCustomLocationFilter(t._customLocationFilter)?i=this.applyCustomLocationFilter(i,t._customLocationFilter):i=this.applyStandardLocationFilter(i,t.ort),i=this.applyTrainingTypeFilter(i,t.training),i=this.applyAgeGroupFilter(i,t.altersgruppe),i=this.applySearchFilter(i,t.searchTerm),!t._customLocationFilter&&this.context.userPosition&&g.map.geolocation.maxDistance>0&&(i=i.filter(o=>o.distance&&o.distance<=g.map.geolocation.maxDistance)),this.context.userPosition&&i.sort((o,s)=>(o.distance||999)-(s.distance||999)),this._finalizeFiltering(i)}matchesCustomPersonalFilter(t){return t==="favoriten"}hasCustomTimeFilter(t){return t==="wochenende"||t==="wochentags"}applyCustomTimeFilter(t,i){return i==="wochenende"?t.filter(o=>o.wochentag==="Samstag"||o.wochentag==="Sonntag"):i==="wochentags"?t.filter(o=>o.wochentag&&o.wochentag!=="Samstag"&&o.wochentag!=="Sonntag"):t}hasCustomFeatureFilter(t){return t==="probetraining"}applyCustomFeatureFilter(t,i){return i==="probetraining"?t.filter(o=>o.probetraining?.toLowerCase()==="ja"):t}hasCustomLocationFilter(t){return t==="inMeinerNaehe"}applyCustomLocationFilter(t,i){return i==="inMeinerNaehe"?t.filter(o=>{if(!o.distance)return!1;const s=parseFloat(o.distance);return!isNaN(s)&&s<=5}):t}applyStandardWeekdayFilter(t,i){if(!this.hasFilterValue(i))return t;const o=this.normalizeToArray(i);return t.filter(s=>s.wochentag&&o.some(e=>s.wochentag.toLowerCase()===e.toLowerCase()))}applyStandardLocationFilter(t,i){if(!this.hasFilterValue(i))return t;const o=this.normalizeToArray(i);return t.filter(s=>s.ort&&o.some(e=>s.ort.toLowerCase()===e.toLowerCase()))}applyTrainingTypeFilter(t,i){if(!this.hasFilterValue(i))return t;const o=this.normalizeToArray(i);return t.filter(s=>s.training&&o.some(e=>s.training.toLowerCase().includes(e.toLowerCase())))}applyAgeGroupFilter(t,i){if(!this.hasFilterValue(i))return t;const o=this.normalizeToArray(i);return t.filter(s=>o.some(e=>this.matchesAltersgruppe(s,e)))}applySearchFilter(t,i){if(!i||!i.trim()||!this.context.fuse)return t;const o=this.context.fuse.search(i.trim()),s=new Set(o.map(e=>e.item.id));return t.filter(e=>s.has(e.id))}_finalizeFiltering(t){this.context.filteredTrainings=t,g.filters.persistInUrl&&this.updateUrl(),h("debug","Filters applied",{total:this.context.allTrainings.length,filtered:t.length})}hasFilterValue(t){return t?Array.isArray(t)?t.length>0:typeof t=="string"?t.trim()!=="":!1:!1}normalizeToArray(t){return Array.isArray(t)?t.filter(i=>i&&i.trim()!==""):typeof t=="string"&&t.trim()!==""?[t.trim()]:[]}matchesAltersgruppe(t,i){return t.altersgruppe?String(t.altersgruppe).split(",").map(s=>s.trim().toLowerCase()).some(s=>s===i.toLowerCase()):!1}}class et{constructor(t,i,o){this.state=t,this.context=i,this.applyFilters=o.applyFilters}loadFavorites(){this.context.favorites=k.favorites.load(),h("debug","Favorites loaded",{count:this.context.favorites.length})}isFavorite(t){return this.context.favorites.includes(t)}toggleFavorite(t){const i=k.favorites.toggle(t);return this.loadFavorites(),this.context.$nextTick(()=>{this.context.$store.ui.filters.activeQuickFilter==="favoriten"&&this.applyFilters()}),this.context.$store.ui.showNotification(i?"Zu Favoriten hinzugef�gt P":"Von Favoriten entfernt","info",2e3),i}quickFilterFavorites(){this.context.$store.ui.filters.activeQuickFilter==="favoriten"?this.context.$store.ui.filters={wochentag:"",ort:"",training:"",altersgruppe:"",searchTerm:"",activeQuickFilter:null}:this.context.$store.ui.filters={wochentag:"",ort:"",training:"",altersgruppe:"",searchTerm:"",activeQuickFilter:"favoriten"},this.applyFilters()}}class tt{constructor(t,i,o){this.state=t,this.context=i,this.applyFilters=o.applyFilters,this.mapManager=o.mapManager||null,this.loadManualLocation()}loadManualLocation(){if(this.context.$store.ui.manualLocationSet&&this.context.$store.ui.manualLocation&&(this.context.userPosition=this.context.$store.ui.manualLocation,h("info","Manual location loaded",this.context.userPosition),this.addDistanceToTrainings(),this.mapManager&&this.context.map)){const{lat:t,lng:i}=this.context.userPosition;this.mapManager.addUserLocationMarker([t,i])}}async requestUserLocation(){if(!g.features.enableGeolocation)return this.context.geolocationError="Geolocation ist deaktiviert",!1;this.context.geolocationLoading=!0,this.context.geolocationError=null;try{if(this.context.userPosition=await k.getCurrentPosition(),h("info","Position obtained",this.context.userPosition),this.addDistanceToTrainings(),this.applyFilters(),this.mapManager&&this.context.map){const{lat:t,lng:i}=this.context.userPosition;this.mapManager.addUserLocationMarker([t,i])}return this.context.$store.ui.showNotification("Standort ermittelt! 📍","success",2e3),!0}catch(t){h("error","Geolocation failed",t);const i=t instanceof Error?t.message:String(t);return this.context.geolocationError=i,this.context.$store.ui.showNotification(i,"error",5e3),!1}finally{this.context.geolocationLoading=!1}}addDistanceToTrainings(){this.context.userPosition&&(this.context.allTrainings=k.addDistanceToTrainings(this.context.allTrainings,this.context.userPosition),this.context.allTrainings.forEach(t=>{t.distance!==void 0&&(t.distanceText=t.distance.toFixed(1)+" km")}))}resetLocation(){this.context.userPosition=null,this.context.$store.ui.manualLocation=null,this.context.$store.ui.manualLocationAddress="",this.context.$store.ui.manualLocationSet=!1,localStorage.removeItem("manualLocation"),this.context.allTrainings.forEach(t=>{delete t.distance,delete t.distanceText}),this.context.map&&this.context.userLocationMarker&&(this.context.map.removeLayer(this.context.userLocationMarker),this.context.userLocationMarker=null),this.context.$store.ui.filters.activeQuickFilter==="nearby"&&(this.context.$store.ui.filters.activeQuickFilter=null),this.applyFilters(),h("info","Location reset successfully")}}const it=v.Control.extend({options:{position:"topright",strings:{title:"Mein Standort",locating:"Standort wird ermittelt...",found:"Standort gefunden!",error:"Standort konnte nicht ermittelt werden"}},onAdd(r){this._map=r;const t=v.DomUtil.create("div","leaflet-bar leaflet-control leaflet-control-geolocation");return this._button=v.DomUtil.create("button","md-icon-button",t),this._button.innerHTML=`
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <circle cx="12" cy="12" r="10"></circle>
        <circle cx="12" cy="12" r="3"></circle>
      </svg>
    `,this._button.title=this.options.strings.title,this._button.setAttribute("aria-label",this.options.strings.title),v.DomEvent.disableClickPropagation(t),v.DomEvent.disableScrollPropagation(t),v.DomEvent.on(this._button,"click",this._handleClick,this),t},onRemove(r){v.DomEvent.off(this._button,"click",this._handleClick,this)},_handleClick(){if(!navigator.geolocation){this._showError("Geolocation wird von diesem Browser nicht unterstützt");return}this._setLoading(!0),this._map.locate({setView:!0,maxZoom:16,enableHighAccuracy:g.map.geolocation.enableHighAccuracy,timeout:g.map.geolocation.timeout,maximumAge:g.map.geolocation.maximumAge}),this._map.once("locationfound",r=>{this._setLoading(!1),this._showSuccess(r.latlng),h("info","Geolocation found",{lat:r.latlng.lat,lng:r.latlng.lng,accuracy:r.accuracy})}),this._map.once("locationerror",r=>{this._setLoading(!1);let t=this.options.strings.error;switch(r.code){case 1:t="Standort-Berechtigung verweigert. Bitte in den Browser-Einstellungen erlauben.";break;case 2:t="Standort nicht verfügbar. GPS aktivieren?";break;case 3:t="Standort-Anfrage Timeout. Bitte erneut versuchen.";break}this._showError(t),h("warn","Geolocation error",{code:r.code,message:r.message})})},_setLoading(r){r?(this._button.classList.add("loading"),this._button.disabled=!0,this._button.title=this.options.strings.locating):(this._button.classList.remove("loading"),this._button.disabled=!1,this._button.title=this.options.strings.title)},_showSuccess(r){this._userMarker&&this._map.removeLayer(this._userMarker),this._userMarker=v.marker(r,{icon:v.divIcon({className:"md-user-location-marker",html:'<div class="pulse"></div>',iconSize:[20,20]}),title:"Mein Standort"}).addTo(this._map),window.Alpine&&window.Alpine.store&&window.Alpine.store("ui").showNotification(this.options.strings.found,"success",3e3)},_showError(r){window.Alpine&&window.Alpine.store&&window.Alpine.store("ui").showNotification(r,"error",5e3)}}),rt=v.Control.extend({options:{position:"topright",title:"Ansicht zurücksetzen",bounds:null,center:null,zoom:null},onAdd(r){this._map=r,!this.options.bounds&&!this.options.center&&(this._initialCenter=r.getCenter(),this._initialZoom=r.getZoom());const t=v.DomUtil.create("div","leaflet-bar leaflet-control leaflet-control-reset");return this._button=v.DomUtil.create("button","md-icon-button",t),this._button.innerHTML=`
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"></path>
        <path d="M21 3v5h-5"></path>
        <path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"></path>
        <path d="M3 21v-5h5"></path>
      </svg>
    `,this._button.title=this.options.title,this._button.setAttribute("aria-label",this.options.title),v.DomEvent.disableClickPropagation(t),v.DomEvent.disableScrollPropagation(t),v.DomEvent.on(this._button,"click",this._handleClick,this),t},onRemove(r){v.DomEvent.off(this._button,"click",this._handleClick,this)},_handleClick(){this.options.bounds?this._map.fitBounds(this.options.bounds,{padding:[50,50],animate:!0}):this.options.center&&this.options.zoom?this._map.setView(this.options.center,this.options.zoom,{animate:!0}):this._map.setView(this._initialCenter,this._initialZoom,{animate:!0}),h("info","Map view reset")}}),nt=v.Control.extend({options:{position:"topright",title:"Kartenstil wechseln",layers:{},defaultLayer:"street"},onAdd(r){this._map=r,this._currentLayer=this.options.defaultLayer;const t=v.DomUtil.create("div","leaflet-bar leaflet-control leaflet-control-layers-switcher");return this._button=v.DomUtil.create("button","md-icon-button",t),this._button.innerHTML=`
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"></path>
        <polyline points="14 2 14 8 20 8"></polyline>
        <path d="M12 18v-4"></path>
        <path d="M8 16h8"></path>
      </svg>
    `,this._button.title=this.options.title,this._button.setAttribute("aria-label",this.options.title),this._button.setAttribute("aria-expanded","false"),this._menu=v.DomUtil.create("div","layer-switcher-menu",t),this._menu.style.display="none",Object.keys(this.options.layers).forEach(o=>{const s=v.DomUtil.create("button","layer-option",this._menu);s.textContent=this._getLayerLabel(o),s.setAttribute("data-layer",o),s.setAttribute("role","menuitem"),o===this._currentLayer&&(s.classList.add("active"),s.setAttribute("aria-current","true")),v.DomEvent.on(s,"click",()=>{this._switchLayer(o)})}),v.DomEvent.disableClickPropagation(t),v.DomEvent.disableScrollPropagation(t),v.DomEvent.on(this._button,"click",()=>{const o=this._menu.style.display!=="none";this._menu.style.display=o?"none":"block",this._button.setAttribute("aria-expanded",o?"false":"true")}),v.DomEvent.on(document,"click",o=>{t.contains(o.target)||(this._menu.style.display="none",this._button.setAttribute("aria-expanded","false"))}),t},onRemove(r){v.DomEvent.off(this._button,"click"),v.DomEvent.off(document,"click")},_switchLayer(r){if(r===this._currentLayer)return;const t=this.options.layers[this._currentLayer],i=this.options.layers[r];i&&(t&&this._map.hasLayer(t)&&this._map.removeLayer(t),this._map.addLayer(i),this._currentLayer=r,this._updateMenuUI(),this._menu.style.display="none",this._button.setAttribute("aria-expanded","false"),h("info",`Switched to ${r} layer`))},_updateMenuUI(){this._menu.querySelectorAll(".layer-option").forEach(t=>{t.getAttribute("data-layer")===this._currentLayer?(t.classList.add("active"),t.setAttribute("aria-current","true")):(t.classList.remove("active"),t.removeAttribute("aria-current"))})},_getLayerLabel(r){return{street:"🗺️ Straßenkarte",satellite:"🛰️ Satellit",terrain:"⛰️ Gelände",dark:"🌙 Dunkel"}[r]||r}});function ot(r={}){return new it(r)}function at(r={}){return new rt(r)}function st(r={}){return new nt(r)}function lt(r=768){return window.innerWidth<r?60:80}function ct(r=768){return window.innerWidth<r?1.5:1}function ut(r){const t=new Map;return r.forEach(i=>{if(!i.lat||!i.lng)return;const o=`${i.lat.toFixed(6)},${i.lng.toFixed(6)}`;t.has(o)||t.set(o,[]),t.get(o).push(i)}),t}function dt(r,t){const i=r[0].ort||"Standort",o=r[0].adresse||"",s=r.length,e=r.map(a=>({id:a.id,training:a.training,wochentag:a.wochentag,von:a.von,bis:a.bis,altersgruppe:a.altersgruppe,trainer:a.trainer,probetraining:a.probetraining,anmerkung:a.anmerkung,link:a.link}));return`
    <div class="md-map-location-popup"
         data-trainings-b64="${btoa(encodeURIComponent(JSON.stringify(e)))}"
         x-data="{
           trainings: [],
           sortBy: 'day',
           get sorted() {
             const dayOrder = {Montag:1,Dienstag:2,Mittwoch:3,Donnerstag:4,Freitag:5,Samstag:6,Sonntag:7};
             const list = [...this.trainings];
             switch(this.sortBy) {
               case 'day': return list.sort((a,b) => (dayOrder[a.wochentag]||99) - (dayOrder[b.wochentag]||99));
               case 'time': return list.sort((a,b) => (a.von||'00:00').localeCompare(b.von||'00:00'));
               case 'age': return list.sort((a,b) => (parseInt(a.vonalter)||0) - (parseInt(b.vonalter)||0));
               case 'name': return list.sort((a,b) => a.training.localeCompare(b.training));
               default: return list;
             }
           }
         }"
         x-init="trainings = JSON.parse(decodeURIComponent(atob($el.dataset.trainingsB64)))"
      <!-- Header -->
      <div class="md-map-location-header">
        <div class="md-map-popup-icon">📍</div>
        <div class="md-map-popup-title flex-1">
          <h3 class="md-typescale-title-medium font-bold">${i}</h3>
          <p class="md-typescale-body-small opacity-90">${s} Training${s>1?"s":""} an diesem Standort</p>
          ${o?`<p class="md-typescale-body-small opacity-80 mt-0.5">🏠 ${o}</p>`:""}
        </div>
      </div>

      <!-- Sorting Controls -->
      <div class="md-map-location-sort">
        <div class="flex items-center gap-3">
          <label for="sort-select" class="md-typescale-label-medium font-semibold" style="color: var(--md-sys-color-on-surface);">
            Sortieren nach:
          </label>
          <select id="sort-select"
                  x-model="sortBy"
                  class="md-sort-dropdown">
            <option value="day">📅 Wochentag</option>
            <option value="time">🕐 Uhrzeit</option>
            <option value="age">👥 Altersgruppe</option>
            <option value="name">🥋 Trainingsname</option>
          </select>
        </div>
      </div>

      <!-- Scrollable trainings list -->
      <div class="md-map-location-list">
        <template x-for="(training, index) in sorted" :key="training.id">
          <div class="md-map-location-item">
            <!-- Training header with icon -->
            <div class="flex items-start gap-3 mb-3">
              <div class="md-map-popup-icon" style="width: 36px; height: 36px; font-size: 18px; background-color: rgba(var(--color-primary-rgb, 0, 115, 230), 0.15); border-radius: 50%; display: flex; align-items: center; justify-content: center; flex-shrink: 0;">
                🥋
              </div>
              <div class="flex-1 min-w-0">
                <h4 class="md-typescale-title-small font-semibold mb-1" x-text="training.training"></h4>
                <span x-show="training.probetraining === 'ja'"
                      class="inline-flex items-center gap-1 text-xs px-2 py-0.5 rounded-full"
                      style="background-color: var(--md-sys-color-primary-container); color: var(--md-sys-color-on-primary-container); font-weight: 600;">
                  ✅ Probetraining möglich
                </span>
              </div>
            </div>

            <!-- Training details grid with consistent styling -->
            <div class="md-map-popup-info-grid" style="display: grid; grid-template-columns: auto 1fr; gap: 0.5rem 1rem; margin-bottom: 1rem;">
              <div class="md-map-popup-info-icon" style="display: flex; align-items: center; justify-content: center; color: var(--md-sys-color-on-surface-variant); font-size: 16px;">
                📅
              </div>
              <div class="md-map-popup-info-value" style="display: flex; align-items: center;">
                <span class="md-typescale-body-medium font-medium" x-text="training.wochentag"></span>
              </div>

              <div class="md-map-popup-info-icon" style="display: flex; align-items: center; justify-content: center; color: var(--md-sys-color-on-surface-variant); font-size: 16px;">
                🕐
              </div>
              <div class="md-map-popup-info-value" style="display: flex; align-items: center;">
                <span class="md-typescale-body-medium font-medium" x-text="training.von + ' - ' + training.bis + ' Uhr'"></span>
              </div>

              <div class="md-map-popup-info-icon" style="display: flex; align-items: center; justify-content: center; color: var(--md-sys-color-on-surface-variant); font-size: 16px;">
                👥
              </div>
              <div class="md-map-popup-info-value" style="display: flex; align-items: center;">
                <span class="md-typescale-body-medium" x-text="training.altersgruppe || 'Alle Altersgruppen'"></span>
              </div>

              <div class="md-map-popup-info-icon" style="display: flex; align-items: center; justify-content: center; color: var(--md-sys-color-on-surface-variant); font-size: 16px;">
                👤
              </div>
              <div class="md-map-popup-info-value" style="display: flex; align-items: center;">
                <span class="md-typescale-body-medium" x-text="training.trainer"></span>
              </div>
            </div>

            <!-- Note with better styling -->
            <div x-show="training.anmerkung"
                 class="md-map-popup-note"
                 style="background: linear-gradient(135deg, var(--md-sys-color-primary-container) 0%, var(--md-sys-color-secondary-container) 100%); color: var(--md-sys-color-on-primary-container); padding: 0.75rem; border-radius: 8px; margin-top: 1rem; border-left: 3px solid var(--color-primary-500);">
              <p class="md-typescale-label-small font-semibold mb-1 opacity-80" style="margin: 0 0 0.25rem 0;">💡 Wichtiger Hinweis</p>
              <p class="md-typescale-body-small" style="margin: 0;" x-text="training.anmerkung"></p>
            </div>

            <!-- Action button with correct color -->
            <div x-show="training.link" class="mt-3">
              <a :href="training.link" target="_blank" rel="noopener noreferrer"
                 class="md-location-action-btn"
                 style="color: white !important;">
                <span style="color: white !important;">Jetzt anmelden</span>
                <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 5l7 7m0 0l-7 7m7-7H3"/>
                </svg>
              </a>
            </div>
          </div>
        </template>
      </div>
    </div>
  `}function ht(r,t){return`
    <div class="md-map-popup">
      <!-- Header with gradient background -->
      <div class="md-map-popup-header">
        <div class="md-map-popup-icon">🥋</div>
        <div class="md-map-popup-title">
          <h3 class="md-typescale-title-medium font-bold">${r.training}</h3>
        </div>
      </div>

      <!-- Body content -->
      <div class="md-map-popup-body">
        <!-- Info grid with icons -->
        <div class="md-map-popup-info-grid">
          <div class="md-map-popup-info-icon">📅</div>
          <div class="md-map-popup-info-value">
            <span class="md-typescale-body-medium font-medium">${r.wochentag}</span>
          </div>

          <div class="md-map-popup-info-icon">🕐</div>
          <div class="md-map-popup-info-value">
            <span class="md-typescale-body-medium font-medium">${t.formatZeitrange(r.von,r.bis)}</span>
          </div>

          <div class="md-map-popup-info-icon">📍</div>
          <div class="md-map-popup-info-value">
            <span class="md-typescale-body-medium">${r.ort}</span>
          </div>

          ${r.adresse?`
            <div class="md-map-popup-info-icon">🏠</div>
            <div class="md-map-popup-info-value">
              <span class="md-typescale-body-small">${r.adresse}</span>
            </div>
          `:""}

          <div class="md-map-popup-info-icon">👥</div>
          <div class="md-map-popup-info-value">
            <span class="md-typescale-body-medium">${t.formatAlter(r)}</span>
          </div>

          <div class="md-map-popup-info-icon">👤</div>
          <div class="md-map-popup-info-value">
            <span class="md-typescale-body-medium">${r.trainer}</span>
          </div>

          <div class="md-map-popup-info-icon">${r.probetraining==="ja"?"✅":"❌"}</div>
          <div class="md-map-popup-info-value">
            <span class="md-typescale-body-medium ${r.probetraining==="ja"?"font-semibold":""}"
                  style="color: ${r.probetraining==="ja"?"var(--color-primary-600)":"var(--md-sys-color-on-surface)"};">
              ${r.probetraining==="ja"?"Probetraining möglich":"Kein Probetraining"}
            </span>
          </div>
        </div>

        ${r.anmerkung?`
          <div class="md-map-popup-note">
            <p class="md-typescale-label-small font-semibold mb-1 opacity-80">💡 Wichtiger Hinweis</p>
            <p class="md-typescale-body-small">${r.anmerkung}</p>
          </div>
        `:""}

        ${r.distanceText?`
          <div class="md-map-popup-distance">
            <span class="md-typescale-body-medium">📏 ${r.distanceText} entfernt</span>
          </div>
        `:""}

        ${r.link?`
          <div class="md-map-popup-action">
            <a href="${r.link}" target="_blank" rel="noopener noreferrer" class="md-btn-filled no-underline" style="color: white !important;">
              <span style="color: white !important;">Jetzt anmelden</span>
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 5l7 7m0 0l-7 7m7-7H3"/>
              </svg>
            </a>
          </div>
        `:""}
      </div>
    </div>
  `}class pt{constructor(t,i){this.state=t,this.context=i}initializeMap(){if(this.context.map)return;if(!document.getElementById("map-view-container")){h("error","Map container not found");return}try{const i=this.loadMapState(),o=i?.center||g.map.defaultCenter,s=i?.zoom||g.map.defaultZoom;this.context.map=v.map("map-view-container",{center:o,zoom:s,zoomControl:!0,keyboard:!0,keyboardPanDelta:80,zoomAnimation:!0,zoomAnimationThreshold:4,fadeAnimation:!0,markerZoomAnimation:!0,inertia:!0,inertiaDeceleration:3e3,inertiaMaxSpeed:1500,scrollWheelZoom:!0,smoothWheelZoom:!0,smoothSensitivity:1}),this.context.map.on("moveend",()=>{this.saveMapState()}),this.addKeyboardNavigation(),this.addScreenReaderSupport(),this.createTileLayers(),this.addCustomControls(),this.addMarkersToMap(),h("info","Map initialized")}catch(i){h("error","Map initialization failed",i)}}addKeyboardNavigation(){if(!this.context.map)return;const t=this.context.map,i=t.getContainer();i.setAttribute("tabindex","0"),i.setAttribute("role","application"),i.setAttribute("aria-label","Interaktive Karte mit Trainingsstandorten. Verwenden Sie die Pfeiltasten zum Verschieben, Plus und Minus zum Zoomen, und die Tab-Taste um zwischen Markern zu navigieren."),t.on("keydown",o=>{switch(o.originalEvent.key){case"+":case"=":t.zoomIn(),o.originalEvent.preventDefault();break;case"-":case"_":t.zoomOut(),o.originalEvent.preventDefault();break;case"Home":t.setView(g.map.defaultCenter,g.map.defaultZoom,{animate:!0}),o.originalEvent.preventDefault();break;case"End":if(this.context.markers.length>0){const e=this.context.markers.map(n=>n.getLatLng());t.fitBounds(e,{padding:[50,50]})}o.originalEvent.preventDefault();break}}),h("debug","Keyboard navigation enabled")}addScreenReaderSupport(){if(!this.context.map)return;const t=this.context.map,i=document.createElement("div");i.setAttribute("aria-live","polite"),i.setAttribute("aria-atomic","true"),i.setAttribute("class","sr-only"),i.setAttribute("id","map-announcements"),t.getContainer().appendChild(i),this.context.ariaLiveRegion=i,t.on("zoomend",()=>{const o=t.getZoom();this.announceToScreenReader(`Zoom-Stufe ${o}`)}),t.on("layeradd",()=>{if(this.context.markers.length>0){const o=this.context.markers.length;this.announceToScreenReader(`${o} Trainingsstandorte auf der Karte angezeigt`)}}),h("debug","Screen reader support enabled")}announceToScreenReader(t){this.context.ariaLiveRegion&&(this.context.ariaLiveRegion.textContent="",setTimeout(()=>{this.context.ariaLiveRegion&&(this.context.ariaLiveRegion.textContent=t)},100))}createTileLayers(){if(!this.context.map)return;const t={maxZoom:g.map.maxZoom||19,minZoom:g.map.minZoom||10,detectRetina:!0,updateWhenIdle:!1,updateInterval:150,keepBuffer:2,bounds:[[47.9,11.3],[48.3,11.9]],errorTileUrl:""},i=v.tileLayer(g.map.tileLayerUrl,{...t,attribution:g.map.attribution,className:"md-map-tiles md-map-tiles-street"}),o=v.tileLayer("https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",{...t,attribution:"Tiles &copy; Esri &mdash; Source: Esri, i-cubed, USDA, USGS, AEX, GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EGP, and the GIS User Community",className:"md-map-tiles md-map-tiles-satellite"}),s=v.tileLayer("https://{s}.tile.opentopomap.org/{z}/{x}/{y}.png",{...t,maxZoom:17,attribution:"Map data: &copy; OpenStreetMap contributors, SRTM | Map style: &copy; OpenTopoMap (CC-BY-SA)",className:"md-map-tiles md-map-tiles-terrain"});this.context.tileLayers={street:i,satellite:o,terrain:s},i.addTo(this.context.map),this.context.tileLayer=i,Object.values(this.context.tileLayers).forEach(e=>{e.on("tileerror",n=>{h("warn","Tile loading error",{coords:n.coords})})}),h("debug","Tile layers created")}addCustomControls(){if(!this.context.map)return;if(this.context.tileLayers){const i=st({position:"topright",layers:this.context.tileLayers,defaultLayer:"street"});this.context.map.addControl(i),this.context.layerControl=i}if(g.features?.enableGeolocation){const i=ot({position:"topright"});this.context.map.addControl(i),this.context.geolocationControl=i}const t=at({position:"topright",center:g.map.defaultCenter,zoom:g.map.defaultZoom});this.context.map.addControl(t),this.context.resetControl=t,h("debug","Custom controls added")}addMarkersToMap(){if(!this.context.map)return;const t=this.context.map;if(this.context.markerClusterGroup&&(t.removeLayer(this.context.markerClusterGroup),this.context.markerClusterGroup=null),this.context.markers=[],typeof v.markerClusterGroup!="function"){h("error","Leaflet.markercluster not available - check imports in main.js"),this.addMarkersWithoutClustering();return}this.addMarkersWithClustering()}addMarkersWithClustering(){if(!this.context.map)return;const t=this.context.map;this.context.markerClusterGroup&&(t.removeLayer(this.context.markerClusterGroup),this.context.markerClusterGroup=null),this.context.markers=[];const i=lt(),o=ct(),s=v.markerClusterGroup({chunkedLoading:!0,chunkInterval:200,chunkDelay:50,removeOutsideVisibleBounds:!1,maxClusterRadius:i,spiderfyOnMaxZoom:!0,showCoverageOnHover:!1,zoomToBoundsOnClick:!0,disableClusteringAtZoom:18,animateAddingMarkers:!1,spiderfyDistanceMultiplier:o,animate:!0,singleMarkerMode:!1,iconCreateFunction:l=>{const c=l.getChildCount();let d=50,u=16,p="md-map-cluster-small";return c>=100?(d=70,u=22,p="md-map-cluster-xlarge"):c>=50?(d=65,u=20,p="md-map-cluster-large"):c>=10&&(d=55,u=18,p="md-map-cluster-medium"),v.divIcon({html:`<div class="md-map-cluster ${p}">
                   <span class="md-map-cluster-count" style="font-size: ${u}px">${c}</span>
                 </div>`,className:"md-map-cluster-wrapper",iconSize:v.point(d,d)})}}),e=[],n=[];ut(this.context.filteredTrainings).forEach((l,c)=>{const[d,u]=c.split(",").map(Number),p=l.length,f=l[0].ort,_=this.createLocationIcon(p,l),m=v.marker([d,u],{icon:_,title:p>1?`${f} (${p} Trainings)`:`${l[0].training} - ${f}`,alt:`Standort: ${f}`,riseOnHover:!0});m.locationTrainings=l,m.trainingId=l[0].id;const b=p>1?dt(l):this.createMapPopup(l[0]);m.bindPopup(b,{maxWidth:p>1?450:400,className:"md-map-popup-container",autoPan:!1,autoPanPadding:[50,50]}),m.on("click",y=>{this.centerOnMarker(y.latlng,p>1)}),e.push(m),n.push([d,u])}),s.addLayers(e),this.context.markers=e,t.addLayer(s),this.context.markerClusterGroup=s,n.length>0&&!this.context.userHasInteractedWithMap&&t.fitBounds(n,{padding:[50,50]}),t.once("movestart",()=>{this.context.userHasInteractedWithMap=!0}),h("info",`Added ${e.length} markers to map with clustering`)}addMarkersWithoutClustering(){if(!this.context.map)return;const t=this.context.map,i=[];this.context.filteredTrainings.forEach(o=>{if(!o.lat||!o.lng)return;const s=v.marker([o.lat,o.lng],{title:`${o.training} - ${o.ort}`,alt:`Standort: ${o.ort}`,riseOnHover:!0});s.bindPopup(this.createMapPopup(o),{maxWidth:400,className:"md-map-popup-container",autoPan:!1}),s.addTo(t),this.context.markers.push(s),i.push([o.lat,o.lng])}),i.length>0&&!this.context.userHasInteractedWithMap&&t.fitBounds(i,{padding:[50,50]}),t.once("movestart",()=>{this.context.userHasInteractedWithMap=!0}),h("info",`Added ${this.context.markers.length} markers without clustering`)}zoomToFavorites(){if(!this.context.map){h("warn","Map not initialized - cannot zoom to favorites");return}const t=this.context.allTrainings.filter(s=>this.context.favorites.includes(s.id)&&s.lat&&s.lng);if(t.length===0){h("info","No favorites with coordinates found"),this.announceToScreenReader("Keine Favoriten mit Standorten gefunden"),this.context.map.setView(g.map.defaultCenter,g.map.defaultZoom,{animate:!0,duration:1});return}const i=t.map(s=>[s.lat,s.lng]);this.context.map.fitBounds(i,{padding:[80,80],maxZoom:15,animate:!0,duration:1.2}),this.context.userHasInteractedWithMap=!0;const o=t.length;this.announceToScreenReader(`Karte zeigt ${o} Favoriten-Standort${o>1?"e":""}`),h("info",`Zoomed to ${o} favorite locations`)}zoomToTraining(t){const i=this.context.allTrainings.find(o=>o.id===t);if(!i||!i.lat||!i.lng){h("warn",`Training ${t} not found or has no coordinates`);return}this.context.$store.ui.activeView!=="map"&&(this.context.$store.ui.activeView="map"),this.context.$nextTick(()=>{this.context.map||this.initializeMap(),this.context.$nextTick(()=>{const o=this.context.map;if(!o)return;const s=this.context.markers.find(e=>e.trainingId===t);if(s){const e=o.getZoom(),n=17,a=Math.abs(n-e),l=Math.min(1.5,.5+a*.1);o.flyTo([i.lat,i.lng],n,{duration:l,easeLinearity:.2,animate:!0}),this._addZoomHighlight([i.lat,i.lng]),setTimeout(()=>{s.openPopup(),this.announceToScreenReader(`Zu ${i.training} in ${i.ort} gezoomt`)},l*1e3+100),h("info",`Zoomed to training ${t} at ${i.ort}`)}else o.flyTo([i.lat,i.lng],17,{duration:1,easeLinearity:.2,animate:!0}),h("warn",`Marker for training ${t} not found, centered on coordinates`);this.context.userHasInteractedWithMap=!0})})}createLocationIcon(t,i=[]){const s=i[0]?.training?.toLowerCase()||"fam",e={parkour:"#0d47a1",trampolin:"#194d1b",tricking:"#4a148c",movement:"#8d2600",fam:"#880e4f"};let n=e.fam;for(const[d,u]of Object.entries(e))if(s.includes(d)){n=u;break}const a=t>1?Math.min(50,35+t*2):40,l=Math.min(18,12+t*.5),c=t>1;return v.divIcon({html:`
        <div class="md-location-marker">
          <div class="md-location-pin">
            <svg width="36" height="48" viewBox="0 0 36 48" fill="none" xmlns="http://www.w3.org/2000/svg">
              <!-- Pin shadow -->
              <ellipse cx="18" cy="46" rx="8" ry="2" fill="rgba(0,0,0,0.2)"/>
              <!-- Pin body with training type color -->
              <path d="M18 0C8.059 0 0 8.059 0 18c0 13.5 18 30 18 30s18-16.5 18-30c0-9.941-8.059-18-18-18z"
                    fill="${n}"/>
              <!-- Pin center circle -->
              <circle cx="18" cy="18" r="10" fill="white"/>
              <!-- Training type initial/icon -->
              <text x="18" y="22" text-anchor="middle" font-size="12" font-weight="bold" fill="${n}">
                ${s.charAt(0).toUpperCase()}
              </text>
            </svg>
          </div>
          ${c?`<div class="md-location-badge" style="font-size: ${l}px; background-color: ${n};">${t}</div>`:""}
        </div>
      `,className:"md-location-marker-wrapper",iconSize:[a,a+12],iconAnchor:[a/2,a+12],popupAnchor:[0,-(a+12)]})}centerOnMarker(t,i=!1){if(!this.context.map)return;const o=this.context.map,s=o.getSize().y,n=o.getSize().x/2,a=s*.7,l=o.latLngToContainerPoint(t),c=l.x-n,d=l.y-a;o.panBy([c,d],{animate:!0,duration:.5,easeLinearity:.25}),h("debug",`Centered on marker at ${t.lat}, ${t.lng}`)}createMapPopup(t){return ht(t,k)}_addZoomHighlight(t){if(!this.context.map)return;const i=v.circleMarker(t,{radius:50,fillColor:"var(--color-primary-500)",color:"var(--color-primary-600)",weight:2,opacity:.6,fillOpacity:.2,className:"zoom-highlight"}).addTo(this.context.map);let o=50,s=.6;const e=setInterval(()=>{o+=5,s-=.05,s<=0?(clearInterval(e),this.context.map.removeLayer(i)):(i.setRadius(o),i.setStyle({opacity:s,fillOpacity:s*.3}))},50)}addUserLocationMarker(t){this.context.map&&(this.context.userLocationMarker&&(this.context.map.removeLayer(this.context.userLocationMarker),this.context.userLocationMarker=null),this.context.userLocationMarker=v.marker(t,{icon:v.divIcon({className:"md-user-location-marker",html:'<div class="pulse"></div>',iconSize:[24,24],iconAnchor:[12,12]}),title:"Mein Standort",zIndexOffset:1e3}),this.context.userLocationMarker.addTo(this.context.map),h("info","User location marker added to map",t))}cleanupMap(){if(!this.context.map)return;const t=this.context.map;try{t.stop(),t.off(),this.context.tileLayer&&(this.context.tileLayer.off(),t.removeLayer(this.context.tileLayer),this.context.tileLayer=null),this.context.markerClusterGroup&&(this.context.markerClusterGroup.off(),t.removeLayer(this.context.markerClusterGroup),this.context.markerClusterGroup.clearLayers(),this.context.markerClusterGroup=null),this.context.markers.forEach(i=>{i.off(),i.unbindPopup(),t.removeLayer(i),i.trainingId=null}),this.context.markers=[],this.context.ariaLiveRegion&&(this.context.ariaLiveRegion.remove(),this.context.ariaLiveRegion=null),this.context.layerControl&&(t.removeControl(this.context.layerControl),this.context.layerControl=null),this.context.geolocationControl&&(t.removeControl(this.context.geolocationControl),this.context.geolocationControl=null),this.context.resetControl&&(t.removeControl(this.context.resetControl),this.context.resetControl=null),this.context.tileLayers&&(Object.values(this.context.tileLayers).forEach(i=>{i.off(),t.hasLayer(i)&&t.removeLayer(i)}),this.context.tileLayers=null),t.eachLayer(i=>{i.off(),t.removeLayer(i)}),t.remove(),this.context.map=null,this.context.userHasInteractedWithMap=!1,h("info","Map cleaned up successfully")}catch(i){h("error","Map cleanup error",i)}}saveMapState(){if(this.context.map)try{const t=this.context.map.getCenter(),i=this.context.map.getZoom(),o={center:[t.lat,t.lng],zoom:i,timestamp:Date.now()};localStorage.setItem("fam_map_state",JSON.stringify(o)),h("debug","Map state saved",o)}catch(t){h("warn","Failed to save map state",t)}}loadMapState(){try{const t=localStorage.getItem("fam_map_state");if(!t)return null;const i=JSON.parse(t),o=10080*60*1e3;if(Date.now()-i.timestamp>o)return localStorage.removeItem("fam_map_state"),null;const[s,e]=i.center;return s<-90||s>90||e<-180||e>180?null:(h("debug","Map state loaded",i),{center:i.center,zoom:i.zoom})}catch(t){return h("warn","Failed to load map state",t),null}}}class ft{constructor(t,i,o){this.state=t,this.context=i,this.addDistanceToTrainings=o.addDistanceToTrainings,this.applyFilters=o.applyFilters,this.startUpdateCheck=o.startUpdateCheck}async init(){this.context.loading=!0,this.context.error=null;try{const t=this.getCachedData();t&&(this.loadData(t),this.context.fromCache=!0);const i=await fetch(g.jsonUrl+"?_="+Date.now());if(!i.ok){if(t){h("warn","Network error, using cache");return}throw new Error(`HTTP ${i.status}: File not found`)}const o=await i.json();if(!o.version||!o.trainings||!Array.isArray(o.trainings))throw new Error("Invalid data format");const s=k.generateHash(JSON.stringify(o.trainings)),e=t?k.generateHash(JSON.stringify(t.trainings)):null;s!==e&&(h("info","New data available, updating..."),this.loadData(o),this.setCachedData(o),this.context.fromCache=!1),g.features.enableUpdateCheck&&this.startUpdateCheck()}catch(t){h("error","Failed to load trainings",t),this.context.error=t instanceof Error?t.message:String(t)}finally{this.context.loading=!1}}loadData(t){this.context.allTrainings=t.trainings||[],this.context.metadata=t.metadata||null,this.context.fuse=new ye(this.context.allTrainings,g.search.fuseOptions),this.state.userPosition&&this.addDistanceToTrainings(),this.applyFilters(),h("info","Data loaded",{trainings:this.context.allTrainings.length,fromCache:this.context.fromCache})}getCachedData(){if(!g.cacheEnabled)return null;try{const t=localStorage.getItem(g.cacheKey);if(!t)return null;const i=JSON.parse(t);return Date.now()-i.timestamp>g.cacheDuration?(localStorage.removeItem(g.cacheKey),null):i.data}catch(t){return h("error","Cache read failed",t),null}}setCachedData(t){if(g.cacheEnabled)try{const i={timestamp:Date.now(),data:t};localStorage.setItem(g.cacheKey,JSON.stringify(i))}catch(i){h("error","Cache write failed",i)}}startUpdateCheckInternal(){this.state.updateCheckInterval||(this.state.updateCheckInterval=setInterval(()=>{this.checkForUpdates()},g.pwa.updateCheckInterval))}async checkForUpdates(){try{const i=await(await fetch(g.versionUrl+"?_="+Date.now())).json();i.version&&i.version!==g.pwa.version&&(this.context.updateAvailable=!0,this.context.latestVersion=i.version,h("info","Update available",{version:i.version}))}catch(t){h("error","Update check failed",t)}}}const T=Object.freeze({GOOGLE:"google",OUTLOOK:"outlook",OFFICE365:"office365",YAHOO:"yahoo",APPLE:"apple",ICAL:"ical"}),mt="https://calendar.google.com/calendar/render",gt="https://outlook.live.com/calendar/0/deeplink/compose",_t="https://outlook.office.com/calendar/0/deeplink/compose",vt="https://calendar.yahoo.com/";function Y(r){try{const{start:t,end:i}=z(r),o=new URLSearchParams({action:"TEMPLATE",text:U(r),dates:yt(t,i),details:R(r),location:G(r),trp:"true"}),s=`${mt}?${o.toString()}`;return h("debug","[calendar] Google Calendar URL created",{training:r.id}),s}catch(t){throw h("error","[calendar] Failed to create Google Calendar URL",t),t}}function yt(r,t){const i=o=>o.toISOString().replace(/[-:]/g,"").replace(/\.\d{3}/,"");return`${i(r)}/${i(t)}`}function ne(r){try{const{start:t,end:i}=z(r),o=new URLSearchParams({path:"/calendar/action/compose",rru:"addevent",subject:U(r),startdt:t.toISOString(),enddt:i.toISOString(),body:R(r),location:G(r)}),s=`${gt}?${o.toString()}`;return h("debug","[calendar] Outlook Calendar URL created",{training:r.id}),s}catch(t){throw h("error","[calendar] Failed to create Outlook Calendar URL",t),t}}function oe(r){try{const{start:t,end:i}=z(r),o=new URLSearchParams({path:"/calendar/action/compose",rru:"addevent",subject:U(r),startdt:t.toISOString(),enddt:i.toISOString(),body:R(r),location:G(r)}),s=`${_t}?${o.toString()}`;return h("debug","[calendar] Office 365 Calendar URL created",{training:r.id}),s}catch(t){throw h("error","[calendar] Failed to create Office 365 Calendar URL",t),t}}function ae(r){try{const{start:t,end:i}=z(r),o=new URLSearchParams({v:"60",title:U(r),st:ee(t),et:ee(i),desc:R(r),in_loc:G(r)}),s=`${vt}?${o.toString()}`;return h("debug","[calendar] Yahoo Calendar URL created",{training:r.id}),s}catch(t){throw h("error","[calendar] Failed to create Yahoo Calendar URL",t),t}}function ee(r){return r.toISOString().replace(/[-:]/g,"").replace(/\.\d{3}/,"")}async function se(r,t={}){const{maxBulk:i=10,delay:o=600,onProgress:s=null}=t;if(!Array.isArray(r)||r.length===0)return{success:!1,message:"Keine Trainings zum Exportieren",exported:0,total:0,errors:null};const e=r.slice(0,i);let n=0;const a=[];try{for(let c=0;c<e.length;c++)try{const d=Y(e[c]);if(!window.open(d,"_blank"))throw new Error("Popup blocked");n++,s&&s({current:c+1,total:e.length,training:e[c]}),c<e.length-1&&await new Promise(p=>setTimeout(p,o))}catch(d){const u=d instanceof Error?d.message:String(d);a.push({training:e[c],error:u}),h("error","[calendar] Bulk export error for training",{training:e[c].id,error:d})}const l={success:n>0,message:`${n} von ${e.length} Trainings exportiert`,exported:n,total:e.length,errors:a.length>0?a:null};return h("info","[calendar] Bulk export completed",l),l}catch(l){return h("error","[calendar] Bulk export failed",l),{success:!1,message:"Export fehlgeschlagen",exported:n,total:e.length,errors:a.length>0?a:null}}}async function wt(r,t=T.GOOGLE,i={}){if(!{[T.GOOGLE]:Y,[T.OUTLOOK]:ne,[T.OFFICE365]:oe,[T.YAHOO]:ae}[t])throw new Error(`Unsupported calendar provider: ${t}`);return se(r,i)}function z(r){const t=N(r.wochentag);if(!t)throw new Error("Invalid weekday");const[i,o]=r.von.split(":").map(Number),[s,e]=r.bis.split(":").map(Number),n=new Date(t);n.setHours(i,o,0,0);const a=new Date(t);return a.setHours(s,e,0,0),{start:n,end:a}}function U(r){return`${r.training} - ${r.ort}`}function R(r){const t=[];return t.push(`🏃 ${r.training} Training`),t.push(""),r.altersgruppe&&t.push(`👥 Altersgruppe: ${r.altersgruppe}`),r.trainer&&t.push(`👤 Trainer: ${r.trainer}`),r.anmerkung&&(t.push(""),t.push(`ℹ️ ${r.anmerkung}`)),r.link&&(t.push(""),t.push(`📝 Anmeldung: ${r.link}`)),t.push(""),t.push("---"),t.push("🗓️ Erstellt mit FAM Trainingsplan"),t.push("🔗 https://trainingsplan.freeartsofmovement.com"),t.join(`
`)}function G(r){return r.adresse?`${r.ort}, ${r.adresse}`:r.ort||""}function Lt(r,t=null){try{const i=Q(r);if(!i)throw new Error("Failed to create iCal event");const o=new Blob([i],{type:"text/calendar;charset=utf-8"}),s=window.URL.createObjectURL(o),e=document.createElement("a");return e.href=s,e.download=t||`training-${r.id}.ics`,document.body.appendChild(e),e.click(),document.body.removeChild(e),window.URL.revokeObjectURL(s),h("debug","[calendar] iCal file downloaded",{training:r.id}),{success:!0,message:"Kalenderdatei heruntergeladen"}}catch(i){return h("error","[calendar] Failed to download iCal file",i),{success:!1,message:"Download fehlgeschlagen",error:i}}}function bt(r,t="trainings.ics"){try{if(!Array.isArray(r)||r.length===0)throw new Error("No trainings provided");const i=r.map(a=>Q(a)).filter(Boolean);if(i.length===0)throw new Error("No valid events created");const o=["BEGIN:VCALENDAR","VERSION:2.0","PRODID:-//FAM Trainingsplan//NONSGML v1.0//EN","CALSCALE:GREGORIAN","METHOD:PUBLISH","X-WR-CALNAME:FAM Trainingsplan","X-WR-TIMEZONE:Europe/Berlin",...i.map(a=>(a||"").split(`
`).slice(2,-2).join(`
`)),"END:VCALENDAR"].join(`
`),s=new Blob([o],{type:"text/calendar;charset=utf-8"}),e=window.URL.createObjectURL(s),n=document.createElement("a");return n.href=e,n.download=t,document.body.appendChild(n),n.click(),document.body.removeChild(n),window.URL.revokeObjectURL(e),h("info","[calendar] iCal bundle downloaded",{count:r.length}),{success:!0,message:`${r.length} Trainings heruntergeladen`,count:r.length}}catch(i){return h("error","[calendar] Failed to download iCal bundle",i),{success:!1,message:"Download fehlgeschlagen",error:i}}}function Ct(){const r=navigator.userAgent.toLowerCase(),t=navigator.platform.toLowerCase();return/iphone|ipad|ipod|mac/.test(r)||/mac/.test(t)?T.APPLE:/windows/.test(r)||/win/.test(t)?T.OUTLOOK:(/android/.test(r),T.GOOGLE)}function xt(r){return{[T.GOOGLE]:"Google Calendar",[T.OUTLOOK]:"Outlook Calendar",[T.OFFICE365]:"Office 365 Calendar",[T.YAHOO]:"Yahoo Calendar",[T.APPLE]:"Apple Calendar",[T.ICAL]:"iCal"}[r]||r}const O={createGoogleCalendarUrl:Y,createOutlookCalendarUrl:ne,createOffice365CalendarUrl:oe,createYahooCalendarUrl:ae,bulkAddToGoogleCalendar:se,bulkAddToCalendar:wt,downloadICalFile:Lt,downloadICalBundle:bt,detectCalendarProvider:Ct,getCalendarProviderName:xt,providers:T};class kt{constructor(t,i,o){this.state=t,this.context=i,this.dependencies=o}get hasActiveFilters(){return this.dependencies.hasActiveFilters}get filteredTrainingsCount(){return this.dependencies.filteredTrainingsCount}addToGoogleCalendar(t){try{const i=O.createGoogleCalendarUrl(t);window.open(i,"_blank"),this.context.$store.ui.showNotification(`${t.training} zu Google Calendar hinzugef�gt`,"success",3e3),h("info","[trainingsplaner] Added to Google Calendar",{training:t.id})}catch(i){h("error","[trainingsplaner] Failed to add to Google Calendar",i),this.context.$store.ui.showNotification("Fehler beim �ffnen von Google Calendar","error",3e3)}}addToCalendar(t,i=null){const o=i||O.detectCalendarProvider();try{let s;switch(o){case"google":s=O.createGoogleCalendarUrl(t);break;case"outlook":s=O.createOutlookCalendarUrl(t);break;case"office365":s=O.createOffice365CalendarUrl(t);break;case"yahoo":s=O.createYahooCalendarUrl(t);break;case"apple":case"ical":O.downloadICalFile(t),this.context.$store.ui.showNotification("Kalenderdatei heruntergeladen","success",3e3);return;default:throw new Error(`Unknown provider: ${o}`)}s&&(window.open(s,"_blank"),this.context.$store.ui.showNotification(`Zu ${O.getCalendarProviderName(o)} hinzugef�gt`,"success",3e3)),h("info","[trainingsplaner] Added to calendar",{training:t.id,provider:o})}catch(s){h("error","[trainingsplaner] Failed to add to calendar",s),this.context.$store.ui.showNotification("Fehler beim �ffnen des Kalenders","error",3e3)}}async bulkAddToGoogleCalendar(){if(this.context.filteredTrainings.length===0){this.context.$store.ui.showNotification("Keine Trainings zum Exportieren","warning",3e3);return}try{this.context.$store.ui.showNotification(`Exportiere ${this.context.filteredTrainings.length} Trainings...`,"info",2e3);const t=await O.bulkAddToGoogleCalendar(this.context.filteredTrainings,{maxBulk:10,delay:600,onProgress:({current:i,total:o})=>{h("debug","[trainingsplaner] Bulk export progress",{current:i,total:o})}});t.success?this.context.$store.ui.showNotification(` ${t.exported} von ${t.total} Trainings zu Google Calendar hinzugef�gt`,"success",5e3):this.context.$store.ui.showNotification(t.message,"error",5e3),h("info","[trainingsplaner] Bulk Google Calendar export",t)}catch(t){h("error","[trainingsplaner] Bulk Google Calendar export failed",t),this.context.$store.ui.showNotification("Fehler beim Bulk-Export. Bitte versuche den .ics Export.","error",5e3)}}async exportAllToCalendar(){if(this.context.filteredTrainings.length===0){this.context.$store.ui.showNotification("Keine Trainings zum Exportieren","warning",3e3);return}try{const t=k.createICalBundle(this.context.filteredTrainings),i=`fam-trainings-${Date.now()}.ics`;k.downloadICalFile(t,i),this.context.$store.ui.showNotification(`${this.context.filteredTrainings.length} Trainings exportiert! <�`,"success",3e3),h("info","Bulk calendar export",{count:this.context.filteredTrainings.length})}catch(t){h("error","Bulk export failed",t),this.context.$store.ui.showNotification("Export fehlgeschlagen. Bitte versuchen Sie es erneut.","error",5e3)}}async exportFavoritesToCalendar(){const t=this.context.allTrainings.filter(i=>this.context.favorites.includes(i.id));if(t.length===0){this.context.$store.ui.showNotification("Keine Favoriten zum Exportieren","warning",3e3);return}try{const i=k.createICalBundle(t),o=`fam-favoriten-${Date.now()}.ics`;k.downloadICalFile(i,o),this.context.$store.ui.showNotification(`${t.length} Favoriten exportiert! P`,"success",3e3)}catch(i){h("error","Favorites export failed",i),this.context.$store.ui.showNotification("Export fehlgeschlagen.","error",5e3)}}async shareCurrentView(){const t=this.context.$store.ui.filters,i=k.createShareLink(t),o=this.hasActiveFilters,s=this.filteredTrainingsCount,e={title:"FAM Trainingsplan",text:o?`${s} Trainings gefunden - Schau dir diese an!`:"Entdecke alle FAM Trainings in M�nchen!",url:i};try{if(navigator.share&&navigator.canShare&&navigator.canShare(e))await navigator.share(e),h("info","View shared via native API");else if(await k.copyToClipboard(i))this.context.$store.ui.showNotification("Link in Zwischenablage kopiert! =�","success",3e3);else throw new Error("Clipboard write failed")}catch(n){n instanceof Error&&n.name!=="AbortError"&&(h("error","Share failed",n),this.context.$store.ui.showNotification("Teilen fehlgeschlagen.","error",3e3))}}async shareFavorites(){if(this.context.favorites.length===0){this.context.$store.ui.showNotification("Keine Favoriten zum Teilen","warning",3e3);return}const i=`${window.location.origin+window.location.pathname}?favorites=true`,s={title:"FAM Trainingsplan - Meine Favoriten",text:`Schau dir meine ${this.context.favorites.length} Lieblings-Trainings an!`,url:i};try{if(navigator.share&&navigator.canShare&&navigator.canShare(s))await navigator.share(s),h("info","Favorites shared via native API");else if(await k.copyToClipboard(i))this.context.$store.ui.showNotification("Favoriten-Link in Zwischenablage kopiert!","success",3e3);else throw new Error("Clipboard write failed")}catch(e){e instanceof Error&&e.name!=="AbortError"&&(h("error","Share favorites failed",e),this.context.$store.ui.showNotification("Teilen fehlgeschlagen.","error",3e3))}}}const Mt={heute:{label:"Heute",category:"zeit",color:"primary",apply:(r,t)=>{const o=["Sonntag","Montag","Dienstag","Mittwoch","Donnerstag","Freitag","Samstag"][new Date().getDay()];r._customTimeFilter="",r.wochentag=o,r.activeQuickFilter="heute"}},morgen:{label:"Morgen",category:"zeit",color:"primary",apply:(r,t)=>{const o=["Sonntag","Montag","Dienstag","Mittwoch","Donnerstag","Freitag","Samstag"][(new Date().getDay()+1)%7];r._customTimeFilter="",r.wochentag=o,r.activeQuickFilter="morgen"}},wochenende:{label:"Wochenende",category:"zeit",color:"primary",customFilter:!0,apply:(r,t)=>{r.wochentag="",r.activeQuickFilter="wochenende",r._customTimeFilter="wochenende"}},wochentags:{label:"Wochentags",category:"zeit",color:"primary",customFilter:!0,apply:(r,t)=>{r.wochentag="",r.activeQuickFilter="wochentags",r._customTimeFilter="wochentags"}},probetraining:{label:"Probetraining",category:"feature",color:"green",customFilter:!0,apply:(r,t)=>{r.activeQuickFilter="probetraining",r._customFeatureFilter="probetraining"}},inMeinerNaehe:{label:"In meiner Nähe",category:"ort",color:"blue",requiresGeolocation:!0,customFilter:!0,apply:(r,t)=>{t.userPosition&&(r.ort="",r.activeQuickFilter="inMeinerNaehe",r._customLocationFilter="inMeinerNaehe")}},favoriten:{label:"Favoriten",category:"persoenlich",color:"yellow",customFilter:!0,apply:(r,t)=>{r.wochentag="",r.ort="",r.training="",r.altersgruppe="",r.searchTerm="",r._customTimeFilter="",r._customFeatureFilter="",r._customLocationFilter="",r.activeQuickFilter="favoriten",r._customPersonalFilter="favoriten"}}};function Tt(){const r=Ye(),t={allTrainings:r.allTrainings,filteredTrainings:r.filteredTrainings,favorites:r.favorites,metadata:r.metadata,fuse:r.fuse,loading:r.loading,error:r.error,fromCache:r.fromCache,userPosition:r.userPosition,geolocationError:r.geolocationError,map:r.map,markers:r.markers,markerClusterGroup:r.markerClusterGroup,userHasInteractedWithMap:r.userHasInteractedWithMap,updateCheckInterval:r.updateCheckInterval,updateAvailable:r.updateAvailable,latestVersion:r.latestVersion,searchTimeout:r.searchTimeout,wochentagOrder:r.wochentagOrder};return Object.defineProperties(t,{wochentage:{get(){const i=["Montag","Dienstag","Mittwoch","Donnerstag","Freitag","Samstag","Sonntag"];return[...this.metadata?.wochentage||i].sort((s,e)=>{const n=i.indexOf(s),a=i.indexOf(e);return n===-1&&a===-1?s.localeCompare(e):n===-1?1:a===-1?-1:n-a})},enumerable:!0},orte:{get(){return this.metadata?.orte||k.extractUnique(this.allTrainings,"ort")},enumerable:!0},trainingsarten:{get(){return this.metadata?.trainingsarten||k.extractUnique(this.allTrainings,"training")},enumerable:!0},altersgruppen:{get(){const i=["Minis","Kids","Teens","Adults"];if(this.metadata?.altersgruppen)return[...this.metadata.altersgruppen].sort((e,n)=>{const a=i.indexOf(e),l=i.indexOf(n);return a===-1&&l===-1?e.localeCompare(n):a===-1?1:l===-1?-1:a-l});const o=this.allTrainings.map(e=>e.altersgruppe).filter(e=>e&&String(e).trim()!==""),s=[];return o.forEach(e=>{String(e).split(",").forEach(n=>{const a=n.trim();a&&!s.includes(a)&&s.push(a)})}),s.sort((e,n)=>{const a=i.indexOf(e),l=i.indexOf(n);return a===-1&&l===-1?e.localeCompare(n):a===-1?1:l===-1?-1:a-l})},enumerable:!0},groupedTrainings:{get(){const o=this.$store?.ui?.groupingMode||"wochentag",s={};this.filteredTrainings.forEach(n=>{let a;o==="ort"?a=n.ort||"Ohne Ort":a=n.wochentag||"Ohne Tag",s[a]||(s[a]=[]),s[a].push(n)});let e;return o==="ort"?e=Object.keys(s).sort((n,a)=>n.localeCompare(a)):e=Object.keys(s).sort((n,a)=>(this.wochentagOrder[n]||999)-(this.wochentagOrder[a]||999)),e.map(n=>({key:n,items:this.sortTrainings(s[n])}))},enumerable:!0},favoriteTrainings:{get(){return this.allTrainings.filter(i=>this.favorites.includes(i.id))},enumerable:!0},hasActiveFilters:{get(){const i=this.$store?.ui?.filters;return i?["wochentag","ort","training","altersgruppe","searchTerm"].reduce((o,s)=>i[s]?o+1:o,0)>0:!1},enumerable:!0},filteredTrainingsCount:{get(){return this.filteredTrainings.length},enumerable:!0}}),t.init=async function(){const i=this;this.urlFiltersManager=new Xe(i),this.filterEngine=new Je(r,i,{isFavorite:o=>this.favoritesManager.isFavorite(o),updateUrl:()=>this.urlFiltersManager.updateUrlWithFilters()}),this.favoritesManager=new et(r,i,{applyFilters:()=>this.filterEngine.applyFilters()}),this.mapManager=new pt(r,i),this.geolocationManager=new tt(r,i,{applyFilters:()=>this.filterEngine.applyFilters(),mapManager:this.mapManager}),this.dataLoader=new ft(r,i,{addDistanceToTrainings:()=>this.geolocationManager.addDistanceToTrainings(),applyFilters:()=>this.filterEngine.applyFilters(),startUpdateCheck:()=>this.dataLoader.startUpdateCheckInternal()}),this.actionsManager=new kt(r,i,{get hasActiveFilters(){return i.hasActiveFilters},get filteredTrainingsCount(){return i.filteredTrainingsCount}}),g.features.enableFavorites&&this.favoritesManager.loadFavorites(),g.filters.persistInUrl&&this.urlFiltersManager.loadFiltersFromUrl(),this.watchFilters(),window.addEventListener("keydown",o=>this.handleKeyboardShortcuts(o)),window.addEventListener("scroll",()=>{i.$store?.ui&&(i.$store.ui.showScrollTop=window.scrollY>500)},{passive:!0}),await this.dataLoader.init(),i.$store?.filterOptions&&(i.$store.filterOptions.wochentage=this.wochentage,i.$store.filterOptions.orte=this.orte,i.$store.filterOptions.trainingsarten=this.trainingsarten,i.$store.filterOptions.altersgruppen=this.altersgruppen)},t.watchFilters=function(){const i=this;let o=null;i.$watch("$store.ui.filters",()=>{o!==null&&clearTimeout(o),o=setTimeout(()=>{i.filterEngine.applyFilters(),i.$store?.ui?.activeView==="map"&&i.map&&i.$nextTick(()=>{i.mapManager.addMarkersToMap()})},100)},{deep:!0}),i.$watch("$store.ui.activeView",s=>{s==="map"&&i.$nextTick(()=>{i.map?i.map.invalidateSize():i.mapManager.initializeMap()})}),i.$store?.ui?.activeView==="map"&&i.$nextTick(()=>{i.map||i.mapManager.initializeMap()})},t.applyFilters=function(){return this.filterEngine.applyFilters()},t.matchesAltersgruppe=function(i,o){return this.filterEngine.matchesAltersgruppe(i,o)},t.loadFavorites=function(){return this.favoritesManager.loadFavorites()},t.isFavorite=function(i){return this.favoritesManager.isFavorite(i)},t.toggleFavorite=function(i){return this.favoritesManager.toggleFavorite(i)},t.quickFilterFavorites=function(){return this.favoritesManager.quickFilterFavorites()},t.quickFilterHeute=function(){const i=this;if(!i.$store?.ui?.filters)return;if(i.$store.ui.filters.activeQuickFilter==="heute")i.$store.ui.filters={wochentag:"",ort:"",training:"",altersgruppe:"",searchTerm:"",activeQuickFilter:null};else{const e=["Sonntag","Montag","Dienstag","Mittwoch","Donnerstag","Freitag","Samstag"][new Date().getDay()];i.$store.ui.filters.wochentag=e,i.$store.ui.filters.activeQuickFilter="heute"}this.applyFilters()},t.applyQuickFilter=async function(i){const o=this;if(!o.$store?.ui?.filters)return;const s=o.$store.ui.filters.activeQuickFilter,e=Mt[i];if(!e){console.warn(`Unknown quick filter: ${i}`);return}if(s===i){if(e.category==="zeit")o.$store.ui.filters.wochentag="",o.$store.ui.filters._customTimeFilter="";else if(e.category==="feature")o.$store.ui.filters._customFeatureFilter="";else if(e.category==="ort")o.$store.ui.filters._customLocationFilter="";else if(e.category==="persoenlich"){this.clearAllFilters();return}o.$store.ui.filters.activeQuickFilter=null,this.applyFilters();return}if(e.requiresGeolocation&&!this.userPosition){if(!await this.requestUserLocation()){o.$store.ui.showNotification('Standort-Zugriff benötigt für "In meiner Nähe" Filter',"warning",3e3);return}this.addDistanceToTrainings()}const n={allTrainings:this.allTrainings,favorites:this.favorites,userPosition:this.userPosition,applyFilters:()=>this.applyFilters()},a=e.apply(o.$store.ui.filters,n);Array.isArray(a)?this.filteredTrainings=a:this.applyFilters(),!window.matchMedia("(min-width: 1024px)").matches&&o.$store?.ui&&setTimeout(()=>{o.$store.ui.mobileFilterOpen=!1,setTimeout(()=>{const c=document.getElementById("main-content");c&&c.scrollIntoView({behavior:"smooth",block:"start"})},200)},150)},t.requestUserLocation=function(){return this.geolocationManager.requestUserLocation()},t.addDistanceToTrainings=function(){return this.geolocationManager.addDistanceToTrainings()},t.resetLocation=function(){return this.geolocationManager.resetLocation()},t.initializeMap=function(){return this.mapManager.initializeMap()},t.addMarkersToMap=function(){return this.mapManager.addMarkersToMap()},t.createMapPopup=function(i){return this.mapManager.createMapPopup(i)},t.cleanupMap=function(){return this.mapManager.cleanupMap()},t.zoomToFavorites=function(){return this.mapManager.zoomToFavorites()},t.loadFiltersFromUrl=function(){return this.urlFiltersManager.loadFiltersFromUrl()},t.updateUrlWithFilters=function(){return this.urlFiltersManager.updateUrlWithFilters()},t.loadData=function(i){return this.dataLoader.loadData(i)},t.getCachedData=function(){return this.dataLoader.getCachedData()},t.setCachedData=function(i){return this.dataLoader.setCachedData(i)},t.startUpdateCheck=function(){return this.dataLoader.startUpdateCheckInternal()},t.checkForUpdates=function(){return this.dataLoader.checkForUpdates()},t.addToGoogleCalendar=function(i){return this.actionsManager.addToGoogleCalendar(i)},t.addToCalendar=function(i,o=null){return this.actionsManager.addToCalendar(i,o)},t.bulkAddToGoogleCalendar=function(){return this.actionsManager.bulkAddToGoogleCalendar()},t.exportAllToCalendar=function(){return this.actionsManager.exportAllToCalendar()},t.exportFavoritesToCalendar=function(){return this.actionsManager.exportFavoritesToCalendar()},t.shareCurrentView=function(){return this.actionsManager.shareCurrentView()},t.shareFavorites=function(){return this.actionsManager.shareFavorites()},t.sortTrainings=function(i){const s=this.$store?.ui?.sortBy||["wochentag","ort","uhrzeit","training"];return i.sort((e,n)=>{for(const a of s){let l=0;if(a==="wochentag"){const c=this.wochentagOrder[e.wochentag]||999,d=this.wochentagOrder[n.wochentag]||999;l=c-d}else if(a==="ort")l=(e.ort||"").localeCompare(n.ort||"");else if(a==="uhrzeit"){const c=k.zeitZuMinuten(e.von),d=k.zeitZuMinuten(n.von);l=c-d}else a==="training"&&(l=(e.training||"").localeCompare(n.training||""));if(l!==0)return l}return 0})},t.getTrainingColor=function(i){const o=(i||"").toLowerCase();return o.includes("parkour")?"training-badge badge-parkour":o.includes("trampolin")?"training-badge badge-trampolin":o.includes("tricking")?"training-badge badge-tricking":o.includes("movement")?"training-badge badge-movement":o.includes("fam")?"training-badge badge-fam":o.includes("flips")?"bg-red-100 text-red-800 border-red-200":o.includes("calistenics")||o.includes("calisthenics")?"bg-yellow-100 text-yellow-800 border-yellow-200":"bg-slate-100 text-slate-800 border-slate-200"},t.formatAlter=function(i){return k.formatAlter(i)},t.formatZeitrange=function(i,o){return k.formatZeitrange(i,o)},t.clearAllFilters=function(){const i=this;i.$store?.ui?.filters&&(i.$store.ui.filters={wochentag:[],ort:[],training:[],altersgruppe:[],searchTerm:"",activeQuickFilter:null,_customTimeFilter:"",_customFeatureFilter:"",_customLocationFilter:"",_customPersonalFilter:""}),this.applyFilters()},t.truncateText=function(i,o=30){return i.length<=o?i:i.substring(0,o)+"..."},t.removeCategoryFilter=function(i){const s=this.$store?.ui?.filters;s&&(["wochentag","ort","training","altersgruppe"].includes(i)?s[i]=[]:i==="search"?s.searchTerm="":i==="quickFilter"&&(s.activeQuickFilter=null),this.applyFilters())},t.getActiveFilterChips=function(){const o=this.$store?.ui?.filters;if(!o)return[];const s=[];if(Array.isArray(o.wochentag)&&o.wochentag.length>0){const e=o.wochentag.join(", "),n=this.truncateText(e,35);s.push({category:"wochentag",label:"Wochentag",value:n,fullValue:e,values:o.wochentag,remove:()=>this.removeCategoryFilter("wochentag"),tooltip:`Wochentag: ${e}
Klicken zum Entfernen aller Wochentage`,ariaLabel:`Filter Wochentag (${o.wochentag.length} Tage) entfernen`,prominent:!0,styleClass:"primary-filter",minTouchTarget:44})}if(Array.isArray(o.ort)&&o.ort.length>0){const e=o.ort.join(", "),n=this.truncateText(e,35);s.push({category:"ort",label:"Ort",value:n,fullValue:e,values:o.ort,remove:()=>this.removeCategoryFilter("ort"),tooltip:`Ort: ${e}
Klicken zum Entfernen aller Orte`,ariaLabel:`Filter Ort (${o.ort.length} Orte) entfernen`,prominent:!0,styleClass:"primary-filter",minTouchTarget:44})}if(Array.isArray(o.training)&&o.training.length>0){const e=o.training.join(", "),n=this.truncateText(e,35);s.push({category:"training",label:"Training",value:n,fullValue:e,values:o.training,remove:()=>this.removeCategoryFilter("training"),tooltip:`Training: ${e}
Klicken zum Entfernen aller Trainingsarten`,ariaLabel:`Filter Training (${o.training.length} Arten) entfernen`,prominent:!0,styleClass:"primary-filter",minTouchTarget:44})}if(Array.isArray(o.altersgruppe)&&o.altersgruppe.length>0){const e=o.altersgruppe.join(", "),n=this.truncateText(e,35);s.push({category:"altersgruppe",label:"Altersgruppe",value:n,fullValue:e,values:o.altersgruppe,remove:()=>this.removeCategoryFilter("altersgruppe"),tooltip:`Altersgruppe: ${e}
Klicken zum Entfernen aller Altersgruppen`,ariaLabel:`Filter Altersgruppe (${o.altersgruppe.length} Gruppen) entfernen`,prominent:!0,styleClass:"primary-filter",minTouchTarget:44})}if(o.searchTerm&&o.searchTerm.trim()!==""){const e=this.truncateText(o.searchTerm,35);s.push({category:"search",label:"Suche",value:e,fullValue:o.searchTerm,values:[o.searchTerm],remove:()=>this.removeCategoryFilter("search"),tooltip:`Suche: "${o.searchTerm}"
Klicken zum Entfernen`,ariaLabel:`Suchfilter "${o.searchTerm}" entfernen`,prominent:!0,styleClass:"primary-filter",minTouchTarget:44})}if(o.activeQuickFilter){const n={heute:"Heute",morgen:"Morgen",wochenende:"Wochenende",probetraining:"Probetraining",favoriten:"Favoriten","in-meiner-naehe":"In meiner Nähe"}[o.activeQuickFilter]||o.activeQuickFilter;s.push({category:"quickFilter",label:"Quick-Filter",value:n,fullValue:n,values:[o.activeQuickFilter],remove:()=>this.removeCategoryFilter("quickFilter"),tooltip:`Quick-Filter: ${n}
Klicken zum Entfernen`,ariaLabel:`Quick-Filter ${n} entfernen`,prominent:!0,styleClass:"primary-filter",minTouchTarget:44})}return s},t.getDisplayedFilterChips=function(){return this.getActiveFilterChips().slice(0,3)},t.getOverflowFilterCount=function(){const i=this.getActiveFilterChips();return Math.max(0,i.length-3)},t.getActiveFilterCount=function(){return this.getActiveFilterChips().length},t.removeFilterChip=function(i,o){const e=this.$store?.ui?.filters;e&&(["wochentag","ort","training","altersgruppe"].includes(i)?Array.isArray(e[i])&&(e[i]=e[i].filter(n=>n!==o)):i==="search"?e.searchTerm="":i==="quickFilter"&&(e.activeQuickFilter=null),this.applyFilters())},t.getResultsCount=function(){return this.filteredTrainings?.length||0},t.getResultsCountText=function(){const i=this.getResultsCount();return i===1?"1 Training gefunden":`${i} Trainings gefunden`},t.shouldShowFilterChips=function(){return this.getActiveFilterCount()>0},t.shouldClearButtonBeProminent=function(){return this.getActiveFilterCount()>=3},t.handleKeyboardShortcuts=function(i){const o=this;if((i.ctrlKey||i.metaKey)&&i.key==="f"&&window.matchMedia("(min-width: 1024px)").matches&&o.$store?.ui&&(i.preventDefault(),o.$store.ui.filterSidebarOpen=!o.$store.ui.filterSidebarOpen),i.key==="Escape"&&o.$store?.ui){if(o.$store.ui.activeView==="map"){o.$store.ui.activeView="list",i.preventDefault();return}if(o.$store.ui.mobileFilterOpen){o.$store.ui.mobileFilterOpen=!1,i.preventDefault();return}}},t.destroy=function(){this.updateCheckInterval&&clearInterval(this.updateCheckInterval),this.map&&this.mapManager.cleanupMap(),this.searchTimeout&&clearTimeout(this.searchTimeout)},t}const F=Object.freeze({DEBOUNCE_DELAY:50,MINIMUM_HEIGHT_CHANGE:5,MINIMUM_HEIGHT:400,MAXIMUM_HEIGHT:1e4,EXTRA_PADDING:40,SCROLL_THROTTLE:250,RESIZE_THROTTLE:100});let C={notifyTimeout:null,lastSentHeight:0,parentOrigin:null,resizeObserver:null,mutationObserver:null,isInitialized:!1,targetElement:null,eventListeners:[]};function St(){if(C.parentOrigin)return C.parentOrigin;const r=g;try{if(window.parent!==window)if(document.referrer){const t=new URL(document.referrer);C.parentOrigin=t.origin}else C.parentOrigin=r.iframe?.parentOrigin||"*"}catch(t){h("warn","[iframe-resize] Could not detect parent origin, using fallback",t),C.parentOrigin=r.iframe?.parentOrigin||"*"}return C.parentOrigin&&!le(C.parentOrigin)&&h("warn","[iframe-resize] Parent origin not in allowed list",{origin:C.parentOrigin}),C.parentOrigin||"*"}function le(r){const t=g;return t.iframe?.allowedOrigins?t.iframe.allowedOrigins.includes(r):!0}function Ft(){return ce()?window.innerHeight:Ot()}function ce(){const r=window;if(r.Alpine?.store)try{return r.Alpine.store("ui").mapView===!0}catch{}const t=document.querySelector('[x-show="$store.ui.mapView"]');return t?window.getComputedStyle(t).display!=="none":!1}function Ot(){const r=document.documentElement,t=document.body,i=document.querySelectorAll(".training-card, [data-training-card]");if(i.length>0){const e=i[i.length-1].getBoundingClientRect(),n=Math.ceil(e.bottom+window.scrollY);return Math.max(n+F.EXTRA_PADDING,r.scrollHeight,t.scrollHeight,F.MINIMUM_HEIGHT)}const o=document.querySelector("main, #app, [x-data], #trainings-container");if(o){const s=o.getBoundingClientRect();return Math.max(Math.ceil(s.bottom+window.scrollY+F.EXTRA_PADDING),F.MINIMUM_HEIGHT)}return Math.max(r.scrollHeight,t.scrollHeight,r.offsetHeight,t.offsetHeight,r.clientHeight,t.clientHeight,F.MINIMUM_HEIGHT)}function j(r=null){const t=g;window.parent!==window&&t.iframe?.enabled&&(C.notifyTimeout!==null&&clearTimeout(C.notifyTimeout),C.notifyTimeout=setTimeout(()=>{requestAnimationFrame(()=>{ue(r)})},F.DEBOUNCE_DELAY))}function ue(r=null){const t=Ft(),i=r||St();if(Math.abs(t-C.lastSentHeight)<F.MINIMUM_HEIGHT_CHANGE)return;const o=Math.max(F.MINIMUM_HEIGHT,Math.min(t,F.MAXIMUM_HEIGHT));try{const s={type:"resize",height:Math.round(o),timestamp:Date.now(),view:ce()?"map":"list",source:"fam-trainingsplan"};window.parent.postMessage(s,i),C.lastSentHeight=o,h("debug",`[iframe-resize] → ${o}px (${s.view})`,{origin:i})}catch(s){h("error","[iframe-resize] postMessage error",s)}}function At(r){if(!le(r.origin)){h("warn","[iframe-resize] Message from unknown origin",{origin:r.origin});return}r.data?.type==="init"&&(h("debug","[iframe-resize] Received init request"),setTimeout(()=>j(),100)),r.data?.type==="requestHeight"&&(h("debug","[iframe-resize] Received height request"),de())}function Et(r,t){const i=[],o=(n,a,l,c={})=>{n.addEventListener(a,l,c),i.push({element:n,event:a,handler:l})};o(window,"load",t),o(window,"resize",t,{passive:!0}),o(window,"orientationchange",t,{passive:!0}),document.fonts?.ready&&document.fonts.ready.then(t),window.Alpine&&(o(document,"alpine:init",t),o(document,"alpine:initialized",t),o(document,"alpine:updated",t));const e=q(t,F.SCROLL_THROTTLE);o(window,"scroll",e,{passive:!0}),o(window,"message",At),C.eventListeners=i,h("debug","[iframe-resize] Event listeners attached",{count:i.length})}function It(r,t){if(!window.ResizeObserver){h("warn","[iframe-resize] ResizeObserver not supported");return}try{C.resizeObserver=new ResizeObserver(t),C.resizeObserver.observe(r),C.resizeObserver.observe(document.body),h("debug","[iframe-resize] ResizeObserver attached")}catch(i){h("error","[iframe-resize] ResizeObserver setup failed",i)}}function Pt(r,t){if(!window.MutationObserver){h("warn","[iframe-resize] MutationObserver not supported");return}try{C.mutationObserver=new MutationObserver(t),C.mutationObserver.observe(r,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["style","class","x-show","x-if","hidden"]}),h("debug","[iframe-resize] MutationObserver attached")}catch(i){h("error","[iframe-resize] MutationObserver setup failed",i)}}function Z(r={}){if(C.isInitialized)return h("warn","[iframe-resize] Already initialized"),!1;const{parentOrigin:t=null,targetSelector:i="#trainings-container"}=r;t&&(C.parentOrigin=t);const o=document.querySelector(i)||document.querySelector("[x-data]")||document.querySelector("#app")||document.body;if(!o)return h("error","[iframe-resize] Target element not found"),!1;C.targetElement=o;const s=q(()=>j(),F.RESIZE_THROTTLE);It(o,s),Pt(o,s),Et(o,s),setTimeout(s,100),C.isInitialized=!0;const e=window;return e.notifyParentHeight=j,e.forceIframeResize=de,h("info","[iframe-resize] ✓ Initialized",{target:i,origin:C.parentOrigin}),!0}function de(){C.lastSentHeight=0,ue(),h("debug","[iframe-resize] Force resize triggered")}function $t(){if(window.self===window.top)return;const r=g;!r.iframe?.enabled||!r.iframe?.autoResize||(document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>{Z()}):Z())}$t();function Dt(){const r=document.activeElement;if(!r)return!1;const t=r.tagName;return["INPUT","TEXTAREA","SELECT"].includes(t)||r.hasAttribute("contenteditable")}function te(){const r=document.querySelector('input[type="search"], input[placeholder*="Suche"]');r&&r instanceof HTMLInputElement?(r.focus(),h("debug","Search input focused via keyboard shortcut")):h("warn","Search input not found")}function Nt(r){const i=["Sonntag","Montag","Dienstag","Mittwoch","Donnerstag","Freitag","Samstag"][new Date().getDay()];r.filters.wochentag.includes(i)?r.showNotification(`${i} bereits gefiltert`,"info",2e3):(r.filters.wochentag.push(i),r.showNotification(`Filter: ${i}`,"success",2e3),h("info",`Today filter applied: ${i}`))}function zt(r,t){const o={1:"Montag",2:"Dienstag",3:"Mittwoch",4:"Donnerstag",5:"Freitag",6:"Samstag",7:"Sonntag"}[r];if(!o){h("warn",`Invalid weekday number: ${r}`);return}const s=t.filters.wochentag,e=s.indexOf(o);e===-1?(s.push(o),t.showNotification(`Filter: ${o}`,"success",2e3),h("info",`Weekday filter added: ${o}`)):(s.splice(e,1),t.showNotification(`${o} entfernt`,"info",2e3),h("info",`Weekday filter removed: ${o}`))}function Ut(r){if(!r){h("error","Alpine store not provided to keyboard shortcuts");return}const t=i=>{if((i.metaKey||i.ctrlKey)&&i.key==="k"){i.preventDefault(),te();return}if(!Dt()){if(i.key==="m"||i.key==="M"){i.preventDefault(),r.toggleMapView(),h("info","Map view toggled via keyboard shortcut (M)");return}if(i.key==="/"){i.preventDefault(),te();return}if(i.key==="h"||i.key==="H"){i.preventDefault(),Nt(r);return}if(i.key>="1"&&i.key<="7"){i.preventDefault();const o=parseInt(i.key,10);zt(o,r);return}}};return document.addEventListener("keydown",t),h("info","Keyboard shortcuts initialized (AUFGABE 12)",{shortcuts:["Cmd/Ctrl + K: Quick Search","M: Toggle Map","/: Focus Search","H: Today Filter","1-7: Weekday Filters"]}),()=>{document.removeEventListener("keydown",t),h("debug","Keyboard shortcuts cleaned up")}}window.L=ke;const V=window;function Rt(){w.plugin(pe),w.plugin(fe),w.plugin(me),w.plugin(ge),h("debug","Alpine plugins registered",{plugins:["collapse","focus","intersect","persist"]})}Rt();w.store("ui",{filterSidebarOpen:w.$persist(window.innerWidth>=1024).as("filterSidebarOpen"),sidebarCollapsed:w.$persist(!1).as("fam-trainingsplan-sidebar-collapsed"),mobileFilterOpen:!1,locationSettingsOpen:!1,mapView:!1,activeView:w.$persist("list").as("activeView"),darkMode:w.$persist(!1).as("darkMode"),showScrollTop:!1,viewMode:w.$persist("compact").as("viewMode"),groupingMode:w.$persist("wochentag").as("groupingMode"),sortBy:w.$persist(["wochentag","ort","uhrzeit","training"]).as("sortBy"),scrollDirection:"up",lastScrollY:0,manualLocationSet:w.$persist(!1).as("manualLocationSet"),manualLocation:w.$persist(null).as("manualLocation"),manualLocationAddress:w.$persist("").as("manualLocationAddress"),notification:null,notificationTimeout:null,filters:w.$persist({wochentag:[],ort:[],training:[],altersgruppe:[],searchTerm:"",activeQuickFilter:null,_customTimeFilter:"",_customFeatureFilter:"",_customLocationFilter:"",_customPersonalFilter:""}).as("trainingFilters"),setActiveView(r){["list","split","map"].includes(r)&&(this.activeView=r)},isActiveView(r){return this.activeView===r},toggleMapView(){const r=this.activeView==="map"?"list":"map";this.setActiveView(r),this.mapView=!this.mapView,this.$nextTick&&this.$nextTick(()=>{V.notifyParentHeight?.()})},showListView(){this.mapView=!1,this.$nextTick(()=>{V.notifyParentHeight?.()})},showNotification(r,t="info",i=3e3){clearTimeout(this.notificationTimeout),this.notification={message:r,type:t,show:!0},i>0&&(this.notificationTimeout=setTimeout(()=>{this.hideNotification()},i))},hideNotification(){this.notification&&(this.notification.show=!1,setTimeout(()=>{this.notification=null},300))},resetFilters(){this.filters={wochentag:[],ort:[],training:[],altersgruppe:[],searchTerm:"",activeQuickFilter:null,_customTimeFilter:"",_customFeatureFilter:"",_customLocationFilter:"",_customPersonalFilter:""}},clearAllFilters(){this.resetFilters()},hasActiveFilters(){const r=this.filters;return r.wochentag.length>0||r.ort.length>0||r.training.length>0||r.altersgruppe.length>0||r.probetraining||r.searchTerm!==""},getActiveFilterCount(){const r=this.filters;return r.wochentag.length+r.ort.length+r.training.length+r.altersgruppe.length+(r.probetraining?1:0)+(r.searchTerm?1:0)},toggleSidebar(){this.sidebarCollapsed=!this.sidebarCollapsed},updateScrollDirection(){const r=window.scrollY;this.scrollDirection=r>this.lastScrollY?"down":"up",this.lastScrollY=r}});w.store("filterOptions",{wochentage:[],orte:[],trainingsarten:[],altersgruppen:[]});function Gt(){try{const r=localStorage.getItem("trainingFilters");if(!r){h("debug","No stored filters found, skipping migration");return}const t=JSON.parse(r);if(!(typeof t.wochentag=="string"||typeof t.ort=="string"||typeof t.training=="string"||typeof t.altersgruppe=="string")){h("debug","Filters already in array format, skipping migration");return}const o={wochentag:t.wochentag?[t.wochentag]:[],ort:t.ort?[t.ort]:[],training:t.training?[t.training]:[],altersgruppe:t.altersgruppe?[t.altersgruppe]:[],searchTerm:t.searchTerm||"",activeQuickFilter:t.activeQuickFilter||null,_customTimeFilter:t._customTimeFilter||"",_customFeatureFilter:t._customFeatureFilter||"",_customLocationFilter:t._customLocationFilter||"",_customPersonalFilter:t._customPersonalFilter||""};localStorage.setItem("trainingFilters",JSON.stringify(o)),h("info","Successfully migrated filter format from strings to arrays",{before:{wochentag:typeof t.wochentag,ort:typeof t.ort,training:typeof t.training,altersgruppe:typeof t.altersgruppe},after:{wochentag:Array.isArray(o.wochentag),ort:Array.isArray(o.ort),training:Array.isArray(o.training),altersgruppe:Array.isArray(o.altersgruppe)}})}catch(r){h("error","Failed to migrate filter format",r)}}Gt();w.data("trainingsplaner",Tt);w.start();V.Alpine=w;h("info","Alpine.js initialized",{version:w.version});function Bt(){w.store("ui").darkMode?(document.documentElement.setAttribute("data-theme","dark"),h("info","Dark mode activated from stored preference")):(document.documentElement.setAttribute("data-theme","light"),h("info","Light mode activated"))}Bt();function Ht(){const r=w.store("ui");if(!r){h("error","Alpine UI store not available for keyboard shortcuts");return}Ut(r)}Ht();async function jt(){if(!g.pwa?.enabled){h("info","PWA disabled in config");return}if(!W().supportsServiceWorker){h("warn","Service Worker not supported");return}try{const{registerSW:t}=await Ce(async()=>{const{registerSW:o}=await import("./virtual_pwa-register.CoWl0VS2.js");return{registerSW:o}},__vite__mapDeps([0,1,2,3])),i=t({immediate:!0,onNeedRefresh(){h("info","New content available"),g.pwa?.updateStrategy==="auto"?i(!0):Zt(i)},onOfflineReady(){h("info","App ready for offline use"),w.store("ui").showNotification("App bereit für Offline-Nutzung! 🎉","success",3e3)},onRegisteredSW(o,s){h("info","Service Worker registered",{url:o}),s&&g.pwa?.updateCheckInterval>0&&Vt(s)},onRegisterError(o){h("error","Service Worker registration failed",o)}});Wt(),h("info","PWA initialized successfully")}catch(t){h("error","PWA setup failed",t)}}function Zt(r){w.store("ui").showNotification("Neue Version verfügbar! Klicken zum Aktualisieren.","info",0);const t=i=>{i.target&&i.target.closest("[data-notification]")&&(r(!0),document.removeEventListener("click",t))};document.addEventListener("click",t)}function Vt(r){setInterval(()=>{r.update(),h("debug","Checking for updates...")},g.pwa?.updateCheckInterval||6e4)}function Wt(){const r=()=>{navigator.onLine?(w.store("ui").showNotification("Wieder online! 🌐","success",2e3),h("info","Online mode")):(w.store("ui").showNotification("Keine Internetverbindung - Offline-Modus aktiv","warning",5e3),h("warn","Offline mode"))};window.addEventListener("online",r),window.addEventListener("offline",r),navigator.onLine||r()}function qt(){if(!g.features?.enableTouchGestures||!W().isTouch)return;const r=g.ui?.touch||{};let t=0,i=0,o=0,s=!1;const e=l=>{t=l.touches[0].clientX,i=l.touches[0].clientY,o=Date.now(),window.scrollY===0&&i<100&&(s=!0)},n=l=>{if(!s)return;const d=l.touches[0].clientY-i;if(d>0){const u=document.getElementById("pull-refresh-indicator");u&&(u.style.opacity=Math.min(d/100,1).toString(),u.style.transform=`translateY(${Math.min(d/2,50)}px)`)}},a=l=>{const c=l.changedTouches[0].clientX,d=l.changedTouches[0].clientY,u=Date.now(),p=c-t,f=d-i,_=u-o,m=w.store("ui");if(s&&f>100&&_<1e3){h("info","Pull-to-refresh triggered"),m.showNotification("Aktualisiere Trainings...","info",2e3),setTimeout(()=>{window.location.reload()},500);const x=document.getElementById("pull-refresh-indicator");x&&(x.style.opacity="0",x.style.transform="translateY(0)"),s=!1;return}if(s){const x=document.getElementById("pull-refresh-indicator");x&&(x.style.opacity="0",x.style.transform="translateY(0)"),s=!1}const b=Math.abs(p)>Math.abs(f)&&_<r.swipeMaxTime,y=Math.abs(p)/_;if(!b||y<r.swipeVelocity)return;if(t>80&&t<window.innerWidth-80&&Math.abs(p)>r.swipeThreshold){const x=m.activeView;if(p<-r.swipeThreshold){const S={list:"map",map:"favorites",favorites:"list"}[x]||"list";m.setActiveView(S),h("info",`Swipe left - switching to ${S} view`);return}if(p>r.swipeThreshold){const S={list:"favorites",map:"list",favorites:"map"}[x]||"list";m.setActiveView(S),h("info",`Swipe right - switching to ${S} view`);return}}if(p<-r.swipeThreshold&&t>window.innerWidth-50){(m.filterSidebarOpen||m.mobileFilterOpen)&&(m.filterSidebarOpen=!1,m.mobileFilterOpen=!1,h("debug","Swipe left from edge - closing filter"));return}if(p>r.swipeThreshold&&t<50){window.innerWidth<(g.ui?.mobileBreakpoint||768)?m.mobileFilterOpen=!0:m.filterSidebarOpen=!0,h("debug","Swipe right from edge - opening filter");return}};document.addEventListener("touchstart",e,{passive:!0}),document.addEventListener("touchmove",n,{passive:!0}),document.addEventListener("touchend",a,{passive:!0}),h("info","Touch gestures initialized (AUFGABE 10: View switching + Pull-to-refresh)")}function Kt(){g.iframe?.enabled&&(Z({parentOrigin:g.iframe?.parentOrigin||"*",targetSelector:"#trainings-container"}),h("info","Iframe auto-resize initialized"))}function Qt(){if(!(!g.logging?.enabled||!("PerformanceObserver"in window)))try{new PerformanceObserver(t=>{t.getEntries().forEach(i=>{if(i.entryType==="navigation"){const o=i;h("debug","Page Load Performance",{dns:Math.round(o.domainLookupEnd-o.domainLookupStart),tcp:Math.round(o.connectEnd-o.connectStart),ttfb:Math.round(o.responseStart-o.requestStart),download:Math.round(o.responseEnd-o.responseStart),domInteractive:Math.round(o.domInteractive),domComplete:Math.round(o.domComplete),loadComplete:Math.round(o.loadEventEnd)})}})}).observe({entryTypes:["navigation"]})}catch(r){h("warn","Performance monitoring failed",r)}}window.addEventListener("error",r=>{h("error","Global Error",{message:r.message,filename:r.filename,lineno:r.lineno,colno:r.colno,error:r.error}),g.errors?.showUserFriendlyMessages&&w.store("ui").showNotification("Ein Fehler ist aufgetreten. Bitte Seite neu laden.","error",5e3)});window.addEventListener("unhandledrejection",r=>{h("error","Unhandled Promise Rejection",r.reason),g.errors?.showUserFriendlyMessages&&w.store("ui").showNotification("Ein Fehler ist aufgetreten. Bitte versuchen Sie es erneut.","error",5e3)});document.addEventListener("visibilitychange",()=>{document.hidden?h("debug","Page hidden - pausing updates"):h("debug","Page visible - resuming updates")});async function Yt(){try{await Promise.all([jt(),Promise.resolve(qt()),Promise.resolve(Kt())]),Qt(),h("info","🚀 App initialized",{version:g.pwa?.version||"1.0.0",env:"production",browser:W(),features:Object.entries(g.features||{}).filter(([,r])=>r).map(([r])=>r)})}catch(r){h("error","App initialization failed",r)}}Yt();export{Ce as _};
