const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/js/virtual_pwa-register.BD0sidaw.js","assets/js/vendor-alpine.D9MLegQT.js","assets/js/vendor-map.zdHhRoWp.js","assets/js/vendor-utils.Dw8P0qyA.js"])))=>i.map(i=>d[i]);
import{m as w,a as pe,b as fe,c as me,d as ge}from"./vendor-alpine.D9MLegQT.js";import{r as _e,g as ye}from"./vendor-map.zdHhRoWp.js";import{F as ve}from"./vendor-utils.Dw8P0qyA.js";function we(i,t){for(var r=0;r<t.length;r++){const o=t[r];if(typeof o!="string"&&!Array.isArray(o)){for(const s in o)if(s!=="default"&&!(s in i)){const e=Object.getOwnPropertyDescriptor(o,s);e&&Object.defineProperty(i,s,e.get?e:{enumerable:!0,get:()=>o[s]})}}}return Object.freeze(Object.defineProperty(i,Symbol.toStringTag,{value:"Module"}))}(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))o(s);new MutationObserver(s=>{for(const e of s)if(e.type==="childList")for(const n of e.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&o(n)}).observe(document,{childList:!0,subtree:!0});function r(s){const e={};return s.integrity&&(e.integrity=s.integrity),s.referrerPolicy&&(e.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?e.credentials="include":s.crossOrigin==="anonymous"?e.credentials="omit":e.credentials="same-origin",e}function o(s){if(s.ep)return;s.ep=!0;const e=r(s);fetch(s.href,e)}})();const Le="modulepreload",be=function(i){return"/fam-trainingsplan/"+i},X={},Ce=function(t,r,o){let s=Promise.resolve();if(r&&r.length>0){let l=function(c){return Promise.all(c.map(d=>Promise.resolve(d).then(h=>({status:"fulfilled",value:h}),h=>({status:"rejected",reason:h}))))};document.getElementsByTagName("link");const n=document.querySelector("meta[property=csp-nonce]"),a=n?.nonce||n?.getAttribute("nonce");s=l(r.map(c=>{if(c=be(c),c in X)return;X[c]=!0;const d=c.endsWith(".css"),h=d?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${c}"]${h}`))return;const p=document.createElement("link");if(p.rel=d?"stylesheet":Le,d||(p.as="script"),p.crossOrigin="",p.href=c,a&&p.setAttribute("nonce",a),document.head.appendChild(p),d)return new Promise((f,m)=>{p.addEventListener("load",f),p.addEventListener("error",()=>m(new Error(`Unable to preload CSS for ${c}`)))})}))}function e(n){const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=n,window.dispatchEvent(a),!a.defaultPrevented)throw n}return s.then(n=>{for(const a of n||[])a.status==="rejected"&&e(a.reason);return t().catch(e)})};var _=_e();const xe=ye(_),Me=we({__proto__:null,default:xe},[_]);var P={exports:{}},ke=P.exports,J;function Te(){return J||(J=1,(function(i,t){(function(r,o){o(t)})(ke,function(r){var o=L.MarkerClusterGroup=L.FeatureGroup.extend({options:{maxClusterRadius:80,iconCreateFunction:null,clusterPane:L.Marker.prototype.options.pane,spiderfyOnEveryZoom:!1,spiderfyOnMaxZoom:!0,showCoverageOnHover:!0,zoomToBoundsOnClick:!0,singleMarkerMode:!1,disableClusteringAtZoom:null,removeOutsideVisibleBounds:!0,animate:!0,animateAddingMarkers:!1,spiderfyShapePositions:null,spiderfyDistanceMultiplier:1,spiderLegPolylineOptions:{weight:1.5,color:"#222",opacity:.5},chunkedLoading:!1,chunkInterval:200,chunkDelay:50,chunkProgress:null,polygonOptions:{}},initialize:function(e){L.Util.setOptions(this,e),this.options.iconCreateFunction||(this.options.iconCreateFunction=this._defaultIconCreateFunction),this._featureGroup=L.featureGroup(),this._featureGroup.addEventParent(this),this._nonPointGroup=L.featureGroup(),this._nonPointGroup.addEventParent(this),this._inZoomAnimation=0,this._needsClustering=[],this._needsRemoving=[],this._currentShownBounds=null,this._queue=[],this._childMarkerEventHandlers={dragstart:this._childMarkerDragStart,move:this._childMarkerMoved,dragend:this._childMarkerDragEnd};var n=L.DomUtil.TRANSITION&&this.options.animate;L.extend(this,n?this._withAnimation:this._noAnimation),this._markerCluster=n?L.MarkerCluster:L.MarkerClusterNonAnimated},addLayer:function(e){if(e instanceof L.LayerGroup)return this.addLayers([e]);if(!e.getLatLng)return this._nonPointGroup.addLayer(e),this.fire("layeradd",{layer:e}),this;if(!this._map)return this._needsClustering.push(e),this.fire("layeradd",{layer:e}),this;if(this.hasLayer(e))return this;this._unspiderfy&&this._unspiderfy(),this._addLayer(e,this._maxZoom),this.fire("layeradd",{layer:e}),this._topClusterLevel._recalculateBounds(),this._refreshClustersIcons();var n=e,a=this._zoom;if(e.__parent)for(;n.__parent._zoom>=a;)n=n.__parent;return this._currentShownBounds.contains(n.getLatLng())&&(this.options.animateAddingMarkers?this._animationAddLayer(e,n):this._animationAddLayerNonAnimated(e,n)),this},removeLayer:function(e){return e instanceof L.LayerGroup?this.removeLayers([e]):(e.getLatLng?this._map?e.__parent&&(this._unspiderfy&&(this._unspiderfy(),this._unspiderfyLayer(e)),this._removeLayer(e,!0),this.fire("layerremove",{layer:e}),this._topClusterLevel._recalculateBounds(),this._refreshClustersIcons(),e.off(this._childMarkerEventHandlers,this),this._featureGroup.hasLayer(e)&&(this._featureGroup.removeLayer(e),e.clusterShow&&e.clusterShow())):(!this._arraySplice(this._needsClustering,e)&&this.hasLayer(e)&&this._needsRemoving.push({layer:e,latlng:e._latlng}),this.fire("layerremove",{layer:e})):(this._nonPointGroup.removeLayer(e),this.fire("layerremove",{layer:e})),this)},addLayers:function(e,n){if(!L.Util.isArray(e))return this.addLayer(e);var a,l=this._featureGroup,c=this._nonPointGroup,d=this.options.chunkedLoading,h=this.options.chunkInterval,p=this.options.chunkProgress,f=e.length,m=0,y=!0;if(this._map){var M=new Date().getTime(),v=L.bind(function(){var x=new Date().getTime();for(this._map&&this._unspiderfy&&this._unspiderfy();m<f;m++){if(d&&m%200==0){var A=new Date().getTime()-x;if(h<A)break}if((a=e[m])instanceof L.LayerGroup)y&&(e=e.slice(),y=!1),this._extractNonGroupLayers(a,e),f=e.length;else if(a.getLatLng){if(!this.hasLayer(a)&&(this._addLayer(a,this._maxZoom),n||this.fire("layeradd",{layer:a}),a.__parent&&a.__parent.getChildCount()===2)){var T=a.__parent.getAllChildMarkers(),he=T[0]===a?T[1]:T[0];l.removeLayer(he)}}else c.addLayer(a),n||this.fire("layeradd",{layer:a})}p&&p(m,f,new Date().getTime()-M),m===f?(this._topClusterLevel._recalculateBounds(),this._refreshClustersIcons(),this._topClusterLevel._recursivelyAddChildrenToMap(null,this._zoom,this._currentShownBounds)):setTimeout(v,this.options.chunkDelay)},this);v()}else for(var F=this._needsClustering;m<f;m++)(a=e[m])instanceof L.LayerGroup?(y&&(e=e.slice(),y=!1),this._extractNonGroupLayers(a,e),f=e.length):a.getLatLng?this.hasLayer(a)||F.push(a):c.addLayer(a);return this},removeLayers:function(e){var n,a,l=e.length,c=this._featureGroup,d=this._nonPointGroup,h=!0;if(!this._map){for(n=0;n<l;n++)(a=e[n])instanceof L.LayerGroup?(h&&(e=e.slice(),h=!1),this._extractNonGroupLayers(a,e),l=e.length):(this._arraySplice(this._needsClustering,a),d.removeLayer(a),this.hasLayer(a)&&this._needsRemoving.push({layer:a,latlng:a._latlng}),this.fire("layerremove",{layer:a}));return this}if(this._unspiderfy){this._unspiderfy();var p=e.slice(),f=l;for(n=0;n<f;n++)(a=p[n])instanceof L.LayerGroup?(this._extractNonGroupLayers(a,p),f=p.length):this._unspiderfyLayer(a)}for(n=0;n<l;n++)(a=e[n])instanceof L.LayerGroup?(h&&(e=e.slice(),h=!1),this._extractNonGroupLayers(a,e),l=e.length):a.__parent?(this._removeLayer(a,!0,!0),this.fire("layerremove",{layer:a}),c.hasLayer(a)&&(c.removeLayer(a),a.clusterShow&&a.clusterShow())):(d.removeLayer(a),this.fire("layerremove",{layer:a}));return this._topClusterLevel._recalculateBounds(),this._refreshClustersIcons(),this._topClusterLevel._recursivelyAddChildrenToMap(null,this._zoom,this._currentShownBounds),this},clearLayers:function(){return this._map||(this._needsClustering=[],this._needsRemoving=[],delete this._gridClusters,delete this._gridUnclustered),this._noanimationUnspiderfy&&this._noanimationUnspiderfy(),this._featureGroup.clearLayers(),this._nonPointGroup.clearLayers(),this.eachLayer(function(e){e.off(this._childMarkerEventHandlers,this),delete e.__parent},this),this._map&&this._generateInitialClusters(),this},getBounds:function(){var e=new L.LatLngBounds;this._topClusterLevel&&e.extend(this._topClusterLevel._bounds);for(var n=this._needsClustering.length-1;0<=n;n--)e.extend(this._needsClustering[n].getLatLng());return e.extend(this._nonPointGroup.getBounds()),e},eachLayer:function(e,n){var a,l,c,d=this._needsClustering.slice(),h=this._needsRemoving;for(this._topClusterLevel&&this._topClusterLevel.getAllChildMarkers(d),l=d.length-1;0<=l;l--){for(a=!0,c=h.length-1;0<=c;c--)if(h[c].layer===d[l]){a=!1;break}a&&e.call(n,d[l])}this._nonPointGroup.eachLayer(e,n)},getLayers:function(){var e=[];return this.eachLayer(function(n){e.push(n)}),e},getLayer:function(e){var n=null;return e=parseInt(e,10),this.eachLayer(function(a){L.stamp(a)===e&&(n=a)}),n},hasLayer:function(e){if(!e)return!1;var n,a=this._needsClustering;for(n=a.length-1;0<=n;n--)if(a[n]===e)return!0;for(n=(a=this._needsRemoving).length-1;0<=n;n--)if(a[n].layer===e)return!1;return!(!e.__parent||e.__parent._group!==this)||this._nonPointGroup.hasLayer(e)},zoomToShowLayer:function(e,n){var a=this._map;typeof n!="function"&&(n=function(){});var l=function(){!a.hasLayer(e)&&!a.hasLayer(e.__parent)||this._inZoomAnimation||(this._map.off("moveend",l,this),this.off("animationend",l,this),a.hasLayer(e)?n():e.__parent._icon&&(this.once("spiderfied",n,this),e.__parent.spiderfy()))};e._icon&&this._map.getBounds().contains(e.getLatLng())?n():e.__parent._zoom<Math.round(this._map._zoom)?(this._map.on("moveend",l,this),this._map.panTo(e.getLatLng())):(this._map.on("moveend",l,this),this.on("animationend",l,this),e.__parent.zoomToBounds())},onAdd:function(e){var n,a,l;if(this._map=e,!isFinite(this._map.getMaxZoom()))throw"Map has no maxZoom specified";for(this._featureGroup.addTo(e),this._nonPointGroup.addTo(e),this._gridClusters||this._generateInitialClusters(),this._maxLat=e.options.crs.projection.MAX_LATITUDE,n=0,a=this._needsRemoving.length;n<a;n++)(l=this._needsRemoving[n]).newlatlng=l.layer._latlng,l.layer._latlng=l.latlng;for(n=0,a=this._needsRemoving.length;n<a;n++)l=this._needsRemoving[n],this._removeLayer(l.layer,!0),l.layer._latlng=l.newlatlng;this._needsRemoving=[],this._zoom=Math.round(this._map._zoom),this._currentShownBounds=this._getExpandedVisibleBounds(),this._map.on("zoomend",this._zoomEnd,this),this._map.on("moveend",this._moveEnd,this),this._spiderfierOnAdd&&this._spiderfierOnAdd(),this._bindEvents(),a=this._needsClustering,this._needsClustering=[],this.addLayers(a,!0)},onRemove:function(e){e.off("zoomend",this._zoomEnd,this),e.off("moveend",this._moveEnd,this),this._unbindEvents(),this._map._mapPane.className=this._map._mapPane.className.replace(" leaflet-cluster-anim",""),this._spiderfierOnRemove&&this._spiderfierOnRemove(),delete this._maxLat,this._hideCoverage(),this._featureGroup.remove(),this._nonPointGroup.remove(),this._featureGroup.clearLayers(),this._map=null},getVisibleParent:function(e){for(var n=e;n&&!n._icon;)n=n.__parent;return n||null},_arraySplice:function(e,n){for(var a=e.length-1;0<=a;a--)if(e[a]===n)return e.splice(a,1),!0},_removeFromGridUnclustered:function(e,n){for(var a=this._map,l=this._gridUnclustered,c=Math.floor(this._map.getMinZoom());c<=n&&l[n].removeObject(e,a.project(e.getLatLng(),n));n--);},_childMarkerDragStart:function(e){e.target.__dragStart=e.target._latlng},_childMarkerMoved:function(e){if(!this._ignoreMove&&!e.target.__dragStart){var n=e.target._popup&&e.target._popup.isOpen();this._moveChild(e.target,e.oldLatLng,e.latlng),n&&e.target.openPopup()}},_moveChild:function(e,n,a){e._latlng=n,this.removeLayer(e),e._latlng=a,this.addLayer(e)},_childMarkerDragEnd:function(e){var n=e.target.__dragStart;delete e.target.__dragStart,n&&this._moveChild(e.target,n,e.target._latlng)},_removeLayer:function(e,n,a){var l=this._gridClusters,c=this._gridUnclustered,d=this._featureGroup,h=this._map,p=Math.floor(this._map.getMinZoom());n&&this._removeFromGridUnclustered(e,this._maxZoom);var f,m=e.__parent,y=m._markers;for(this._arraySplice(y,e);m&&(m._childCount--,m._boundsNeedUpdate=!0,!(m._zoom<p));)n&&m._childCount<=1?(f=m._markers[0]===e?m._markers[1]:m._markers[0],l[m._zoom].removeObject(m,h.project(m._cLatLng,m._zoom)),c[m._zoom].addObject(f,h.project(f.getLatLng(),m._zoom)),this._arraySplice(m.__parent._childClusters,m),m.__parent._markers.push(f),f.__parent=m.__parent,m._icon&&(d.removeLayer(m),a||d.addLayer(f))):m._iconNeedsUpdate=!0,m=m.__parent;delete e.__parent},_isOrIsParent:function(e,n){for(;n;){if(e===n)return!0;n=n.parentNode}return!1},fire:function(e,n,a){if(n&&n.layer instanceof L.MarkerCluster){if(n.originalEvent&&this._isOrIsParent(n.layer._icon,n.originalEvent.relatedTarget))return;e="cluster"+e}L.FeatureGroup.prototype.fire.call(this,e,n,a)},listens:function(e,n){return L.FeatureGroup.prototype.listens.call(this,e,n)||L.FeatureGroup.prototype.listens.call(this,"cluster"+e,n)},_defaultIconCreateFunction:function(e){var n=e.getChildCount(),a=" marker-cluster-";return a+=n<10?"small":n<100?"medium":"large",new L.DivIcon({html:"<div><span>"+n+"</span></div>",className:"marker-cluster"+a,iconSize:new L.Point(40,40)})},_bindEvents:function(){var e=this._map,n=this.options.spiderfyOnMaxZoom,a=this.options.showCoverageOnHover,l=this.options.zoomToBoundsOnClick,c=this.options.spiderfyOnEveryZoom;(n||l||c)&&this.on("clusterclick clusterkeypress",this._zoomOrSpiderfy,this),a&&(this.on("clustermouseover",this._showCoverage,this),this.on("clustermouseout",this._hideCoverage,this),e.on("zoomend",this._hideCoverage,this))},_zoomOrSpiderfy:function(e){var n=e.layer,a=n;if(e.type!=="clusterkeypress"||!e.originalEvent||e.originalEvent.keyCode===13){for(;a._childClusters.length===1;)a=a._childClusters[0];a._zoom===this._maxZoom&&a._childCount===n._childCount&&this.options.spiderfyOnMaxZoom?n.spiderfy():this.options.zoomToBoundsOnClick&&n.zoomToBounds(),this.options.spiderfyOnEveryZoom&&n.spiderfy(),e.originalEvent&&e.originalEvent.keyCode===13&&this._map._container.focus()}},_showCoverage:function(e){var n=this._map;this._inZoomAnimation||(this._shownPolygon&&n.removeLayer(this._shownPolygon),2<e.layer.getChildCount()&&e.layer!==this._spiderfied&&(this._shownPolygon=new L.Polygon(e.layer.getConvexHull(),this.options.polygonOptions),n.addLayer(this._shownPolygon)))},_hideCoverage:function(){this._shownPolygon&&(this._map.removeLayer(this._shownPolygon),this._shownPolygon=null)},_unbindEvents:function(){var e=this.options.spiderfyOnMaxZoom,n=this.options.showCoverageOnHover,a=this.options.zoomToBoundsOnClick,l=this.options.spiderfyOnEveryZoom,c=this._map;(e||a||l)&&this.off("clusterclick clusterkeypress",this._zoomOrSpiderfy,this),n&&(this.off("clustermouseover",this._showCoverage,this),this.off("clustermouseout",this._hideCoverage,this),c.off("zoomend",this._hideCoverage,this))},_zoomEnd:function(){this._map&&(this._mergeSplitClusters(),this._zoom=Math.round(this._map._zoom),this._currentShownBounds=this._getExpandedVisibleBounds())},_moveEnd:function(){if(!this._inZoomAnimation){var e=this._getExpandedVisibleBounds();this._topClusterLevel._recursivelyRemoveChildrenFromMap(this._currentShownBounds,Math.floor(this._map.getMinZoom()),this._zoom,e),this._topClusterLevel._recursivelyAddChildrenToMap(null,Math.round(this._map._zoom),e),this._currentShownBounds=e}},_generateInitialClusters:function(){var e=Math.ceil(this._map.getMaxZoom()),n=Math.floor(this._map.getMinZoom()),a=this.options.maxClusterRadius,l=a;typeof a!="function"&&(l=function(){return a}),this.options.disableClusteringAtZoom!==null&&(e=this.options.disableClusteringAtZoom-1),this._maxZoom=e,this._gridClusters={},this._gridUnclustered={};for(var c=e;n<=c;c--)this._gridClusters[c]=new L.DistanceGrid(l(c)),this._gridUnclustered[c]=new L.DistanceGrid(l(c));this._topClusterLevel=new this._markerCluster(this,n-1)},_addLayer:function(e,n){var a,l,c=this._gridClusters,d=this._gridUnclustered,h=Math.floor(this._map.getMinZoom());for(this.options.singleMarkerMode&&this._overrideMarkerIcon(e),e.on(this._childMarkerEventHandlers,this);h<=n;n--){a=this._map.project(e.getLatLng(),n);var p=c[n].getNearObject(a);if(p)return p._addChild(e),void(e.__parent=p);if(p=d[n].getNearObject(a)){var f=p.__parent;f&&this._removeLayer(p,!1);var m=new this._markerCluster(this,n,p,e);c[n].addObject(m,this._map.project(m._cLatLng,n)),p.__parent=m;var y=e.__parent=m;for(l=n-1;l>f._zoom;l--)y=new this._markerCluster(this,l,y),c[l].addObject(y,this._map.project(p.getLatLng(),l));return f._addChild(y),void this._removeFromGridUnclustered(p,n)}d[n].addObject(e,a)}this._topClusterLevel._addChild(e),e.__parent=this._topClusterLevel},_refreshClustersIcons:function(){this._featureGroup.eachLayer(function(e){e instanceof L.MarkerCluster&&e._iconNeedsUpdate&&e._updateIcon()})},_enqueue:function(e){this._queue.push(e),this._queueTimeout||(this._queueTimeout=setTimeout(L.bind(this._processQueue,this),300))},_processQueue:function(){for(var e=0;e<this._queue.length;e++)this._queue[e].call(this);this._queue.length=0,clearTimeout(this._queueTimeout),this._queueTimeout=null},_mergeSplitClusters:function(){var e=Math.round(this._map._zoom);this._processQueue(),this._zoom<e&&this._currentShownBounds.intersects(this._getExpandedVisibleBounds())?(this._animationStart(),this._topClusterLevel._recursivelyRemoveChildrenFromMap(this._currentShownBounds,Math.floor(this._map.getMinZoom()),this._zoom,this._getExpandedVisibleBounds()),this._animationZoomIn(this._zoom,e)):this._zoom>e?(this._animationStart(),this._animationZoomOut(this._zoom,e)):this._moveEnd()},_getExpandedVisibleBounds:function(){return this.options.removeOutsideVisibleBounds?L.Browser.mobile?this._checkBoundsMaxLat(this._map.getBounds()):this._checkBoundsMaxLat(this._map.getBounds().pad(1)):this._mapBoundsInfinite},_checkBoundsMaxLat:function(e){var n=this._maxLat;return n!==void 0&&(e.getNorth()>=n&&(e._northEast.lat=1/0),e.getSouth()<=-n&&(e._southWest.lat=-1/0)),e},_animationAddLayerNonAnimated:function(e,n){if(n===e)this._featureGroup.addLayer(e);else if(n._childCount===2){n._addToMap();var a=n.getAllChildMarkers();this._featureGroup.removeLayer(a[0]),this._featureGroup.removeLayer(a[1])}else n._updateIcon()},_extractNonGroupLayers:function(e,n){var a,l=e.getLayers(),c=0;for(n=n||[];c<l.length;c++)(a=l[c])instanceof L.LayerGroup?this._extractNonGroupLayers(a,n):n.push(a);return n},_overrideMarkerIcon:function(e){return e.options.icon=this.options.iconCreateFunction({getChildCount:function(){return 1},getAllChildMarkers:function(){return[e]}})}});L.MarkerClusterGroup.include({_mapBoundsInfinite:new L.LatLngBounds(new L.LatLng(-1/0,-1/0),new L.LatLng(1/0,1/0))}),L.MarkerClusterGroup.include({_noAnimation:{_animationStart:function(){},_animationZoomIn:function(e,n){this._topClusterLevel._recursivelyRemoveChildrenFromMap(this._currentShownBounds,Math.floor(this._map.getMinZoom()),e),this._topClusterLevel._recursivelyAddChildrenToMap(null,n,this._getExpandedVisibleBounds()),this.fire("animationend")},_animationZoomOut:function(e,n){this._topClusterLevel._recursivelyRemoveChildrenFromMap(this._currentShownBounds,Math.floor(this._map.getMinZoom()),e),this._topClusterLevel._recursivelyAddChildrenToMap(null,n,this._getExpandedVisibleBounds()),this.fire("animationend")},_animationAddLayer:function(e,n){this._animationAddLayerNonAnimated(e,n)}},_withAnimation:{_animationStart:function(){this._map._mapPane.className+=" leaflet-cluster-anim",this._inZoomAnimation++},_animationZoomIn:function(e,n){var a,l=this._getExpandedVisibleBounds(),c=this._featureGroup,d=Math.floor(this._map.getMinZoom());this._ignoreMove=!0,this._topClusterLevel._recursively(l,e,d,function(h){var p,f=h._latlng,m=h._markers;for(l.contains(f)||(f=null),h._isSingleParent()&&e+1===n?(c.removeLayer(h),h._recursivelyAddChildrenToMap(null,n,l)):(h.clusterHide(),h._recursivelyAddChildrenToMap(f,n,l)),a=m.length-1;0<=a;a--)p=m[a],l.contains(p._latlng)||c.removeLayer(p)}),this._forceLayout(),this._topClusterLevel._recursivelyBecomeVisible(l,n),c.eachLayer(function(h){h instanceof L.MarkerCluster||!h._icon||h.clusterShow()}),this._topClusterLevel._recursively(l,e,n,function(h){h._recursivelyRestoreChildPositions(n)}),this._ignoreMove=!1,this._enqueue(function(){this._topClusterLevel._recursively(l,e,d,function(h){c.removeLayer(h),h.clusterShow()}),this._animationEnd()})},_animationZoomOut:function(e,n){this._animationZoomOutSingle(this._topClusterLevel,e-1,n),this._topClusterLevel._recursivelyAddChildrenToMap(null,n,this._getExpandedVisibleBounds()),this._topClusterLevel._recursivelyRemoveChildrenFromMap(this._currentShownBounds,Math.floor(this._map.getMinZoom()),e,this._getExpandedVisibleBounds())},_animationAddLayer:function(e,n){var a=this,l=this._featureGroup;l.addLayer(e),n!==e&&(2<n._childCount?(n._updateIcon(),this._forceLayout(),this._animationStart(),e._setPos(this._map.latLngToLayerPoint(n.getLatLng())),e.clusterHide(),this._enqueue(function(){l.removeLayer(e),e.clusterShow(),a._animationEnd()})):(this._forceLayout(),a._animationStart(),a._animationZoomOutSingle(n,this._map.getMaxZoom(),this._zoom)))}},_animationZoomOutSingle:function(e,n,a){var l=this._getExpandedVisibleBounds(),c=Math.floor(this._map.getMinZoom());e._recursivelyAnimateChildrenInAndAddSelfToMap(l,c,n+1,a);var d=this;this._forceLayout(),e._recursivelyBecomeVisible(l,a),this._enqueue(function(){if(e._childCount===1){var h=e._markers[0];this._ignoreMove=!0,h.setLatLng(h.getLatLng()),this._ignoreMove=!1,h.clusterShow&&h.clusterShow()}else e._recursively(l,a,c,function(p){p._recursivelyRemoveChildrenFromMap(l,c,n+1)});d._animationEnd()})},_animationEnd:function(){this._map&&(this._map._mapPane.className=this._map._mapPane.className.replace(" leaflet-cluster-anim","")),this._inZoomAnimation--,this.fire("animationend")},_forceLayout:function(){L.Util.falseFn(document.body.offsetWidth)}}),L.markerClusterGroup=function(e){return new L.MarkerClusterGroup(e)};var s=L.MarkerCluster=L.Marker.extend({options:L.Icon.prototype.options,initialize:function(e,n,a,l){L.Marker.prototype.initialize.call(this,a?a._cLatLng||a.getLatLng():new L.LatLng(0,0),{icon:this,pane:e.options.clusterPane}),this._group=e,this._zoom=n,this._markers=[],this._childClusters=[],this._childCount=0,this._iconNeedsUpdate=!0,this._boundsNeedUpdate=!0,this._bounds=new L.LatLngBounds,a&&this._addChild(a),l&&this._addChild(l)},getAllChildMarkers:function(e,n){e=e||[];for(var a=this._childClusters.length-1;0<=a;a--)this._childClusters[a].getAllChildMarkers(e,n);for(var l=this._markers.length-1;0<=l;l--)n&&this._markers[l].__dragStart||e.push(this._markers[l]);return e},getChildCount:function(){return this._childCount},zoomToBounds:function(e){for(var n,a=this._childClusters.slice(),l=this._group._map,c=l.getBoundsZoom(this._bounds),d=this._zoom+1,h=l.getZoom();0<a.length&&d<c;){d++;var p=[];for(n=0;n<a.length;n++)p=p.concat(a[n]._childClusters);a=p}d<c?this._group._map.setView(this._latlng,d):c<=h?this._group._map.setView(this._latlng,h+1):this._group._map.fitBounds(this._bounds,e)},getBounds:function(){var e=new L.LatLngBounds;return e.extend(this._bounds),e},_updateIcon:function(){this._iconNeedsUpdate=!0,this._icon&&this.setIcon(this)},createIcon:function(){return this._iconNeedsUpdate&&(this._iconObj=this._group.options.iconCreateFunction(this),this._iconNeedsUpdate=!1),this._iconObj.createIcon()},createShadow:function(){return this._iconObj.createShadow()},_addChild:function(e,n){this._iconNeedsUpdate=!0,this._boundsNeedUpdate=!0,this._setClusterCenter(e),e instanceof L.MarkerCluster?(n||(this._childClusters.push(e),e.__parent=this),this._childCount+=e._childCount):(n||this._markers.push(e),this._childCount++),this.__parent&&this.__parent._addChild(e,!0)},_setClusterCenter:function(e){this._cLatLng||(this._cLatLng=e._cLatLng||e._latlng)},_resetBounds:function(){var e=this._bounds;e._southWest&&(e._southWest.lat=1/0,e._southWest.lng=1/0),e._northEast&&(e._northEast.lat=-1/0,e._northEast.lng=-1/0)},_recalculateBounds:function(){var e,n,a,l,c=this._markers,d=this._childClusters,h=0,p=0,f=this._childCount;if(f!==0){for(this._resetBounds(),e=0;e<c.length;e++)a=c[e]._latlng,this._bounds.extend(a),h+=a.lat,p+=a.lng;for(e=0;e<d.length;e++)(n=d[e])._boundsNeedUpdate&&n._recalculateBounds(),this._bounds.extend(n._bounds),a=n._wLatLng,l=n._childCount,h+=a.lat*l,p+=a.lng*l;this._latlng=this._wLatLng=new L.LatLng(h/f,p/f),this._boundsNeedUpdate=!1}},_addToMap:function(e){e&&(this._backupLatlng=this._latlng,this.setLatLng(e)),this._group._featureGroup.addLayer(this)},_recursivelyAnimateChildrenIn:function(e,n,a){this._recursively(e,this._group._map.getMinZoom(),a-1,function(l){var c,d,h=l._markers;for(c=h.length-1;0<=c;c--)(d=h[c])._icon&&(d._setPos(n),d.clusterHide())},function(l){var c,d,h=l._childClusters;for(c=h.length-1;0<=c;c--)(d=h[c])._icon&&(d._setPos(n),d.clusterHide())})},_recursivelyAnimateChildrenInAndAddSelfToMap:function(e,n,a,l){this._recursively(e,l,n,function(c){c._recursivelyAnimateChildrenIn(e,c._group._map.latLngToLayerPoint(c.getLatLng()).round(),a),c._isSingleParent()&&a-1===l?(c.clusterShow(),c._recursivelyRemoveChildrenFromMap(e,n,a)):c.clusterHide(),c._addToMap()})},_recursivelyBecomeVisible:function(e,n){this._recursively(e,this._group._map.getMinZoom(),n,null,function(a){a.clusterShow()})},_recursivelyAddChildrenToMap:function(e,n,a){this._recursively(a,this._group._map.getMinZoom()-1,n,function(l){if(n!==l._zoom)for(var c=l._markers.length-1;0<=c;c--){var d=l._markers[c];a.contains(d._latlng)&&(e&&(d._backupLatlng=d.getLatLng(),d.setLatLng(e),d.clusterHide&&d.clusterHide()),l._group._featureGroup.addLayer(d))}},function(l){l._addToMap(e)})},_recursivelyRestoreChildPositions:function(e){for(var n=this._markers.length-1;0<=n;n--){var a=this._markers[n];a._backupLatlng&&(a.setLatLng(a._backupLatlng),delete a._backupLatlng)}if(e-1===this._zoom)for(var l=this._childClusters.length-1;0<=l;l--)this._childClusters[l]._restorePosition();else for(var c=this._childClusters.length-1;0<=c;c--)this._childClusters[c]._recursivelyRestoreChildPositions(e)},_restorePosition:function(){this._backupLatlng&&(this.setLatLng(this._backupLatlng),delete this._backupLatlng)},_recursivelyRemoveChildrenFromMap:function(e,n,a,l){var c,d;this._recursively(e,n-1,a-1,function(h){for(d=h._markers.length-1;0<=d;d--)c=h._markers[d],l&&l.contains(c._latlng)||(h._group._featureGroup.removeLayer(c),c.clusterShow&&c.clusterShow())},function(h){for(d=h._childClusters.length-1;0<=d;d--)c=h._childClusters[d],l&&l.contains(c._latlng)||(h._group._featureGroup.removeLayer(c),c.clusterShow&&c.clusterShow())})},_recursively:function(e,n,a,l,c){var d,h,p=this._childClusters,f=this._zoom;if(n<=f&&(l&&l(this),c&&f===a&&c(this)),f<n||f<a)for(d=p.length-1;0<=d;d--)(h=p[d])._boundsNeedUpdate&&h._recalculateBounds(),e.intersects(h._bounds)&&h._recursively(e,n,a,l,c)},_isSingleParent:function(){return 0<this._childClusters.length&&this._childClusters[0]._childCount===this._childCount}});L.Marker.include({clusterHide:function(){var e=this.options.opacity;return this.setOpacity(0),this.options.opacity=e,this},clusterShow:function(){return this.setOpacity(this.options.opacity)}}),L.DistanceGrid=function(e){this._cellSize=e,this._sqCellSize=e*e,this._grid={},this._objectPoint={}},L.DistanceGrid.prototype={addObject:function(e,n){var a=this._getCoord(n.x),l=this._getCoord(n.y),c=this._grid,d=c[l]=c[l]||{},h=d[a]=d[a]||[],p=L.Util.stamp(e);this._objectPoint[p]=n,h.push(e)},updateObject:function(e,n){this.removeObject(e),this.addObject(e,n)},removeObject:function(e,n){var a,l,c=this._getCoord(n.x),d=this._getCoord(n.y),h=this._grid,p=h[d]=h[d]||{},f=p[c]=p[c]||[];for(delete this._objectPoint[L.Util.stamp(e)],a=0,l=f.length;a<l;a++)if(f[a]===e)return f.splice(a,1),l===1&&delete p[c],!0},eachObject:function(e,n){var a,l,c,d,h,p,f=this._grid;for(a in f)for(l in h=f[a])for(c=0,d=(p=h[l]).length;c<d;c++)e.call(n,p[c])&&(c--,d--)},getNearObject:function(e){var n,a,l,c,d,h,p,f,m=this._getCoord(e.x),y=this._getCoord(e.y),M=this._objectPoint,v=this._sqCellSize,F=null;for(n=y-1;n<=y+1;n++)if(c=this._grid[n]){for(a=m-1;a<=m+1;a++)if(d=c[a])for(l=0,h=d.length;l<h;l++)p=d[l],((f=this._sqDist(M[L.Util.stamp(p)],e))<v||f<=v&&F===null)&&(v=f,F=p)}return F},_getCoord:function(e){var n=Math.floor(e/this._cellSize);return isFinite(n)?n:e},_sqDist:function(e,n){var a=n.x-e.x,l=n.y-e.y;return a*a+l*l}},L.QuickHull={getDistant:function(e,n){var a=n[1].lat-n[0].lat;return(n[0].lng-n[1].lng)*(e.lat-n[0].lat)+a*(e.lng-n[0].lng)},findMostDistantPointFromBaseLine:function(e,n){var a,l,c,d=0,h=null,p=[];for(a=n.length-1;0<=a;a--)l=n[a],0<(c=this.getDistant(l,e))&&(p.push(l),d<c&&(d=c,h=l));return{maxPoint:h,newPoints:p}},buildConvexHull:function(e,n){var a=[],l=this.findMostDistantPointFromBaseLine(e,n);return l.maxPoint?a=(a=a.concat(this.buildConvexHull([e[0],l.maxPoint],l.newPoints))).concat(this.buildConvexHull([l.maxPoint,e[1]],l.newPoints)):[e[0]]},getConvexHull:function(e){var n,a=!1,l=!1,c=!1,d=!1,h=null,p=null,f=null,m=null,y=null,M=null;for(n=e.length-1;0<=n;n--){var v=e[n];(a===!1||v.lat>a)&&(a=(h=v).lat),(l===!1||v.lat<l)&&(l=(p=v).lat),(c===!1||v.lng>c)&&(c=(f=v).lng),(d===!1||v.lng<d)&&(d=(m=v).lng)}return y=l!==a?(M=p,h):(M=m,f),[].concat(this.buildConvexHull([M,y],e),this.buildConvexHull([y,M],e))}},L.MarkerCluster.include({getConvexHull:function(){var e,n,a=this.getAllChildMarkers(),l=[];for(n=a.length-1;0<=n;n--)e=a[n].getLatLng(),l.push(e);return L.QuickHull.getConvexHull(l)}}),L.MarkerCluster.include({_2PI:2*Math.PI,_circleFootSeparation:25,_circleStartAngle:0,_spiralFootSeparation:28,_spiralLengthStart:11,_spiralLengthFactor:5,_circleSpiralSwitchover:9,spiderfy:function(){if(this._group._spiderfied!==this&&!this._group._inZoomAnimation){var e,n=this.getAllChildMarkers(null,!0),a=this._group._map.latLngToLayerPoint(this._latlng);this._group._unspiderfy(),e=(this._group._spiderfied=this)._group.options.spiderfyShapePositions?this._group.options.spiderfyShapePositions(n.length,a):n.length>=this._circleSpiralSwitchover?this._generatePointsSpiral(n.length,a):(a.y+=10,this._generatePointsCircle(n.length,a)),this._animationSpiderfy(n,e)}},unspiderfy:function(e){this._group._inZoomAnimation||(this._animationUnspiderfy(e),this._group._spiderfied=null)},_generatePointsCircle:function(e,n){var a,l,c=this._group.options.spiderfyDistanceMultiplier*this._circleFootSeparation*(2+e)/this._2PI,d=this._2PI/e,h=[];for(c=Math.max(c,35),h.length=e,a=0;a<e;a++)l=this._circleStartAngle+a*d,h[a]=new L.Point(n.x+c*Math.cos(l),n.y+c*Math.sin(l))._round();return h},_generatePointsSpiral:function(e,n){var a,l=this._group.options.spiderfyDistanceMultiplier,c=l*this._spiralLengthStart,d=l*this._spiralFootSeparation,h=l*this._spiralLengthFactor*this._2PI,p=0,f=[];for(a=f.length=e;0<=a;a--)a<e&&(f[a]=new L.Point(n.x+c*Math.cos(p),n.y+c*Math.sin(p))._round()),c+=h/(p+=d/c+5e-4*a);return f},_noanimationUnspiderfy:function(){var e,n,a=this._group,l=a._map,c=a._featureGroup,d=this.getAllChildMarkers(null,!0);for(a._ignoreMove=!0,this.setOpacity(1),n=d.length-1;0<=n;n--)e=d[n],c.removeLayer(e),e._preSpiderfyLatlng&&(e.setLatLng(e._preSpiderfyLatlng),delete e._preSpiderfyLatlng),e.setZIndexOffset&&e.setZIndexOffset(0),e._spiderLeg&&(l.removeLayer(e._spiderLeg),delete e._spiderLeg);a.fire("unspiderfied",{cluster:this,markers:d}),a._ignoreMove=!1,a._spiderfied=null}}),L.MarkerClusterNonAnimated=L.MarkerCluster.extend({_animationSpiderfy:function(e,n){var a,l,c,d,h=this._group,p=h._map,f=h._featureGroup,m=this._group.options.spiderLegPolylineOptions;for(h._ignoreMove=!0,a=0;a<e.length;a++)d=p.layerPointToLatLng(n[a]),l=e[a],c=new L.Polyline([this._latlng,d],m),p.addLayer(c),l._spiderLeg=c,l._preSpiderfyLatlng=l._latlng,l.setLatLng(d),l.setZIndexOffset&&l.setZIndexOffset(1e6),f.addLayer(l);this.setOpacity(.3),h._ignoreMove=!1,h.fire("spiderfied",{cluster:this,markers:e})},_animationUnspiderfy:function(){this._noanimationUnspiderfy()}}),L.MarkerCluster.include({_animationSpiderfy:function(e,n){var a,l,c,d,h,p,f=this,m=this._group,y=m._map,M=m._featureGroup,v=this._latlng,F=y.latLngToLayerPoint(v),x=L.Path.SVG,A=L.extend({},this._group.options.spiderLegPolylineOptions),T=A.opacity;for(T===void 0&&(T=L.MarkerClusterGroup.prototype.options.spiderLegPolylineOptions.opacity),x?(A.opacity=0,A.className=(A.className||"")+" leaflet-cluster-spider-leg"):A.opacity=T,m._ignoreMove=!0,a=0;a<e.length;a++)l=e[a],p=y.layerPointToLatLng(n[a]),c=new L.Polyline([v,p],A),y.addLayer(c),l._spiderLeg=c,x&&(h=(d=c._path).getTotalLength()+.1,d.style.strokeDasharray=h,d.style.strokeDashoffset=h),l.setZIndexOffset&&l.setZIndexOffset(1e6),l.clusterHide&&l.clusterHide(),M.addLayer(l),l._setPos&&l._setPos(F);for(m._forceLayout(),m._animationStart(),a=e.length-1;0<=a;a--)p=y.layerPointToLatLng(n[a]),(l=e[a])._preSpiderfyLatlng=l._latlng,l.setLatLng(p),l.clusterShow&&l.clusterShow(),x&&((d=(c=l._spiderLeg)._path).style.strokeDashoffset=0,c.setStyle({opacity:T}));this.setOpacity(.3),m._ignoreMove=!1,setTimeout(function(){m._animationEnd(),m.fire("spiderfied",{cluster:f,markers:e})},200)},_animationUnspiderfy:function(e){var n,a,l,c,d,h,p=this,f=this._group,m=f._map,y=f._featureGroup,M=e?m._latLngToNewLayerPoint(this._latlng,e.zoom,e.center):m.latLngToLayerPoint(this._latlng),v=this.getAllChildMarkers(null,!0),F=L.Path.SVG;for(f._ignoreMove=!0,f._animationStart(),this.setOpacity(1),a=v.length-1;0<=a;a--)(n=v[a])._preSpiderfyLatlng&&(n.closePopup(),n.setLatLng(n._preSpiderfyLatlng),delete n._preSpiderfyLatlng,h=!0,n._setPos&&(n._setPos(M),h=!1),n.clusterHide&&(n.clusterHide(),h=!1),h&&y.removeLayer(n),F&&(d=(c=(l=n._spiderLeg)._path).getTotalLength()+.1,c.style.strokeDashoffset=d,l.setStyle({opacity:0})));f._ignoreMove=!1,setTimeout(function(){var x=0;for(a=v.length-1;0<=a;a--)(n=v[a])._spiderLeg&&x++;for(a=v.length-1;0<=a;a--)(n=v[a])._spiderLeg&&(n.clusterShow&&n.clusterShow(),n.setZIndexOffset&&n.setZIndexOffset(0),1<x&&y.removeLayer(n),m.removeLayer(n._spiderLeg),delete n._spiderLeg);f._animationEnd(),f.fire("unspiderfied",{cluster:p,markers:v})},200)}}),L.MarkerClusterGroup.include({_spiderfied:null,unspiderfy:function(){this._unspiderfy.apply(this,arguments)},_spiderfierOnAdd:function(){this._map.on("click",this._unspiderfyWrapper,this),this._map.options.zoomAnimation&&this._map.on("zoomstart",this._unspiderfyZoomStart,this),this._map.on("zoomend",this._noanimationUnspiderfy,this),L.Browser.touch||this._map.getRenderer(this)},_spiderfierOnRemove:function(){this._map.off("click",this._unspiderfyWrapper,this),this._map.off("zoomstart",this._unspiderfyZoomStart,this),this._map.off("zoomanim",this._unspiderfyZoomAnim,this),this._map.off("zoomend",this._noanimationUnspiderfy,this),this._noanimationUnspiderfy()},_unspiderfyZoomStart:function(){this._map&&this._map.on("zoomanim",this._unspiderfyZoomAnim,this)},_unspiderfyZoomAnim:function(e){L.DomUtil.hasClass(this._map._mapPane,"leaflet-touching")||(this._map.off("zoomanim",this._unspiderfyZoomAnim,this),this._unspiderfy(e))},_unspiderfyWrapper:function(){this._unspiderfy()},_unspiderfy:function(e){this._spiderfied&&this._spiderfied.unspiderfy(e)},_noanimationUnspiderfy:function(){this._spiderfied&&this._spiderfied._noanimationUnspiderfy()},_unspiderfyLayer:function(e){e._spiderLeg&&(this._featureGroup.removeLayer(e),e.clusterShow&&e.clusterShow(),e.setZIndexOffset&&e.setZIndexOffset(0),this._map.removeLayer(e._spiderLeg),delete e._spiderLeg)}}),L.MarkerClusterGroup.include({refreshClusters:function(e){return e?e instanceof L.MarkerClusterGroup?e=e._topClusterLevel.getAllChildMarkers():e instanceof L.LayerGroup?e=e._layers:e instanceof L.MarkerCluster?e=e.getAllChildMarkers():e instanceof L.Marker&&(e=[e]):e=this._topClusterLevel.getAllChildMarkers(),this._flagParentsIconsNeedUpdate(e),this._refreshClustersIcons(),this.options.singleMarkerMode&&this._refreshSingleMarkerModeMarkers(e),this},_flagParentsIconsNeedUpdate:function(e){var n,a;for(n in e)for(a=e[n].__parent;a;)a._iconNeedsUpdate=!0,a=a.__parent},_refreshSingleMarkerModeMarkers:function(e){var n,a;for(n in e)a=e[n],this.hasLayer(a)&&a.setIcon(this._overrideMarkerIcon(a))}}),L.Marker.include({refreshIconOptions:function(e,n){var a=this.options.icon;return L.setOptions(a,e),this.setIcon(a),n&&this.__parent&&this.__parent._group.refreshClusters(this),this}}),r.MarkerClusterGroup=o,r.MarkerCluster=s,Object.defineProperty(r,"__esModule",{value:!0})})})(P,P.exports)),P.exports}Te();const Se=!1,I=Object.freeze({SECOND:1e3,MINUTE:60*1e3,HOUR:3600*1e3,DAY:1440*60*1e3}),g=Object.freeze({jsonUrl:"https://jasha256.github.io/fam-trainingsplan/trainingsplan.json",versionUrl:"https://jasha256.github.io/fam-trainingsplan/version.json",cacheEnabled:!0,cacheKey:"trainingsplan_cache_v3",cacheDuration:I.HOUR,favoritesKey:"trainingsplan_favorites_v1",search:Object.freeze({debounceDelay:300,minQueryLength:2,maxResults:100,fuseOptions:Object.freeze({keys:Object.freeze([{name:"training",weight:2},{name:"ort",weight:1.5},{name:"trainer",weight:1},{name:"wochentag",weight:.8},{name:"altersgruppe",weight:.5}]),threshold:.3,distance:100,minMatchCharLength:2,includeScore:!0,includeMatches:!0,ignoreLocation:!0,useExtendedSearch:!1})}),filters:Object.freeze({persistInUrl:!0,debounceDelay:100,urlParams:Object.freeze({wochentag:"tag",ort:"ort",training:"art",altersgruppe:"alter",searchTerm:"suche",nearby:"naehe"})}),map:Object.freeze({defaultCenter:Object.freeze([48.137154,11.576124]),defaultZoom:12,maxZoom:19,minZoom:10,tileLayerUrl:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a>',geolocation:Object.freeze({enableHighAccuracy:!0,timeout:10*I.SECOND,maximumAge:5*I.MINUTE,maxDistance:50,errorMessages:Object.freeze({PERMISSION_DENIED:"Standort-Berechtigung verweigert",POSITION_UNAVAILABLE:"Standort nicht verfügbar",TIMEOUT:"Standort-Anfrage Timeout",UNKNOWN:"Unbekannter Standort-Fehler"})}),clustering:Object.freeze({enabled:!0,maxClusterRadius:80,spiderfyOnMaxZoom:!0,showCoverageOnHover:!0,zoomToBoundsOnClick:!0})}),ui:Object.freeze({mobileBreakpoint:768,filterDebounce:100,notificationDuration:3e3,animationDuration:300,touch:Object.freeze({swipeThreshold:100,swipeVelocity:.3,swipeMaxTime:1e3,swipeMaxVertical:100}),lazyLoadThreshold:"50px",lazyLoadRootMargin:"100px"}),performance:Object.freeze({enableVirtualScroll:!1,lazyLoadImages:!0,prefetchData:!0,useRequestIdleCallback:typeof requestIdleCallback<"u"}),features:Object.freeze({enableMap:!0,enableSearch:!0,enableQuickFilters:!0,enablePersistence:!0,enableLazyLoading:!0,enableAnalytics:!1,enableShareLinks:!0,enablePrintView:!0,enableDarkMode:!1,enableNotifications:!0,enableOfflineMode:!0,enableFavorites:!0,enableGeolocation:!0,enableUpdateCheck:!0,enableCalendarExport:!0,enableTouchGestures:!0,enableBulkExport:!0}),favorites:Object.freeze({maxCount:100,syncAcrossDevices:!1}),errors:Object.freeze({maxRetries:3,retryDelay:I.SECOND,retryBackoff:2,showUserFriendlyMessages:!0,logToConsole:!0}),logging:Object.freeze({enabled:Se,level:"error",logToConsole:!0,logToServer:!1,levels:Object.freeze({debug:0,info:1,warn:2,error:3})}),iframe:Object.freeze({enabled:!0,parentOrigin:"https://www.freeartsofmovement.com",allowedOrigins:Object.freeze(["https://www.freeartsofmovement.com","http://localhost:5173","http://127.0.0.1:5173"]),debounceDelay:50,minHeight:400,maxHeight:1e4,autoResize:!0}),pwa:Object.freeze({enabled:!0,name:"FAM Trainingsplan",shortName:"FAM",description:"Trainingsplan für Free Arts of Movement",version:"3.0.0",themeColor:"#005892",backgroundColor:"#005892",display:"standalone",orientation:"portrait-primary",scope:"/",startUrl:"/",updateStrategy:"prompt",updateCheckInterval:I.HOUR,offlinePages:Object.freeze(["/","/offline.html"])})});function Fe(i){if(!g.logging.enabled)return!1;const t=g.logging.levels[g.logging.level]??3;return(g.logging.levels[i]??0)>=t}function u(i,t,...r){if(!Fe(i))return;const o=`[trainingsplan:${i}]`,s=new Date().toISOString(),e=r.length>0?r:[];({debug:console.log,info:console.info,warn:console.warn,error:console.error}[i]||console.log)(o,s,t,...e)}let $=null;function W(){if($)return $;const i=()=>{try{const t="__storage_test__";return localStorage.setItem(t,t),localStorage.removeItem(t),!0}catch{return!1}};return $=Object.freeze({isMobile:window.innerWidth<g.ui.mobileBreakpoint,isTouch:"ontouchstart"in window||navigator.maxTouchPoints>0,supportsLocalStorage:i(),supportsGeolocation:"geolocation"in navigator,supportsIntersectionObserver:"IntersectionObserver"in window,supportsResizeObserver:"ResizeObserver"in window,supportsMutationObserver:"MutationObserver"in window,supportsServiceWorker:"serviceWorker"in navigator,supportsShareAPI:"share"in navigator,supportsClipboardAPI:"clipboard"in navigator,isStandalone:window.matchMedia("(display-mode: standalone)").matches||window.navigator.standalone===!0,connection:navigator.connection?Object.freeze({effectiveType:navigator.connection.effectiveType,downlink:navigator.connection.downlink,rtt:navigator.connection.rtt,saveData:navigator.connection.saveData}):null}),$}const B=new Map;function Ae(i){return B.has(i)||B.set(i,structuredClone(g[i])),B.get(i)}function Oe(){return Ae("map")}function Ee(i,t=300){let r;return function(...s){const e=()=>{clearTimeout(r),i(...s)};clearTimeout(r),r=setTimeout(e,t)}}function q(i,t=100){let r;return function(...s){r||(i(...s),r=!0,setTimeout(()=>{r=!1},t))}}function Ie(i){if(typeof i!="string")return"0";let t=0;for(let r=0;r<i.length;r++){const o=i.charCodeAt(r);t=(t<<5)-t+o,t=t&t}return t.toString()}function Pe(i,t){if(!i||!t)return"";const r=o=>{const[s,e]=o.split(":");return`${parseInt(s,10)}:${e}`};return`${r(i)} - ${r(t)} Uhr`}function K(i){return i?i.altersgruppe&&typeof i.altersgruppe=="string"?i.altersgruppe:i.alterVon&&i.alterBis?`${i.alterVon} - ${i.alterBis} Jahre`:i.alterVon?`ab ${i.alterVon} Jahren`:"Alle Altersgruppen":""}function $e(i){if(typeof i!="string")return"";const t=document.createElement("div");return t.textContent=i,t.innerHTML}function De(i){try{const t=new URL(i);return t.protocol==="http:"||t.protocol==="https:"}catch{return!1}}function ze(i,t,r){return i===1?t:r}function Ne(i){return typeof i!="number"||Number.isNaN(i)?"0":i>=1e6?(i/1e6).toFixed(1)+"M":i>=1e3?(i/1e3).toFixed(1)+"k":i.toString()}function re(i,t=2){const r=10**t;return Math.round(i*r)/r}function Ue(i,t){if(!Array.isArray(i))return[];const r=i.map(o=>o[t]).filter(o=>o!=null&&String(o).trim()!=="");return[...new Set(r.map(o=>String(o)))].sort((o,s)=>o.localeCompare(s,"de"))}function Ge(i,t){if(!Array.isArray(i))return{};if(Object.groupBy)return Object.groupBy(i,o=>String(o[t]||"undefined"));const r={};return i.reduce((o,s)=>{const e=String(s[t]||"undefined");return o[e]||(o[e]=[]),o[e].push(s),o},r)}function Re(i){if(!Array.isArray(i))return[];const t=[...i];for(let r=t.length-1;r>0;r--){const o=Math.floor(Math.random()*(r+1));[t[r],t[o]]=[t[o],t[r]]}return t}async function Be(){const i=Oe().geolocation;if(!navigator.geolocation)throw new Error("Geolocation nicht unterstützt");return new Promise((t,r)=>{const o={enableHighAccuracy:i.enableHighAccuracy,timeout:i.timeout,maximumAge:i.maximumAge};navigator.geolocation.getCurrentPosition(s=>{t({lat:s.coords.latitude,lng:s.coords.longitude,accuracy:s.coords.accuracy})},s=>{const e=i.errorMessages;let n=e.UNKNOWN;switch(s.code){case s.PERMISSION_DENIED:n=e.PERMISSION_DENIED;break;case s.POSITION_UNAVAILABLE:n=e.POSITION_UNAVAILABLE;break;case s.TIMEOUT:n=e.TIMEOUT;break}r(new Error(n))},o)})}function ie(i,t,r,o){const e=D(r-i),n=D(o-t),a=Math.sin(e/2)*Math.sin(e/2)+Math.cos(D(i))*Math.cos(D(r))*Math.sin(n/2)*Math.sin(n/2),c=6371*(2*Math.atan2(Math.sqrt(a),Math.sqrt(1-a)));return re(c,1)}function D(i){return i*(Math.PI/180)}function He(i,t){return!Array.isArray(i)||!t?i:i.map(r=>{if(r.lat&&r.lng){const o=ie(t.lat,t.lng,r.lat,r.lng);return{...r,distance:o}}return r})}function z(i){if(!i)return null;const r={Montag:1,Dienstag:2,Mittwoch:3,Donnerstag:4,Freitag:5,Samstag:6,Sonntag:0}[i];if(r===void 0)return null;const o=new Date,s=o.getDay();let e=r-s;e<0&&(e+=7),e===0&&o.getHours()>=20&&(e=7);const n=new Date(o);return n.setDate(o.getDate()+e),n.setHours(0,0,0,0),n}function E(i){return i.toISOString().replace(/[-:]/g,"").split(".")[0]+"Z"}function je(i){if(!i||typeof i!="string")return 0;const[t,r]=i.split(":").map(o=>parseInt(o,10));return Number.isNaN(t)||Number.isNaN(r)?0:t*60+r}function Q(i){const t=z(i.wochentag);if(!t)return null;const r=i.von.split(":"),o=i.bis.split(":"),s=new Date(t);s.setHours(parseInt(r[0],10),parseInt(r[1],10),0);const e=new Date(t);e.setHours(parseInt(o[0],10),parseInt(o[1],10),0);const n=[i.training,"Altersgruppe: "+K(i),i.trainer?"Trainer: "+i.trainer:"",i.anmerkung?"Hinweis: "+i.anmerkung:"",i.link?"Anmeldung: "+i.link:""].filter(Boolean).join("\\n");return["BEGIN:VCALENDAR","VERSION:2.0","PRODID:-//FAM Trainingsplan//DE","CALSCALE:GREGORIAN","METHOD:PUBLISH","BEGIN:VEVENT",`UID:${i.id}@fam-trainingsplan`,`DTSTAMP:${E(new Date)}`,`DTSTART:${E(s)}`,`DTEND:${E(e)}`,`SUMMARY:${i.training} - ${i.ort}`,`DESCRIPTION:${n}`,`LOCATION:${i.ort}`,i.link?`URL:${i.link}`:"","STATUS:CONFIRMED","SEQUENCE:0","END:VEVENT","END:VCALENDAR"].filter(Boolean).join(`\r
`)}function Ze(i){if(!Array.isArray(i)||i.length===0)throw new Error("Trainings array is empty or invalid");const t=[];if(i.forEach(r=>{const o=z(r.wochentag);if(o)try{const s=r.von.split(":"),e=r.bis.split(":"),n=new Date(o);n.setHours(parseInt(s[0],10),parseInt(s[1],10),0);const a=new Date(o);a.setHours(parseInt(e[0],10),parseInt(e[1],10),0);const l=[r.training,"Altersgruppe: "+K(r),r.trainer?"Trainer: "+r.trainer:"",r.anmerkung?"Hinweis: "+r.anmerkung:"",r.link?"Anmeldung: "+r.link:""].filter(Boolean).join("\\n"),d={Montag:"MO",Dienstag:"TU",Mittwoch:"WE",Donnerstag:"TH",Freitag:"FR",Samstag:"SA",Sonntag:"SU"}[r.wochentag]||"MO",h=["BEGIN:VEVENT",`UID:${r.id}@fam-trainingsplan`,`DTSTAMP:${E(new Date)}`,`DTSTART:${E(n)}`,`DTEND:${E(a)}`,`SUMMARY:${r.training} - ${r.ort}`,`DESCRIPTION:${l}`,`LOCATION:${r.ort}`,r.link?`URL:${r.link}`:"","STATUS:CONFIRMED",`RRULE:FREQ=WEEKLY;BYDAY=${d};COUNT=52`,"END:VEVENT"].filter(Boolean).join(`\r
`);t.push(h)}catch(s){u("warn",`Skipping invalid training: ${r.id}`,s)}}),t.length===0)throw new Error("No valid events to export");return["BEGIN:VCALENDAR","VERSION:2.0","PRODID:-//FAM Trainingsplan//DE","CALSCALE:GREGORIAN","METHOD:PUBLISH","X-WR-CALNAME:FAM Trainingsplan","X-WR-CALDESC:Free Arts of Movement München","X-WR-TIMEZONE:Europe/Berlin",...t,"END:VCALENDAR"].join(`\r
`)}function Ve(i,t="training.ics"){try{const r=new Blob([i],{type:"text/calendar;charset=utf-8"}),o=window.URL.createObjectURL(r),s=document.createElement("a");s.href=o,s.download=t,document.body.appendChild(s),s.click(),document.body.removeChild(s),window.URL.revokeObjectURL(o),u("info","iCal file downloaded",{filename:t})}catch(r){throw u("error","iCal download failed",r),r}}function We(i){const t=new URLSearchParams,r=g.filters.urlParams;Object.entries(i).forEach(([e,n])=>{if(!n||n===null||e==="activeQuickFilter"||e.startsWith("_custom"))return;const a=r[e]||e;Array.isArray(n)&&n.length>0?t.set(a,n.join(",")):n!==""&&typeof n!="object"&&t.set(a,String(n))});const o=t.toString(),s=window.location.origin+window.location.pathname;return o?`${s}?${o}`:s}function qe(){const i=new URLSearchParams(window.location.search),t=g.filters.urlParams,r=Object.fromEntries(Object.entries(t).map(([s,e])=>[e,s])),o={wochentag:[],ort:[],training:[],altersgruppe:[],searchTerm:"",nearby:!1};return i.forEach((s,e)=>{const n=r[e]||e;n in o&&(["wochentag","ort","training","altersgruppe"].includes(n)?o[n]=s?s.split(",").map(a=>a.trim()).filter(a=>a):[]:n==="nearby"?o[n]=s==="true":o[n]=s)}),o}async function Ke(i){if(navigator.clipboard&&navigator.clipboard.writeText)try{return await navigator.clipboard.writeText(i),u("info","Text copied to clipboard"),!0}catch(t){u("warn","Clipboard API failed, falling back",t)}try{const t=document.createElement("textarea");t.value=i,t.style.position="fixed",t.style.left="-9999px",t.style.opacity="0",document.body.appendChild(t),t.select();const r=document.execCommand("copy");return document.body.removeChild(t),r&&u("info","Text copied (fallback)"),r}catch(t){return u("error","Copy to clipboard failed",t),!1}}const H={get(i,t=null){try{const r=localStorage.getItem(i);return r?JSON.parse(r):t}catch(r){return u("error","localStorage.get failed",r),t}},set(i,t){try{return localStorage.setItem(i,JSON.stringify(t)),!0}catch(r){return u("error","localStorage.set failed",r),!1}},remove(i){try{return localStorage.removeItem(i),!0}catch(t){return u("error","localStorage.remove failed",t),!1}},clear(){try{return localStorage.clear(),!0}catch(i){return u("error","localStorage.clear failed",i),!1}},has(i){return localStorage.getItem(i)!==null},keys(){return Object.keys(localStorage)}},Qe={load(){return H.get(g.favoritesKey,[])},save(i){const r=(Array.isArray(i)?i.filter(o=>typeof o=="number"||typeof o=="string"):[]).slice(0,g.favorites.maxCount);return H.set(g.favoritesKey,r)},add(i){const t=this.load();return t.includes(i)?!1:(t.push(i),this.save(t))},remove(i){const t=this.load(),r=t.filter(o=>o!==i);return r.length!==t.length?this.save(r):!1},toggle(i){return this.has(i)?(this.remove(i),!1):(this.add(i),!0)},has(i){return this.load().includes(i)},count(){return this.load().length},clear(){return this.save([])}},C={debounce:Ee,throttle:q,generateHash:Ie,formatZeitrange:Pe,formatAlter:K,sanitizeHtml:$e,isValidUrl:De,pluralize:ze,formatNumber:Ne,roundTo:re,extractUnique:Ue,groupBy:Ge,shuffle:Re,getCurrentPosition:Be,calculateDistance:ie,addDistanceToTrainings:He,getNextTrainingDate:z,formatICalDate:E,zeitZuMinuten:je,createICalEvent:Q,createICalBundle:Ze,downloadICalFile:Ve,createShareLink:We,getFiltersFromUrl:qe,copyToClipboard:Ke,storage:H,favorites:Qe};function Ye(){return{allTrainings:[],filteredTrainings:[],metadata:null,loading:!0,error:null,fromCache:!1,searchTimeout:null,fuse:null,map:null,markers:[],markerClusterGroup:null,userHasInteractedWithMap:!1,tileLayer:null,tileLayers:null,layerControl:null,geolocationControl:null,resetControl:null,ariaLiveRegion:null,userLocationMarker:null,userPosition:null,geolocationError:null,geolocationLoading:!1,favorites:[],updateAvailable:!1,latestVersion:null,updateCheckInterval:null,wochentagOrder:{Montag:1,Dienstag:2,Mittwoch:3,Donnerstag:4,Freitag:5,Samstag:6,Sonntag:7}}}class Xe{constructor(t){this.context=t}loadFiltersFromUrl(){const t=C.getFiltersFromUrl();Object.assign(this.context.$store.ui.filters,t),u("debug","URL filters loaded",t)}updateUrlWithFilters(){if(!g.filters.persistInUrl)return;const t=C.createShareLink(this.context.$store.ui.filters);window.history.replaceState({},"",t)}}class Je{constructor(t,r,o){this.state=t,this.context=r,this.isFavorite=o.isFavorite,this.updateUrl=o.updateUrl}applyFilters(){const t=this.context.$store.ui.filters;let r=[...this.context.allTrainings];if(typeof t._customPersonalFilter=="string"&&this.matchesCustomPersonalFilter(t._customPersonalFilter)){r=r.filter(o=>this.isFavorite(o.id)),this._finalizeFiltering(r);return}typeof t._customTimeFilter=="string"&&this.hasCustomTimeFilter(t._customTimeFilter)?r=this.applyCustomTimeFilter(r,t._customTimeFilter):r=this.applyStandardWeekdayFilter(r,t.wochentag),typeof t._customFeatureFilter=="string"&&this.hasCustomFeatureFilter(t._customFeatureFilter)&&(r=this.applyCustomFeatureFilter(r,t._customFeatureFilter)),typeof t._customLocationFilter=="string"&&this.hasCustomLocationFilter(t._customLocationFilter)?r=this.applyCustomLocationFilter(r,t._customLocationFilter):r=this.applyStandardLocationFilter(r,t.ort),r=this.applyTrainingTypeFilter(r,t.training),r=this.applyAgeGroupFilter(r,t.altersgruppe),r=this.applySearchFilter(r,t.searchTerm),!t._customLocationFilter&&this.context.userPosition&&g.map.geolocation.maxDistance>0&&(r=r.filter(o=>o.distance&&o.distance<=g.map.geolocation.maxDistance)),this.context.userPosition&&r.sort((o,s)=>(o.distance||999)-(s.distance||999)),this._finalizeFiltering(r)}matchesCustomPersonalFilter(t){return t==="favoriten"}hasCustomTimeFilter(t){return t==="wochenende"||t==="wochentags"}applyCustomTimeFilter(t,r){return r==="wochenende"?t.filter(o=>o.wochentag==="Samstag"||o.wochentag==="Sonntag"):r==="wochentags"?t.filter(o=>o.wochentag&&o.wochentag!=="Samstag"&&o.wochentag!=="Sonntag"):t}hasCustomFeatureFilter(t){return t==="probetraining"}applyCustomFeatureFilter(t,r){return r==="probetraining"?t.filter(o=>o.probetraining?.toLowerCase()==="ja"):t}hasCustomLocationFilter(t){return t==="inMeinerNaehe"}applyCustomLocationFilter(t,r){return r==="inMeinerNaehe"?t.filter(o=>{if(!o.distance)return!1;const s=typeof o.distance=="number"?o.distance:parseFloat(String(o.distance));return!isNaN(s)&&s<=5}):t}applyStandardWeekdayFilter(t,r){if(!this.hasFilterValue(r))return t;const o=this.normalizeToArray(r||"");return t.filter(s=>s.wochentag&&o.some(e=>s.wochentag.toLowerCase()===e.toLowerCase()))}applyStandardLocationFilter(t,r){if(!this.hasFilterValue(r))return t;const o=this.normalizeToArray(r||"");return t.filter(s=>s.ort&&o.some(e=>s.ort.toLowerCase()===e.toLowerCase()))}applyTrainingTypeFilter(t,r){if(!this.hasFilterValue(r))return t;const o=this.normalizeToArray(r||"");return t.filter(s=>s.training&&o.some(e=>s.training.toLowerCase().includes(e.toLowerCase())))}applyAgeGroupFilter(t,r){if(!this.hasFilterValue(r))return t;const o=this.normalizeToArray(r||"");return t.filter(s=>o.some(e=>this.matchesAltersgruppe(s,e)))}applySearchFilter(t,r){if(!r||!r.trim()||!this.context.fuse)return t;const o=this.context.fuse.search(r.trim()),s=new Set(o.map(e=>e.item.id));return t.filter(e=>s.has(e.id))}_finalizeFiltering(t){this.context.filteredTrainings=t,g.filters.persistInUrl&&this.updateUrl(),u("debug","Filters applied",{total:this.context.allTrainings.length,filtered:t.length})}hasFilterValue(t){return t?Array.isArray(t)?t.length>0:typeof t=="string"?t.trim()!=="":!1:!1}normalizeToArray(t){return Array.isArray(t)?t.filter(r=>r&&r.trim()!==""):typeof t=="string"&&t.trim()!==""?[t.trim()]:[]}matchesAltersgruppe(t,r){return t.altersgruppe?String(t.altersgruppe).split(",").map(s=>s.trim().toLowerCase()).some(s=>s===r.toLowerCase()):!1}}class et{constructor(t,r,o){this.state=t,this.context=r,this.applyFilters=o.applyFilters}loadFavorites(){this.context.favorites=C.favorites.load(),u("debug","Favorites loaded",{count:this.context.favorites.length})}isFavorite(t){return this.context.favorites.includes(t)}toggleFavorite(t){const r=C.favorites.toggle(t);return this.loadFavorites(),this.context.$nextTick(()=>{this.context.$store.ui.filters.activeQuickFilter==="favoriten"&&this.applyFilters()}),this.context.$store.ui.showNotification(r?"Zu Favoriten hinzugef�gt P":"Von Favoriten entfernt","info",2e3),r}quickFilterFavorites(){this.context.$store.ui.filters.activeQuickFilter==="favoriten"?this.context.$store.ui.filters={wochentag:"",ort:"",training:"",altersgruppe:"",searchTerm:"",activeQuickFilter:null}:this.context.$store.ui.filters={wochentag:"",ort:"",training:"",altersgruppe:"",searchTerm:"",activeQuickFilter:"favoriten"},this.applyFilters()}}class tt{constructor(t,r,o){this.state=t,this.context=r,this.applyFilters=o.applyFilters,this.mapManager=o.mapManager||null,this.loadManualLocation()}loadManualLocation(){if(this.context.$store.ui.manualLocationSet&&this.context.$store.ui.manualLocation){const t=this.context.$store.ui.manualLocation;if(this.context.userPosition=t,u("info","Manual location loaded",this.context.userPosition),this.addDistanceToTrainings(),this.mapManager&&this.context.map&&this.context.userPosition){const{lat:r,lng:o}=this.context.userPosition;this.mapManager.addUserLocationMarker([r,o])}}}async requestUserLocation(){if(!g.features.enableGeolocation)return this.context.geolocationError="Geolocation ist deaktiviert",!1;this.context.geolocationLoading=!0,this.context.geolocationError=null;try{if(this.context.userPosition=await C.getCurrentPosition(),u("info","Position obtained",this.context.userPosition),this.addDistanceToTrainings(),this.applyFilters(),this.mapManager&&this.context.map&&this.context.userPosition){const{lat:t,lng:r}=this.context.userPosition;this.mapManager.addUserLocationMarker([t,r])}return this.context.$store.ui.showNotification("Standort ermittelt! 📍","success",2e3),!0}catch(t){u("error","Geolocation failed",t);const r=t instanceof Error?t.message:String(t);return this.context.geolocationError=r,this.context.$store.ui.showNotification(r,"error",5e3),!1}finally{this.context.geolocationLoading=!1}}addDistanceToTrainings(){this.context.userPosition&&(this.context.allTrainings=C.addDistanceToTrainings(this.context.allTrainings,this.context.userPosition),this.context.allTrainings.forEach(t=>{t.distance!==void 0&&(t.distanceText=t.distance.toFixed(1)+" km")}))}setManualLocation(t,r,o=""){this.context.userPosition={lat:t,lng:r},this.context.$store.ui.manualLocation={lat:t,lng:r},this.context.$store.ui.manualLocationAddress=o,this.context.$store.ui.manualLocationSet=!0,localStorage.setItem("manualLocation",JSON.stringify({lat:t,lng:r,address:o})),this.addDistanceToTrainings(),this.applyFilters(),this.mapManager&&this.context.map&&this.mapManager.addUserLocationMarker([t,r]),u("info","Manual location set",{lat:t,lng:r,address:o})}resetLocation(){this.context.userPosition=null,this.context.$store.ui.manualLocation=null,this.context.$store.ui.manualLocationAddress="",this.context.$store.ui.manualLocationSet=!1,localStorage.removeItem("manualLocation"),this.context.allTrainings.forEach(t=>{delete t.distance,delete t.distanceText}),this.context.map&&(this.context.userLocationMarker&&(this.context.map.removeLayer(this.context.userLocationMarker),this.context.userLocationMarker=null),this.context.geolocationControl&&this.context.geolocationControl._userMarker&&(this.context.map.removeLayer(this.context.geolocationControl._userMarker),this.context.geolocationControl._userMarker=null)),this.context.$store.ui.filters.activeQuickFilter==="nearby"&&(this.context.$store.ui.filters.activeQuickFilter=null),this.applyFilters(),u("info","Location reset successfully")}}const rt=_.Control.extend({options:{position:"topright",strings:{title:"Mein Standort",locating:"Standort wird ermittelt...",found:"Standort gefunden!",error:"Standort konnte nicht ermittelt werden"}},onAdd(i){this._map=i;const t=_.DomUtil.create("div","leaflet-bar leaflet-control leaflet-control-geolocation");return this._button=_.DomUtil.create("button","md-icon-button",t),this._button.innerHTML=`
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <circle cx="12" cy="12" r="10"></circle>
        <circle cx="12" cy="12" r="3"></circle>
      </svg>
    `,this._button.title=this.options.strings?.title||"Mein Standort",this._button.setAttribute("aria-label",this.options.strings?.title||"Mein Standort"),_.DomEvent.disableClickPropagation(t),_.DomEvent.disableScrollPropagation(t),_.DomEvent.on(this._button,"click",this._handleClick,this),t},onRemove(i){_.DomEvent.off(this._button,"click",this._handleClick,this)},_handleClick(){const i=this.options.geolocationManager;if(i&&i.context?.$store?.ui){const t=i.context.$store.ui.manualLocationSet,r=i.context.$store.ui.manualLocation;if(t&&r){this._setLoading(!0),setTimeout(()=>{const o=_.latLng(r.lat,r.lng);this._setLoading(!1),this._map.setView(o,16,{animate:!0}),this._showSuccess(o);const s=i.context.$store.ui.manualLocationAddress||"",e=s?`Gespeicherter Standort: ${s}`:"Gespeicherter Standort angezeigt";u("info","Using saved manual location",{lat:r.lat,lng:r.lng}),window.Alpine&&window.Alpine.store&&window.Alpine.store("ui").showNotification(e,"success",3e3)},100);return}}if(!navigator.geolocation){this._showError("Geolocation wird von diesem Browser nicht unterstützt");return}this._setLoading(!0),this._map.locate({setView:!0,maxZoom:16,enableHighAccuracy:g.map.geolocation.enableHighAccuracy,timeout:g.map.geolocation.timeout,maximumAge:g.map.geolocation.maximumAge}),this._map.once("locationfound",t=>{this._setLoading(!1),this._showSuccess(t.latlng),u("info","Geolocation found",{lat:t.latlng.lat,lng:t.latlng.lng,accuracy:t.accuracy})}),this._map.once("locationerror",t=>{this._setLoading(!1);let r=this.options.strings?.error||"Fehler";switch(t.code){case 1:r="Standort-Berechtigung verweigert. Bitte in den Browser-Einstellungen erlauben.";break;case 2:r="Standort nicht verfügbar. GPS aktivieren?";break;case 3:r="Standort-Anfrage Timeout. Bitte erneut versuchen.";break}this._showError(r),u("warn","Geolocation error",{code:t.code,message:t.message})})},_setLoading(i){i?(this._button.classList.add("loading"),this._button.disabled=!0,this._button.title=this.options.strings?.locating||"Wird ermittelt..."):(this._button.classList.remove("loading"),this._button.disabled=!1,this._button.title=this.options.strings?.title||"Mein Standort")},_showSuccess(i){this._userMarker&&this._map.removeLayer(this._userMarker),this._userMarker=_.marker(i,{icon:_.divIcon({className:"md-user-location-marker",html:'<div class="pulse"></div>',iconSize:[20,20]}),title:"Mein Standort"}).addTo(this._map),window.Alpine&&window.Alpine.store&&window.Alpine.store("ui").showNotification(this.options.strings?.found||"Standort gefunden","success",3e3)},_showError(i){window.Alpine&&window.Alpine.store&&window.Alpine.store("ui").showNotification(i,"error",5e3)}}),it=_.Control.extend({options:{position:"topright",title:"Ansicht zurücksetzen",bounds:null,center:null,zoom:null},onAdd(i){this._map=i,!this.options.bounds&&!this.options.center&&(this._initialCenter=i.getCenter(),this._initialZoom=i.getZoom());const t=_.DomUtil.create("div","leaflet-bar leaflet-control leaflet-control-reset");return this._button=_.DomUtil.create("button","md-icon-button",t),this._button.innerHTML=`
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"></path>
        <path d="M21 3v5h-5"></path>
        <path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"></path>
        <path d="M3 21v-5h5"></path>
      </svg>
    `,this._button.title=this.options.title||"Ansicht zurücksetzen",this._button.setAttribute("aria-label",this.options.title||"Ansicht zurücksetzen"),_.DomEvent.disableClickPropagation(t),_.DomEvent.disableScrollPropagation(t),_.DomEvent.on(this._button,"click",this._handleClick,this),t},onRemove(i){_.DomEvent.off(this._button,"click",this._handleClick,this)},_handleClick(){this.options.bounds?this._map.fitBounds(this.options.bounds,{padding:[50,50],animate:!0}):this.options.center&&this.options.zoom?this._map.setView(this.options.center,this.options.zoom,{animate:!0}):this._map.setView(this._initialCenter,this._initialZoom,{animate:!0}),u("info","Map view reset")}}),nt=_.Control.extend({options:{position:"topright",title:"Kartenstil wechseln",layers:{},defaultLayer:"street"},onAdd(i){this._map=i,this._currentLayer=this.options.defaultLayer||"street";const t=_.DomUtil.create("div","leaflet-bar leaflet-control leaflet-control-layers-switcher");return this._button=_.DomUtil.create("button","md-icon-button",t),this._button.innerHTML=`
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"></path>
        <polyline points="14 2 14 8 20 8"></polyline>
        <path d="M12 18v-4"></path>
        <path d="M8 16h8"></path>
      </svg>
    `,this._button.title=this.options.title||"Kartenstil wechseln",this._button.setAttribute("aria-label",this.options.title||"Kartenstil wechseln"),this._button.setAttribute("aria-expanded","false"),this._menu=_.DomUtil.create("div","layer-switcher-menu",t),this._menu.style.display="none",Object.keys(this.options.layers||{}).forEach(o=>{const s=_.DomUtil.create("button","layer-option",this._menu);s.textContent=this._getLayerLabel(o),s.setAttribute("data-layer",o),s.setAttribute("role","menuitem"),o===this._currentLayer&&(s.classList.add("active"),s.setAttribute("aria-current","true")),_.DomEvent.on(s,"click",()=>{this._switchLayer(o)})}),_.DomEvent.disableClickPropagation(t),_.DomEvent.disableScrollPropagation(t),_.DomEvent.on(this._button,"click",o=>{const s=this._menu.style.display!=="none";this._menu.style.display=s?"none":"block",this._button.setAttribute("aria-expanded",s?"false":"true")}),_.DomEvent.on(document,"click",o=>{t.contains(o.target)||(this._menu.style.display="none",this._button.setAttribute("aria-expanded","false"))}),t},onRemove(i){_.DomEvent.off(this._button,"click"),_.DomEvent.off(document,"click")},_switchLayer(i){if(i===this._currentLayer)return;const t=this.options.layers?.[this._currentLayer],r=this.options.layers?.[i];r&&(t&&this._map.hasLayer(t)&&this._map.removeLayer(t),this._map.addLayer(r),this._currentLayer=i,this._updateMenuUI(),this._menu.style.display="none",this._button.setAttribute("aria-expanded","false"),u("info",`Switched to ${i} layer`))},_updateMenuUI(){this._menu.querySelectorAll(".layer-option").forEach(t=>{t.getAttribute("data-layer")===this._currentLayer?(t.classList.add("active"),t.setAttribute("aria-current","true")):(t.classList.remove("active"),t.removeAttribute("aria-current"))})},_getLayerLabel(i){return{street:"🗺️ Straßenkarte",satellite:"🛰️ Satellit",terrain:"⛰️ Gelände",dark:"🌙 Dunkel"}[i]||i}});function ot(i={}){return new rt(i)}function at(i={}){return new it(i)}function st(i={}){return new nt(i)}function lt(i=768){return window.innerWidth<i?60:80}function ct(i=768){return window.innerWidth<i?1.5:1}function ut(i){const t=new Map;return i.forEach(r=>{if(!r.lat||!r.lng)return;const o=`${r.lat.toFixed(6)},${r.lng.toFixed(6)}`;t.has(o)||t.set(o,[]),t.get(o).push(r)}),t}function dt(i){const t=i[0].ort||"Standort",r=i[0].adresse||"",o=i.length,s=i.map(n=>({id:n.id,training:n.training,wochentag:n.wochentag,von:n.von,bis:n.bis,altersgruppe:n.altersgruppe,trainer:n.trainer,probetraining:n.probetraining,anmerkung:n.anmerkung,link:n.link}));return`
    <div class="md-map-location-popup"
         data-trainings-b64="${btoa(encodeURIComponent(JSON.stringify(s)))}"
         x-data="{
           trainings: [],
           sortBy: 'day',
           get sorted() {
             const dayOrder = {Montag:1,Dienstag:2,Mittwoch:3,Donnerstag:4,Freitag:5,Samstag:6,Sonntag:7};
             const list = [...this.trainings];
             switch(this.sortBy) {
               case 'day': return list.sort((a,b) => (dayOrder[a.wochentag]||99) - (dayOrder[b.wochentag]||99));
               case 'time': return list.sort((a,b) => (a.von||'00:00').localeCompare(b.von||'00:00'));
               case 'age': return list.sort((a,b) => (parseInt(a.vonalter)||0) - (parseInt(b.vonalter)||0));
               case 'name': return list.sort((a,b) => a.training.localeCompare(b.training));
               default: return list;
             }
           }
         }"
         x-init="trainings = JSON.parse(decodeURIComponent(atob($el.dataset.trainingsB64)))"
      <!-- Header -->
      <div class="md-map-location-header">
        <div class="md-map-popup-icon">📍</div>
        <div class="md-map-popup-title flex-1">
          <h3 class="md-typescale-title-medium font-bold">${t}</h3>
          <p class="md-typescale-body-small opacity-90">${o} Training${o>1?"s":""} an diesem Standort</p>
          ${r?`<p class="md-typescale-body-small opacity-80 mt-0.5">🏠 ${r}</p>`:""}
        </div>
      </div>

      <!-- Sorting Controls -->
      <div class="md-map-location-sort">
        <div class="flex items-center gap-3">
          <label for="sort-select" class="md-typescale-label-medium font-semibold" style="color: var(--md-sys-color-on-surface);">
            Sortieren nach:
          </label>
          <select id="sort-select"
                  x-model="sortBy"
                  class="md-sort-dropdown">
            <option value="day">📅 Wochentag</option>
            <option value="time">🕐 Uhrzeit</option>
            <option value="age">👥 Altersgruppe</option>
            <option value="name">🥋 Trainingsname</option>
          </select>
        </div>
      </div>

      <!-- Scrollable trainings list -->
      <div class="md-map-location-list">
        <template x-for="(training, index) in sorted" :key="training.id">
          <div class="md-map-location-item">
            <!-- Training header with icon -->
            <div class="flex items-start gap-3 mb-3">
              <div class="md-map-popup-icon" style="width: 36px; height: 36px; font-size: 18px; background-color: rgba(var(--color-primary-rgb, 0, 115, 230), 0.15); border-radius: 50%; display: flex; align-items: center; justify-content: center; flex-shrink: 0;">
                🥋
              </div>
              <div class="flex-1 min-w-0">
                <h4 class="md-typescale-title-small font-semibold mb-1" x-text="training.training"></h4>
                <span x-show="training.probetraining === 'ja'"
                      class="inline-flex items-center gap-1 text-xs px-2 py-0.5 rounded-full"
                      style="background-color: var(--md-sys-color-primary-container); color: var(--md-sys-color-on-primary-container); font-weight: 600;">
                  ✅ Probetraining möglich
                </span>
              </div>
            </div>

            <!-- Training details grid with consistent styling -->
            <div class="md-map-popup-info-grid" style="display: grid; grid-template-columns: auto 1fr; gap: 0.5rem 1rem; margin-bottom: 1rem;">
              <div class="md-map-popup-info-icon" style="display: flex; align-items: center; justify-content: center; color: var(--md-sys-color-on-surface-variant); font-size: 16px;">
                📅
              </div>
              <div class="md-map-popup-info-value" style="display: flex; align-items: center;">
                <span class="md-typescale-body-medium font-medium" x-text="training.wochentag"></span>
              </div>

              <div class="md-map-popup-info-icon" style="display: flex; align-items: center; justify-content: center; color: var(--md-sys-color-on-surface-variant); font-size: 16px;">
                🕐
              </div>
              <div class="md-map-popup-info-value" style="display: flex; align-items: center;">
                <span class="md-typescale-body-medium font-medium" x-text="training.von + ' - ' + training.bis + ' Uhr'"></span>
              </div>

              <div class="md-map-popup-info-icon" style="display: flex; align-items: center; justify-content: center; color: var(--md-sys-color-on-surface-variant); font-size: 16px;">
                👥
              </div>
              <div class="md-map-popup-info-value" style="display: flex; align-items: center;">
                <span class="md-typescale-body-medium" x-text="training.altersgruppe || 'Alle Altersgruppen'"></span>
              </div>

              <div class="md-map-popup-info-icon" style="display: flex; align-items: center; justify-content: center; color: var(--md-sys-color-on-surface-variant); font-size: 16px;">
                👤
              </div>
              <div class="md-map-popup-info-value" style="display: flex; align-items: center;">
                <span class="md-typescale-body-medium" x-text="training.trainer"></span>
              </div>
            </div>

            <!-- Note with better styling -->
            <div x-show="training.anmerkung"
                 class="md-map-popup-note"
                 style="background: linear-gradient(135deg, var(--md-sys-color-primary-container) 0%, var(--md-sys-color-secondary-container) 100%); color: var(--md-sys-color-on-primary-container); padding: 0.75rem; border-radius: 8px; margin-top: 1rem; border-left: 3px solid var(--color-primary-500);">
              <p class="md-typescale-label-small font-semibold mb-1 opacity-80" style="margin: 0 0 0.25rem 0;">💡 Wichtiger Hinweis</p>
              <p class="md-typescale-body-small" style="margin: 0;" x-text="training.anmerkung"></p>
            </div>

            <!-- Action button with correct color -->
            <div x-show="training.link" class="mt-3">
              <a :href="training.link" target="_blank" rel="noopener noreferrer"
                 class="md-location-action-btn"
                 style="color: white !important;">
                <span style="color: white !important;">Jetzt anmelden</span>
                <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 5l7 7m0 0l-7 7m7-7H3"/>
                </svg>
              </a>
            </div>
          </div>
        </template>
      </div>
    </div>
  `}function ht(i,t){return`
    <div class="md-map-popup">
      <!-- Header with gradient background -->
      <div class="md-map-popup-header">
        <div class="md-map-popup-icon">🥋</div>
        <div class="md-map-popup-title">
          <h3 class="md-typescale-title-medium font-bold">${i.training}</h3>
        </div>
      </div>

      <!-- Body content -->
      <div class="md-map-popup-body">
        <!-- Info grid with icons -->
        <div class="md-map-popup-info-grid">
          <div class="md-map-popup-info-icon">📅</div>
          <div class="md-map-popup-info-value">
            <span class="md-typescale-body-medium font-medium">${i.wochentag}</span>
          </div>

          <div class="md-map-popup-info-icon">🕐</div>
          <div class="md-map-popup-info-value">
            <span class="md-typescale-body-medium font-medium">${t.formatZeitrange(i.von,i.bis)}</span>
          </div>

          <div class="md-map-popup-info-icon">📍</div>
          <div class="md-map-popup-info-value">
            <span class="md-typescale-body-medium">${i.ort}</span>
          </div>

          ${i.adresse?`
            <div class="md-map-popup-info-icon">🏠</div>
            <div class="md-map-popup-info-value">
              <span class="md-typescale-body-small">${i.adresse}</span>
            </div>
          `:""}

          <div class="md-map-popup-info-icon">👥</div>
          <div class="md-map-popup-info-value">
            <span class="md-typescale-body-medium">${t.formatAlter(i)}</span>
          </div>

          <div class="md-map-popup-info-icon">👤</div>
          <div class="md-map-popup-info-value">
            <span class="md-typescale-body-medium">${i.trainer}</span>
          </div>

          <div class="md-map-popup-info-icon">${i.probetraining==="ja"?"✅":"❌"}</div>
          <div class="md-map-popup-info-value">
            <span class="md-typescale-body-medium ${i.probetraining==="ja"?"font-semibold":""}"
                  style="color: ${i.probetraining==="ja"?"var(--color-primary-600)":"var(--md-sys-color-on-surface)"};">
              ${i.probetraining==="ja"?"Probetraining möglich":"Kein Probetraining"}
            </span>
          </div>
        </div>

        ${i.anmerkung?`
          <div class="md-map-popup-note">
            <p class="md-typescale-label-small font-semibold mb-1 opacity-80">💡 Wichtiger Hinweis</p>
            <p class="md-typescale-body-small">${i.anmerkung}</p>
          </div>
        `:""}

        ${i.distanceText?`
          <div class="md-map-popup-distance">
            <span class="md-typescale-body-medium">📏 ${i.distanceText} entfernt</span>
          </div>
        `:""}

        ${i.link?`
          <div class="md-map-popup-action">
            <a href="${i.link}" target="_blank" rel="noopener noreferrer" class="md-btn-filled no-underline" style="color: white !important;">
              <span style="color: white !important;">Jetzt anmelden</span>
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 5l7 7m0 0l-7 7m7-7H3"/>
              </svg>
            </a>
          </div>
        `:""}
      </div>
    </div>
  `}class pt{constructor(t,r,o={}){this.state=t,this.context=r,this.geolocationManager=o.geolocationManager||null}initializeMap(){if(this.context.map)return;if(!document.getElementById("map-view-container")){u("error","Map container not found");return}try{const r=this.loadMapState(),o=r?.center||g.map.defaultCenter,s=r?.zoom||g.map.defaultZoom;this.context.map=_.map("map-view-container",{center:o,zoom:s,zoomControl:!0,keyboard:!0,keyboardPanDelta:80,zoomAnimation:!0,zoomAnimationThreshold:4,fadeAnimation:!0,markerZoomAnimation:!0,inertia:!0,inertiaDeceleration:3e3,inertiaMaxSpeed:1500,scrollWheelZoom:!0,smoothWheelZoom:!0,smoothSensitivity:1}),this.context.map.on("moveend",()=>{this.saveMapState()}),this.applyLeafletRaceConditionFix(),this.addKeyboardNavigation(),this.addScreenReaderSupport(),this.createTileLayers(),this.addCustomControls(),this.addMarkersToMap(),u("info","Map initialized")}catch(r){u("error","Map initialization failed",r)}}applyLeafletRaceConditionFix(){_.Marker.prototype._animateZoom=function(t){if(!this._map)return;const r=this._map._latLngToNewLayerPoint(this._latlng,t.zoom,t.center).round();this._setPos(r)},_.Popup.prototype._animateZoom=function(t){if(!this._map)return;const r=this._map._latLngToNewLayerPoint(this._latlng,t.zoom,t.center),o=this._getAnchor();_.DomUtil.setPosition(this._container,r.add(o))},_.Tooltip&&_.Tooltip.prototype._animateZoom&&(_.Tooltip.prototype._animateZoom=function(t){if(!this._map)return;const r=this._map._latLngToNewLayerPoint(this._latlng,t.zoom,t.center),o=this._getAnchor();_.DomUtil.setPosition(this._container,r.add(o))}),u("info","Leaflet race condition fix applied (Marker, Popup, Tooltip _animateZoom overrides)")}addKeyboardNavigation(){if(!this.context.map)return;const t=this.context.map,r=t.getContainer();r.setAttribute("tabindex","0"),r.setAttribute("role","application"),r.setAttribute("aria-label","Interaktive Karte mit Trainingsstandorten. Verwenden Sie die Pfeiltasten zum Verschieben, Plus und Minus zum Zoomen, und die Tab-Taste um zwischen Markern zu navigieren."),t.on("keydown",o=>{switch(o.originalEvent.key){case"+":case"=":t.zoomIn(),o.originalEvent.preventDefault();break;case"-":case"_":t.zoomOut(),o.originalEvent.preventDefault();break;case"Home":t.setView(g.map.defaultCenter,g.map.defaultZoom,{animate:!0}),o.originalEvent.preventDefault();break;case"End":if(this.context.markers.length>0){const e=_.latLngBounds(this.context.markers.map(n=>n.getLatLng()));t.fitBounds(e,{padding:[50,50]})}o.originalEvent.preventDefault();break}}),u("debug","Keyboard navigation enabled")}addScreenReaderSupport(){if(!this.context.map)return;const t=this.context.map,r=document.createElement("div");r.setAttribute("aria-live","polite"),r.setAttribute("aria-atomic","true"),r.setAttribute("class","sr-only"),r.setAttribute("id","map-announcements"),t.getContainer().appendChild(r),this.context.ariaLiveRegion=r,t.on("zoomend",()=>{const o=t.getZoom();this.announceToScreenReader(`Zoom-Stufe ${o}`)}),t.on("layeradd",()=>{if(this.context.markers.length>0){const o=this.context.markers.length;this.announceToScreenReader(`${o} Trainingsstandorte auf der Karte angezeigt`)}}),u("debug","Screen reader support enabled")}announceToScreenReader(t){this.context.ariaLiveRegion&&(this.context.ariaLiveRegion.textContent="",setTimeout(()=>{this.context.ariaLiveRegion&&(this.context.ariaLiveRegion.textContent=t)},100))}createTileLayers(){if(!this.context.map)return;const t={maxZoom:g.map.maxZoom||19,minZoom:g.map.minZoom||10,detectRetina:!0,updateWhenIdle:!0,updateInterval:200,keepBuffer:3,bounds:[[47.9,11.3],[48.3,11.9]],errorTileUrl:"",noWrap:!1},r=_.tileLayer(g.map.tileLayerUrl,{...t,attribution:g.map.attribution,className:"md-map-tiles md-map-tiles-street"}),o=_.tileLayer("https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",{...t,attribution:"Tiles &copy; Esri &mdash; Source: Esri, i-cubed, USDA, USGS, AEX, GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EGP, and the GIS User Community",className:"md-map-tiles md-map-tiles-satellite"}),s=_.tileLayer("https://{s}.tile.opentopomap.org/{z}/{x}/{y}.png",{...t,maxZoom:17,attribution:"Map data: &copy; OpenStreetMap contributors, SRTM | Map style: &copy; OpenTopoMap (CC-BY-SA)",className:"md-map-tiles md-map-tiles-terrain"});this.context.tileLayers={street:r,satellite:o,terrain:s},r.addTo(this.context.map),this.context.tileLayer=r,Object.values(this.context.tileLayers).forEach(e=>{e.on("tileerror",n=>{u("warn","Tile loading error",{coords:n.coords})})}),u("debug","Tile layers created")}addCustomControls(){if(!this.context.map)return;if(this.context.tileLayers){const r=st({position:"topright",layers:this.context.tileLayers,defaultLayer:"street"});this.context.map.addControl(r),this.context.layerControl=r}if(g.features?.enableGeolocation){const r=ot({position:"topright",geolocationManager:this.geolocationManager});this.context.map.addControl(r),this.context.geolocationControl=r}const t=at({position:"topright",center:g.map.defaultCenter,zoom:g.map.defaultZoom});this.context.map.addControl(t),this.context.resetControl=t,u("debug","Custom controls added")}addMarkersToMap(){if(!this.context.map)return;const t=this.context.map;t.stop(),requestAnimationFrame(()=>{if(this.context.map){if(this.context.markerClusterGroup&&(this.context.markerClusterGroup.off(),t.removeLayer(this.context.markerClusterGroup),this.context.markerClusterGroup=null),this.context.markers=[],typeof _.markerClusterGroup!="function"){u("error","Leaflet.markercluster not available - check imports in main.js"),this.addMarkersWithoutClustering();return}this.addMarkersWithClustering()}})}addMarkersWithClustering(){if(!this.context.map)return;const t=this.context.map;this.context.markerClusterGroup&&(this.context.markerClusterGroup.off(),t.removeLayer(this.context.markerClusterGroup),this.context.markerClusterGroup=null),this.context.markers=[];const r=lt(),o=ct(),s=_.markerClusterGroup({chunkedLoading:!0,chunkInterval:200,chunkDelay:50,removeOutsideVisibleBounds:!1,maxClusterRadius:r,spiderfyOnMaxZoom:!0,showCoverageOnHover:!1,zoomToBoundsOnClick:!0,disableClusteringAtZoom:18,animateAddingMarkers:!1,spiderfyDistanceMultiplier:o,animate:!0,singleMarkerMode:!1,iconCreateFunction:l=>{const c=l.getChildCount();let d=50,h=16,p="md-map-cluster-small";return c>=100?(d=70,h=22,p="md-map-cluster-xlarge"):c>=50?(d=65,h=20,p="md-map-cluster-large"):c>=10&&(d=55,h=18,p="md-map-cluster-medium"),_.divIcon({html:`<div class="md-map-cluster ${p}">
                   <span class="md-map-cluster-count" style="font-size: ${h}px">${c}</span>
                 </div>`,className:"md-map-cluster-wrapper",iconSize:_.point(d,d)})}}),e=[],n=[];ut(this.context.filteredTrainings).forEach((l,c)=>{const[d,h]=c.split(",").map(Number),p=l.length,f=l[0].ort,m=this.createLocationIcon(p,l),y=_.marker([d,h],{icon:m,title:p>1?`${f} (${p} Trainings)`:`${l[0].training} - ${f}`,alt:`Standort: ${f}`,riseOnHover:!0});y.locationTrainings=l,y.trainingId=l[0].id;const M=p>1?dt(l):this.createMapPopup(l[0]);y.bindPopup(M,{maxWidth:p>1?450:400,className:"md-map-popup-container",autoPan:!1,autoClose:!0,autoPanPadding:[50,50]}),y.on("click",v=>{this.centerOnMarker(v.latlng,p>1)}),e.push(y),n.push([d,h])}),s.addLayers(e),this.context.markers=e,t.addLayer(s),this.context.markerClusterGroup=s,n.length>0&&!this.context.userHasInteractedWithMap&&t.fitBounds(n,{padding:[50,50]}),t.once("movestart",()=>{this.context.userHasInteractedWithMap=!0}),u("info",`Added ${e.length} markers to map with clustering`)}addMarkersWithoutClustering(){if(!this.context.map)return;const t=this.context.map,r=[];this.context.filteredTrainings.forEach(o=>{if(!o.lat||!o.lng)return;const s=_.marker([o.lat,o.lng],{title:`${o.training} - ${o.ort}`,alt:`Standort: ${o.ort}`,riseOnHover:!0});s.bindPopup(this.createMapPopup(o),{maxWidth:400,className:"md-map-popup-container",autoPan:!1,autoClose:!0}),s.addTo(t),this.context.markers.push(s),r.push([o.lat,o.lng])}),r.length>0&&!this.context.userHasInteractedWithMap&&t.fitBounds(r,{padding:[50,50]}),t.once("movestart",()=>{this.context.userHasInteractedWithMap=!0}),u("info",`Added ${this.context.markers.length} markers without clustering`)}zoomToFavorites(){if(!this.context.map){u("warn","Map not initialized - cannot zoom to favorites");return}const t=this.context.allTrainings.filter(s=>this.context.favorites.includes(s.id)&&s.lat&&s.lng);if(t.length===0){u("info","No favorites with coordinates found"),this.announceToScreenReader("Keine Favoriten mit Standorten gefunden"),this.context.map.setView(g.map.defaultCenter,g.map.defaultZoom,{animate:!0,duration:1});return}const r=t.map(s=>[s.lat,s.lng]);this.context.map.fitBounds(r,{padding:[80,80],maxZoom:15,animate:!0,duration:1.2}),this.context.userHasInteractedWithMap=!0;const o=t.length;this.announceToScreenReader(`Karte zeigt ${o} Favoriten-Standort${o>1?"e":""}`),u("info",`Zoomed to ${o} favorite locations`)}zoomToTraining(t){const r=this.context.allTrainings.find(o=>o.id===t);if(!r||!r.lat||!r.lng){u("warn",`Training ${t} not found or has no coordinates`);return}this.context.$store.ui.activeView!=="map"&&(this.context.$store.ui.activeView="map"),this.context.$nextTick(()=>{this.context.map||this.initializeMap(),this.context.$nextTick(()=>{const o=this.context.map;if(!o)return;const s=this.context.markers.find(e=>e.trainingId===t);if(s){const e=o.getZoom(),n=17,a=Math.abs(n-e),l=Math.min(1.5,.5+a*.1);o.flyTo([r.lat,r.lng],n,{duration:l,easeLinearity:.2,animate:!0}),this._addZoomHighlight([r.lat,r.lng]),setTimeout(()=>{s.openPopup(),this.announceToScreenReader(`Zu ${r.training} in ${r.ort} gezoomt`)},l*1e3+100),u("info",`Zoomed to training ${t} at ${r.ort}`)}else o.flyTo([r.lat,r.lng],17,{duration:1,easeLinearity:.2,animate:!0}),u("warn",`Marker for training ${t} not found, centered on coordinates`);this.context.userHasInteractedWithMap=!0})})}createLocationIcon(t,r=[]){const s=r[0]?.training?.toLowerCase()||"fam",e={parkour:"#0d47a1",trampolin:"#194d1b",tricking:"#4a148c",movement:"#8d2600",fam:"#880e4f"};let n=e.fam;for(const[d,h]of Object.entries(e))if(s.includes(d)){n=h;break}const a=t>1?Math.min(50,35+t*2):40,l=Math.min(18,12+t*.5),c=t>1;return _.divIcon({html:`
        <div class="md-location-marker">
          <div class="md-location-pin">
            <svg width="36" height="48" viewBox="0 0 36 48" fill="none" xmlns="http://www.w3.org/2000/svg">
              <!-- Pin shadow -->
              <ellipse cx="18" cy="46" rx="8" ry="2" fill="rgba(0,0,0,0.2)"/>
              <!-- Pin body with training type color -->
              <path d="M18 0C8.059 0 0 8.059 0 18c0 13.5 18 30 18 30s18-16.5 18-30c0-9.941-8.059-18-18-18z"
                    fill="${n}"/>
              <!-- Pin center circle -->
              <circle cx="18" cy="18" r="10" fill="white"/>
              <!-- Training type initial/icon -->
              <text x="18" y="22" text-anchor="middle" font-size="12" font-weight="bold" fill="${n}">
                ${s.charAt(0).toUpperCase()}
              </text>
            </svg>
          </div>
          ${c?`<div class="md-location-badge" style="font-size: ${l}px; background-color: ${n};">${t}</div>`:""}
        </div>
      `,className:"md-location-marker-wrapper",iconSize:[a,a+12],iconAnchor:[a/2,a+12],popupAnchor:[0,-(a+12)]})}centerOnMarker(t,r=!1){if(!this.context.map)return;const o=this.context.map,s=o.getSize().y,n=o.getSize().x/2,a=s*.7,l=o.latLngToContainerPoint(t),c=l.x-n,d=l.y-a;o.panBy([c,d],{animate:!0,duration:.5,easeLinearity:.25}),u("debug",`Centered on marker at ${t.lat}, ${t.lng}`)}createMapPopup(t){return ht(t,C)}_addZoomHighlight(t){if(!this.context.map)return;const r=_.circleMarker(t,{radius:50,fillColor:"var(--color-primary-500)",color:"var(--color-primary-600)",weight:2,opacity:.6,fillOpacity:.2,className:"zoom-highlight"}).addTo(this.context.map);let o=50,s=.6;const e=setInterval(()=>{o+=5,s-=.05,s<=0?(clearInterval(e),this.context.map&&this.context.map.removeLayer(r)):(r.setRadius(o),r.setStyle({opacity:s,fillOpacity:s*.3}))},50)}addUserLocationMarker(t){this.context.map&&(this.context.userLocationMarker&&(this.context.map.removeLayer(this.context.userLocationMarker),this.context.userLocationMarker=null),this.context.geolocationControl&&this.context.geolocationControl._userMarker&&(this.context.map.removeLayer(this.context.geolocationControl._userMarker),this.context.geolocationControl._userMarker=null),this.context.userLocationMarker=_.marker(t,{icon:_.divIcon({className:"md-user-location-marker",html:'<div class="pulse"></div>',iconSize:[24,24],iconAnchor:[12,12]}),title:"Mein Standort",zIndexOffset:1e3}),this.context.userLocationMarker.addTo(this.context.map),u("info","User location marker added to map",t))}cleanupMap(){if(!this.context.map)return;const t=this.context.map;try{t.stop(),t.off(),this.context.tileLayer&&(this.context.tileLayer.off(),t.removeLayer(this.context.tileLayer),this.context.tileLayer=null),this.context.markerClusterGroup&&(this.context.markerClusterGroup.off(),t.removeLayer(this.context.markerClusterGroup),this.context.markerClusterGroup.clearLayers(),this.context.markerClusterGroup=null),this.context.markers.forEach(r=>{r.off(),r.unbindPopup(),t.removeLayer(r),r.trainingId=null}),this.context.markers=[],this.context.ariaLiveRegion&&(this.context.ariaLiveRegion.remove(),this.context.ariaLiveRegion=null),this.context.layerControl&&(t.removeControl(this.context.layerControl),this.context.layerControl=null),this.context.geolocationControl&&(t.removeControl(this.context.geolocationControl),this.context.geolocationControl=null),this.context.resetControl&&(t.removeControl(this.context.resetControl),this.context.resetControl=null),this.context.tileLayers&&(Object.values(this.context.tileLayers).forEach(r=>{r.off(),t.hasLayer(r)&&t.removeLayer(r)}),this.context.tileLayers=null),t.eachLayer(r=>{r.off(),t.removeLayer(r)}),t.remove(),this.context.map=null,this.context.userHasInteractedWithMap=!1,u("info","Map cleaned up successfully")}catch(r){u("error","Map cleanup error",r)}}saveMapState(){if(this.context.map)try{const t=this.context.map.getCenter(),r=this.context.map.getZoom(),o={center:[t.lat,t.lng],zoom:r,timestamp:Date.now()};localStorage.setItem("fam_map_state",JSON.stringify(o)),u("debug","Map state saved",o)}catch(t){u("warn","Failed to save map state",t)}}loadMapState(){try{const t=localStorage.getItem("fam_map_state");if(!t)return null;const r=JSON.parse(t),o=10080*60*1e3;if(Date.now()-r.timestamp>o)return localStorage.removeItem("fam_map_state"),null;const[s,e]=r.center;return s<-90||s>90||e<-180||e>180?null:(u("debug","Map state loaded",r),{center:r.center,zoom:r.zoom})}catch(t){return u("warn","Failed to load map state",t),null}}}class ft{constructor(t,r,o){this.state=t,this.context=r,this.addDistanceToTrainings=o.addDistanceToTrainings,this.applyFilters=o.applyFilters,this.startUpdateCheck=o.startUpdateCheck}async init(){this.context.loading=!0,this.context.error=null;try{const t=this.getCachedData();t&&(this.loadData(t),this.context.fromCache=!0);const r=await fetch(g.jsonUrl+"?_="+Date.now());if(!r.ok){if(t){u("warn","Network error, using cache");return}throw new Error(`HTTP ${r.status}: File not found`)}const o=await r.json();if(!o.version||!o.trainings||!Array.isArray(o.trainings))throw new Error("Invalid data format");const s=C.generateHash(JSON.stringify(o.trainings)),e=t?C.generateHash(JSON.stringify(t.trainings)):null;s!==e&&(u("info","New data available, updating..."),this.loadData(o),this.setCachedData(o),this.context.fromCache=!1),g.features.enableUpdateCheck&&this.startUpdateCheck()}catch(t){u("error","Failed to load trainings",t),this.context.error=t instanceof Error?t.message:String(t)}finally{this.context.loading=!1}}loadData(t){this.context.allTrainings=t.trainings||[],this.context.metadata=t.metadata||null,this.context.fuse=new ve(this.context.allTrainings,g.search.fuseOptions),this.state.userPosition&&this.addDistanceToTrainings(),this.applyFilters(),u("info","Data loaded",{trainings:this.context.allTrainings.length,fromCache:this.context.fromCache})}getCachedData(){if(!g.cacheEnabled)return null;try{const t=localStorage.getItem(g.cacheKey);if(!t)return null;const r=JSON.parse(t);return Date.now()-r.timestamp>g.cacheDuration?(localStorage.removeItem(g.cacheKey),null):r.data}catch(t){return u("error","Cache read failed",t),null}}setCachedData(t){if(g.cacheEnabled)try{const r={timestamp:Date.now(),data:t};localStorage.setItem(g.cacheKey,JSON.stringify(r))}catch(r){u("error","Cache write failed",r)}}startUpdateCheckInternal(){this.state.updateCheckInterval||(this.state.updateCheckInterval=setInterval(()=>{this.checkForUpdates()},g.pwa.updateCheckInterval))}async checkForUpdates(){try{const r=await(await fetch(g.versionUrl+"?_="+Date.now())).json();r.version&&r.version!==g.pwa.version&&(this.context.updateAvailable=!0,this.context.latestVersion=r.version,u("info","Update available",{version:r.version}))}catch(t){u("error","Update check failed",t)}}}const k=Object.freeze({GOOGLE:"google",OUTLOOK:"outlook",OFFICE365:"office365",YAHOO:"yahoo",APPLE:"apple",ICAL:"ical"}),mt="https://calendar.google.com/calendar/render",gt="https://outlook.live.com/calendar/0/deeplink/compose",_t="https://outlook.office.com/calendar/0/deeplink/compose",yt="https://calendar.yahoo.com/";function Y(i){try{const{start:t,end:r}=N(i),o=new URLSearchParams({action:"TEMPLATE",text:U(i),dates:vt(t,r),details:G(i),location:R(i),trp:"true"}),s=`${mt}?${o.toString()}`;return u("debug","[calendar] Google Calendar URL created",{training:i.id}),s}catch(t){throw u("error","[calendar] Failed to create Google Calendar URL",t),t}}function vt(i,t){const r=o=>o.toISOString().replace(/[-:]/g,"").replace(/\.\d{3}/,"");return`${r(i)}/${r(t)}`}function ne(i){try{const{start:t,end:r}=N(i),o=new URLSearchParams({path:"/calendar/action/compose",rru:"addevent",subject:U(i),startdt:t.toISOString(),enddt:r.toISOString(),body:G(i),location:R(i)}),s=`${gt}?${o.toString()}`;return u("debug","[calendar] Outlook Calendar URL created",{training:i.id}),s}catch(t){throw u("error","[calendar] Failed to create Outlook Calendar URL",t),t}}function oe(i){try{const{start:t,end:r}=N(i),o=new URLSearchParams({path:"/calendar/action/compose",rru:"addevent",subject:U(i),startdt:t.toISOString(),enddt:r.toISOString(),body:G(i),location:R(i)}),s=`${_t}?${o.toString()}`;return u("debug","[calendar] Office 365 Calendar URL created",{training:i.id}),s}catch(t){throw u("error","[calendar] Failed to create Office 365 Calendar URL",t),t}}function ae(i){try{const{start:t,end:r}=N(i),o=new URLSearchParams({v:"60",title:U(i),st:ee(t),et:ee(r),desc:G(i),in_loc:R(i)}),s=`${yt}?${o.toString()}`;return u("debug","[calendar] Yahoo Calendar URL created",{training:i.id}),s}catch(t){throw u("error","[calendar] Failed to create Yahoo Calendar URL",t),t}}function ee(i){return i.toISOString().replace(/[-:]/g,"").replace(/\.\d{3}/,"")}async function se(i,t={}){const{maxBulk:r=10,delay:o=600,onProgress:s=null}=t;if(!Array.isArray(i)||i.length===0)return{success:!1,message:"Keine Trainings zum Exportieren",exported:0,total:0,errors:null};const e=i.slice(0,r);let n=0;const a=[];try{for(let c=0;c<e.length;c++)try{const d=Y(e[c]);if(!window.open(d,"_blank"))throw new Error("Popup blocked");n++,s&&s({current:c+1,total:e.length,training:e[c]}),c<e.length-1&&await new Promise(p=>setTimeout(p,o))}catch(d){const h=d instanceof Error?d.message:String(d);a.push({training:e[c],error:h}),u("error","[calendar] Bulk export error for training",{training:e[c].id,error:d})}const l={success:n>0,message:`${n} von ${e.length} Trainings exportiert`,exported:n,total:e.length,errors:a.length>0?a:null};return u("info","[calendar] Bulk export completed",l),l}catch(l){return u("error","[calendar] Bulk export failed",l),{success:!1,message:"Export fehlgeschlagen",exported:n,total:e.length,errors:a.length>0?a:null}}}async function wt(i,t=k.GOOGLE,r={}){if(!{[k.GOOGLE]:Y,[k.OUTLOOK]:ne,[k.OFFICE365]:oe,[k.YAHOO]:ae}[t])throw new Error(`Unsupported calendar provider: ${t}`);return se(i,r)}function N(i){const t=z(i.wochentag);if(!t)throw new Error("Invalid weekday");const[r,o]=i.von.split(":").map(Number),[s,e]=i.bis.split(":").map(Number),n=new Date(t);n.setHours(r,o,0,0);const a=new Date(t);return a.setHours(s,e,0,0),{start:n,end:a}}function U(i){return`${i.training} - ${i.ort}`}function G(i){const t=[];return t.push(`🏃 ${i.training} Training`),t.push(""),i.altersgruppe&&t.push(`👥 Altersgruppe: ${i.altersgruppe}`),i.trainer&&t.push(`👤 Trainer: ${i.trainer}`),i.anmerkung&&(t.push(""),t.push(`ℹ️ ${i.anmerkung}`)),i.link&&(t.push(""),t.push(`📝 Anmeldung: ${i.link}`)),t.push(""),t.push("---"),t.push("🗓️ Erstellt mit FAM Trainingsplan"),t.push("🔗 https://trainingsplan.freeartsofmovement.com"),t.join(`
`)}function R(i){return i.adresse?`${i.ort}, ${i.adresse}`:i.ort||""}function Lt(i,t=null){try{const r=Q(i);if(!r)throw new Error("Failed to create iCal event");const o=new Blob([r],{type:"text/calendar;charset=utf-8"}),s=window.URL.createObjectURL(o),e=document.createElement("a");return e.href=s,e.download=t||`training-${i.id}.ics`,document.body.appendChild(e),e.click(),document.body.removeChild(e),window.URL.revokeObjectURL(s),u("debug","[calendar] iCal file downloaded",{training:i.id}),{success:!0,message:"Kalenderdatei heruntergeladen"}}catch(r){return u("error","[calendar] Failed to download iCal file",r),{success:!1,message:"Download fehlgeschlagen",error:r}}}function bt(i,t="trainings.ics"){try{if(!Array.isArray(i)||i.length===0)throw new Error("No trainings provided");const r=i.map(a=>Q(a)).filter(Boolean);if(r.length===0)throw new Error("No valid events created");const o=["BEGIN:VCALENDAR","VERSION:2.0","PRODID:-//FAM Trainingsplan//NONSGML v1.0//EN","CALSCALE:GREGORIAN","METHOD:PUBLISH","X-WR-CALNAME:FAM Trainingsplan","X-WR-TIMEZONE:Europe/Berlin",...r.map(a=>(a||"").split(`
`).slice(2,-2).join(`
`)),"END:VCALENDAR"].join(`
`),s=new Blob([o],{type:"text/calendar;charset=utf-8"}),e=window.URL.createObjectURL(s),n=document.createElement("a");return n.href=e,n.download=t,document.body.appendChild(n),n.click(),document.body.removeChild(n),window.URL.revokeObjectURL(e),u("info","[calendar] iCal bundle downloaded",{count:i.length}),{success:!0,message:`${i.length} Trainings heruntergeladen`,count:i.length}}catch(r){return u("error","[calendar] Failed to download iCal bundle",r),{success:!1,message:"Download fehlgeschlagen",error:r}}}function Ct(){const i=navigator.userAgent.toLowerCase(),t=navigator.platform.toLowerCase();return/iphone|ipad|ipod|mac/.test(i)||/mac/.test(t)?k.APPLE:/windows/.test(i)||/win/.test(t)?k.OUTLOOK:(/android/.test(i),k.GOOGLE)}function xt(i){return{[k.GOOGLE]:"Google Calendar",[k.OUTLOOK]:"Outlook Calendar",[k.OFFICE365]:"Office 365 Calendar",[k.YAHOO]:"Yahoo Calendar",[k.APPLE]:"Apple Calendar",[k.ICAL]:"iCal"}[i]||i}const O={createGoogleCalendarUrl:Y,createOutlookCalendarUrl:ne,createOffice365CalendarUrl:oe,createYahooCalendarUrl:ae,bulkAddToGoogleCalendar:se,bulkAddToCalendar:wt,downloadICalFile:Lt,downloadICalBundle:bt,detectCalendarProvider:Ct,getCalendarProviderName:xt,providers:k};class Mt{constructor(t,r,o){this.state=t,this.context=r,this.dependencies=o}get hasActiveFilters(){return this.dependencies.hasActiveFilters}get filteredTrainingsCount(){return this.dependencies.filteredTrainingsCount}addToGoogleCalendar(t){try{const r=O.createGoogleCalendarUrl(t);window.open(r,"_blank"),this.context.$store.ui.showNotification(`${t.training} zu Google Calendar hinzugef�gt`,"success",3e3),u("info","[trainingsplaner] Added to Google Calendar",{training:t.id})}catch(r){u("error","[trainingsplaner] Failed to add to Google Calendar",r),this.context.$store.ui.showNotification("Fehler beim �ffnen von Google Calendar","error",3e3)}}addToCalendar(t,r=null){const o=r||O.detectCalendarProvider();try{let s;switch(o){case"google":s=O.createGoogleCalendarUrl(t);break;case"outlook":s=O.createOutlookCalendarUrl(t);break;case"office365":s=O.createOffice365CalendarUrl(t);break;case"yahoo":s=O.createYahooCalendarUrl(t);break;case"apple":case"ical":O.downloadICalFile(t),this.context.$store.ui.showNotification("Kalenderdatei heruntergeladen","success",3e3);return;default:throw new Error(`Unknown provider: ${o}`)}s&&(window.open(s,"_blank"),this.context.$store.ui.showNotification(`Zu ${O.getCalendarProviderName(o)} hinzugef�gt`,"success",3e3)),u("info","[trainingsplaner] Added to calendar",{training:t.id,provider:o})}catch(s){u("error","[trainingsplaner] Failed to add to calendar",s),this.context.$store.ui.showNotification("Fehler beim �ffnen des Kalenders","error",3e3)}}async bulkAddToGoogleCalendar(){if(this.context.filteredTrainings.length===0){this.context.$store.ui.showNotification("Keine Trainings zum Exportieren","warning",3e3);return}try{this.context.$store.ui.showNotification(`Exportiere ${this.context.filteredTrainings.length} Trainings...`,"info",2e3);const t=await O.bulkAddToGoogleCalendar(this.context.filteredTrainings,{maxBulk:10,delay:600,onProgress:({current:r,total:o})=>{u("debug","[trainingsplaner] Bulk export progress",{current:r,total:o})}});t.success?this.context.$store.ui.showNotification(` ${t.exported} von ${t.total} Trainings zu Google Calendar hinzugef�gt`,"success",5e3):this.context.$store.ui.showNotification(t.message,"error",5e3),u("info","[trainingsplaner] Bulk Google Calendar export",t)}catch(t){u("error","[trainingsplaner] Bulk Google Calendar export failed",t),this.context.$store.ui.showNotification("Fehler beim Bulk-Export. Bitte versuche den .ics Export.","error",5e3)}}async exportAllToCalendar(){if(this.context.filteredTrainings.length===0){this.context.$store.ui.showNotification("Keine Trainings zum Exportieren","warning",3e3);return}try{const t=C.createICalBundle(this.context.filteredTrainings),r=`fam-trainings-${Date.now()}.ics`;C.downloadICalFile(t,r),this.context.$store.ui.showNotification(`${this.context.filteredTrainings.length} Trainings exportiert! <�`,"success",3e3),u("info","Bulk calendar export",{count:this.context.filteredTrainings.length})}catch(t){u("error","Bulk export failed",t),this.context.$store.ui.showNotification("Export fehlgeschlagen. Bitte versuchen Sie es erneut.","error",5e3)}}async exportFavoritesToCalendar(){const t=this.context.allTrainings.filter(r=>this.context.favorites.includes(r.id));if(t.length===0){this.context.$store.ui.showNotification("Keine Favoriten zum Exportieren","warning",3e3);return}try{const r=C.createICalBundle(t),o=`fam-favoriten-${Date.now()}.ics`;C.downloadICalFile(r,o),this.context.$store.ui.showNotification(`${t.length} Favoriten exportiert! P`,"success",3e3)}catch(r){u("error","Favorites export failed",r),this.context.$store.ui.showNotification("Export fehlgeschlagen.","error",5e3)}}async shareCurrentView(){const t=this.context.$store.ui.filters,r=C.createShareLink(t),o=this.hasActiveFilters,s=this.filteredTrainingsCount,e={title:"FAM Trainingsplan",text:o?`${s} Trainings gefunden - Schau dir diese an!`:"Entdecke alle FAM Trainings in M�nchen!",url:r};try{if(navigator.share&&navigator.canShare&&navigator.canShare(e))await navigator.share(e),u("info","View shared via native API");else if(await C.copyToClipboard(r))this.context.$store.ui.showNotification("Link in Zwischenablage kopiert! =�","success",3e3);else throw new Error("Clipboard write failed")}catch(n){n instanceof Error&&n.name!=="AbortError"&&(u("error","Share failed",n),this.context.$store.ui.showNotification("Teilen fehlgeschlagen.","error",3e3))}}async shareFavorites(){if(this.context.favorites.length===0){this.context.$store.ui.showNotification("Keine Favoriten zum Teilen","warning",3e3);return}const r=`${window.location.origin+window.location.pathname}?favorites=true`,s={title:"FAM Trainingsplan - Meine Favoriten",text:`Schau dir meine ${this.context.favorites.length} Lieblings-Trainings an!`,url:r};try{if(navigator.share&&navigator.canShare&&navigator.canShare(s))await navigator.share(s),u("info","Favorites shared via native API");else if(await C.copyToClipboard(r))this.context.$store.ui.showNotification("Favoriten-Link in Zwischenablage kopiert!","success",3e3);else throw new Error("Clipboard write failed")}catch(e){e instanceof Error&&e.name!=="AbortError"&&(u("error","Share favorites failed",e),this.context.$store.ui.showNotification("Teilen fehlgeschlagen.","error",3e3))}}}const kt={heute:{label:"Heute",category:"zeit",color:"primary",apply:(i,t)=>{const o=["Sonntag","Montag","Dienstag","Mittwoch","Donnerstag","Freitag","Samstag"][new Date().getDay()];i._customTimeFilter="",i.wochentag=o,i.activeQuickFilter="heute"}},morgen:{label:"Morgen",category:"zeit",color:"primary",apply:(i,t)=>{const o=["Sonntag","Montag","Dienstag","Mittwoch","Donnerstag","Freitag","Samstag"][(new Date().getDay()+1)%7];i._customTimeFilter="",i.wochentag=o,i.activeQuickFilter="morgen"}},wochenende:{label:"Wochenende",category:"zeit",color:"primary",customFilter:!0,apply:(i,t)=>{i.wochentag="",i.activeQuickFilter="wochenende",i._customTimeFilter="wochenende"}},wochentags:{label:"Wochentags",category:"zeit",color:"primary",customFilter:!0,apply:(i,t)=>{i.wochentag="",i.activeQuickFilter="wochentags",i._customTimeFilter="wochentags"}},probetraining:{label:"Probetraining",category:"feature",color:"green",customFilter:!0,apply:(i,t)=>{i.activeQuickFilter="probetraining",i._customFeatureFilter="probetraining"}},inMeinerNaehe:{label:"In meiner Nähe",category:"ort",color:"blue",requiresGeolocation:!0,customFilter:!0,apply:(i,t)=>{t.userPosition&&(i.ort="",i.activeQuickFilter="inMeinerNaehe",i._customLocationFilter="inMeinerNaehe")}},favoriten:{label:"Favoriten",category:"persoenlich",color:"yellow",customFilter:!0,apply:(i,t)=>{i.wochentag="",i.ort="",i.training="",i.altersgruppe="",i.searchTerm="",i._customTimeFilter="",i._customFeatureFilter="",i._customLocationFilter="",i.activeQuickFilter="favoriten",i._customPersonalFilter="favoriten"}}};function Tt(){const i=Ye(),t={allTrainings:i.allTrainings,filteredTrainings:i.filteredTrainings,favorites:i.favorites,metadata:i.metadata,fuse:i.fuse,loading:i.loading,error:i.error,fromCache:i.fromCache,userPosition:i.userPosition,geolocationError:i.geolocationError,map:i.map,markers:i.markers,markerClusterGroup:i.markerClusterGroup,userHasInteractedWithMap:i.userHasInteractedWithMap,updateCheckInterval:i.updateCheckInterval,updateAvailable:i.updateAvailable,latestVersion:i.latestVersion,searchTimeout:i.searchTimeout,wochentagOrder:i.wochentagOrder};return Object.defineProperties(t,{wochentage:{get(){const r=["Montag","Dienstag","Mittwoch","Donnerstag","Freitag","Samstag","Sonntag"];return[...this.metadata?.wochentage||r].sort((s,e)=>{const n=r.indexOf(s),a=r.indexOf(e);return n===-1&&a===-1?s.localeCompare(e):n===-1?1:a===-1?-1:n-a})},enumerable:!0},orte:{get(){return this.metadata?.orte||C.extractUnique(this.allTrainings,"ort")},enumerable:!0},trainingsarten:{get(){return this.metadata?.trainingsarten||C.extractUnique(this.allTrainings,"training")},enumerable:!0},altersgruppen:{get(){const r=["Minis","Kids","Teens","Adults"];if(this.metadata?.altersgruppen)return[...this.metadata.altersgruppen].sort((e,n)=>{const a=r.indexOf(e),l=r.indexOf(n);return a===-1&&l===-1?e.localeCompare(n):a===-1?1:l===-1?-1:a-l});const o=this.allTrainings.map(e=>e.altersgruppe).filter(e=>e&&String(e).trim()!==""),s=[];return o.forEach(e=>{String(e).split(",").forEach(n=>{const a=n.trim();a&&!s.includes(a)&&s.push(a)})}),s.sort((e,n)=>{const a=r.indexOf(e),l=r.indexOf(n);return a===-1&&l===-1?e.localeCompare(n):a===-1?1:l===-1?-1:a-l})},enumerable:!0},groupedTrainings:{get(){const o=this.$store?.ui?.groupingMode||"wochentag",s={};this.filteredTrainings.forEach(n=>{let a;o==="ort"?a=n.ort||"Ohne Ort":a=n.wochentag||"Ohne Tag",s[a]||(s[a]=[]),s[a].push(n)});let e;return o==="ort"?e=Object.keys(s).sort((n,a)=>n.localeCompare(a)):e=Object.keys(s).sort((n,a)=>(this.wochentagOrder[n]||999)-(this.wochentagOrder[a]||999)),e.map(n=>({key:n,items:this.sortTrainings(s[n])}))},enumerable:!0},favoriteTrainings:{get(){return this.allTrainings.filter(r=>this.favorites.includes(r.id))},enumerable:!0},hasActiveFilters:{get(){const r=this.$store?.ui?.filters;return r?["wochentag","ort","training","altersgruppe","searchTerm"].reduce((o,s)=>{const e=r[s];return Array.isArray(e)?e.length>0?o+1:o:typeof e=="string"&&e.trim()!==""?o+1:o},0)>0:!1},enumerable:!0},filteredTrainingsCount:{get(){return this.filteredTrainings.length},enumerable:!0}}),t.init=async function(){const r=this;this.urlFiltersManager=new Xe(r),this.filterEngine=new Je(i,r,{isFavorite:o=>this.favoritesManager.isFavorite(o),updateUrl:()=>this.urlFiltersManager.updateUrlWithFilters()}),this.favoritesManager=new et(i,r,{applyFilters:()=>this.filterEngine.applyFilters()}),this.mapManager=new pt(i,r),this.geolocationManager=new tt(i,r,{applyFilters:()=>this.filterEngine.applyFilters(),mapManager:this.mapManager}),this.mapManager.geolocationManager=this.geolocationManager,this.dataLoader=new ft(i,r,{addDistanceToTrainings:()=>this.geolocationManager.addDistanceToTrainings(),applyFilters:()=>this.filterEngine.applyFilters(),startUpdateCheck:()=>this.dataLoader.startUpdateCheckInternal()}),this.actionsManager=new Mt(i,r,{get hasActiveFilters(){return r.hasActiveFilters},get filteredTrainingsCount(){return r.filteredTrainingsCount}}),g.features.enableFavorites&&this.favoritesManager.loadFavorites(),g.filters.persistInUrl&&this.urlFiltersManager.loadFiltersFromUrl(),this.watchFilters(),window.addEventListener("keydown",o=>this.handleKeyboardShortcuts(o)),window.addEventListener("scroll",()=>{r.$store?.ui&&(r.$store.ui.showScrollTop=window.scrollY>500)},{passive:!0}),await this.dataLoader.init(),r.$store?.filterOptions&&(r.$store.filterOptions.wochentage=r.wochentage,r.$store.filterOptions.orte=r.orte,r.$store.filterOptions.trainingsarten=r.trainingsarten,r.$store.filterOptions.altersgruppen=r.altersgruppen)},t.watchFilters=function(){const r=this;let o=null;r.$watch("$store.ui.filters",()=>{o!==null&&clearTimeout(o),o=setTimeout(()=>{r.filterEngine.applyFilters(),(r.$store?.ui?.activeView==="map"||r.$store?.ui?.activeView==="split")&&r.map&&r.$nextTick(()=>{r.mapManager.addMarkersToMap()})},250)},{deep:!0}),r.$watch("$store.ui.activeView",s=>{(s==="map"||s==="split")&&r.$nextTick(()=>{r.map?(r.map.stop(),setTimeout(()=>{r.map&&r.map.invalidateSize()},100)):r.mapManager.initializeMap()})}),(r.$store?.ui?.activeView==="map"||r.$store?.ui?.activeView==="split")&&r.$nextTick(()=>{r.map||r.mapManager.initializeMap()})},t.applyFilters=function(){return this.filterEngine.applyFilters()},t.matchesAltersgruppe=function(r,o){return this.filterEngine.matchesAltersgruppe(r,o)},t.loadFavorites=function(){return this.favoritesManager.loadFavorites()},t.isFavorite=function(r){return this.favoritesManager.isFavorite(r)},t.toggleFavorite=function(r){return this.favoritesManager.toggleFavorite(r)},t.quickFilterFavorites=function(){return this.favoritesManager.quickFilterFavorites()},t.quickFilterHeute=function(){const r=this;if(!r.$store?.ui?.filters)return;if(r.$store.ui.filters.activeQuickFilter==="heute")r.$store.ui.filters={wochentag:"",ort:"",training:"",altersgruppe:"",searchTerm:"",activeQuickFilter:null};else{const e=["Sonntag","Montag","Dienstag","Mittwoch","Donnerstag","Freitag","Samstag"][new Date().getDay()];r.$store.ui.filters.wochentag=e,r.$store.ui.filters.activeQuickFilter="heute"}this.applyFilters()},t.applyQuickFilter=async function(r){const o=this;if(!o.$store?.ui?.filters)return;const s=o.$store.ui.filters.activeQuickFilter,e=kt[r];if(!e){console.warn(`Unknown quick filter: ${r}`);return}if(s===r){if(e.category==="zeit")o.$store.ui.filters.wochentag="",o.$store.ui.filters._customTimeFilter="";else if(e.category==="feature")o.$store.ui.filters._customFeatureFilter="";else if(e.category==="ort")o.$store.ui.filters._customLocationFilter="";else if(e.category==="persoenlich"){o.clearAllFilters();return}o.$store.ui.filters.activeQuickFilter=null,o.applyFilters();return}if(e.requiresGeolocation&&!o.userPosition){if(!await o.requestUserLocation()){o.$store.ui.showNotification('Standort-Zugriff benötigt für "In meiner Nähe" Filter',"warning",3e3);return}o.addDistanceToTrainings()}const n={allTrainings:o.allTrainings,favorites:o.favorites,userPosition:o.userPosition,applyFilters:()=>o.applyFilters()},a=e.apply(o.$store.ui.filters,n);Array.isArray(a)?o.filteredTrainings=a:o.applyFilters(),!window.matchMedia("(min-width: 1024px)").matches&&o.$store?.ui&&setTimeout(()=>{o.$store.ui.mobileFilterOpen=!1,setTimeout(()=>{const c=document.getElementById("main-content");c&&c.scrollIntoView({behavior:"smooth",block:"start"})},200)},150)},t.requestUserLocation=function(){return this.geolocationManager.requestUserLocation()},t.addDistanceToTrainings=function(){return this.geolocationManager.addDistanceToTrainings()},t.setManualLocation=function(r,o,s=""){return this.geolocationManager.setManualLocation(r,o,s)},t.resetLocation=function(){return this.geolocationManager.resetLocation()},t.initializeMap=function(){return this.mapManager.initializeMap()},t.addMarkersToMap=function(){return this.mapManager.addMarkersToMap()},t.createMapPopup=function(r){return this.mapManager.createMapPopup(r)},t.cleanupMap=function(){return this.mapManager.cleanupMap()},t.zoomToFavorites=function(){return this.mapManager.zoomToFavorites()},t.zoomToTraining=function(r){return this.mapManager.zoomToTraining(r)},t.loadFiltersFromUrl=function(){return this.urlFiltersManager.loadFiltersFromUrl()},t.updateUrlWithFilters=function(){return this.urlFiltersManager.updateUrlWithFilters()},t.loadData=function(r){return this.dataLoader.loadData(r)},t.getCachedData=function(){return this.dataLoader.getCachedData()},t.setCachedData=function(r){return this.dataLoader.setCachedData(r)},t.startUpdateCheck=function(){return this.dataLoader.startUpdateCheckInternal()},t.checkForUpdates=function(){return this.dataLoader.checkForUpdates()},t.addToGoogleCalendar=function(r){return this.actionsManager.addToGoogleCalendar(r)},t.addToCalendar=function(r,o=null){return this.actionsManager.addToCalendar(r,o)},t.bulkAddToGoogleCalendar=function(){return this.actionsManager.bulkAddToGoogleCalendar()},t.exportAllToCalendar=function(){return this.actionsManager.exportAllToCalendar()},t.exportFavoritesToCalendar=function(){return this.actionsManager.exportFavoritesToCalendar()},t.shareCurrentView=function(){return this.actionsManager.shareCurrentView()},t.shareFavorites=function(){return this.actionsManager.shareFavorites()},t.sortTrainings=function(r){const s=this.$store?.ui?.sortBy||["wochentag","ort","uhrzeit","training"];return r.sort((e,n)=>{for(const a of s){let l=0;if(a==="wochentag"){const c=e.wochentag&&this.wochentagOrder[e.wochentag]||999,d=n.wochentag&&this.wochentagOrder[n.wochentag]||999;l=c-d}else if(a==="ort")l=(e.ort||"").localeCompare(n.ort||"");else if(a==="uhrzeit"){const c=C.zeitZuMinuten(e.von),d=C.zeitZuMinuten(n.von);l=c-d}else a==="training"&&(l=(e.training||"").localeCompare(n.training||""));if(l!==0)return l}return 0})},t.getTrainingColor=function(r){const o=(r||"").toLowerCase();return o.includes("parkour")?"training-badge badge-parkour":o.includes("trampolin")?"training-badge badge-trampolin":o.includes("tricking")?"training-badge badge-tricking":o.includes("movement")?"training-badge badge-movement":o.includes("fam")?"training-badge badge-fam":o.includes("flips")?"bg-red-100 text-red-800 border-red-200":o.includes("calistenics")||o.includes("calisthenics")?"bg-yellow-100 text-yellow-800 border-yellow-200":"bg-slate-100 text-slate-800 border-slate-200"},t.formatAlter=function(r){return C.formatAlter(r)},t.formatZeitrange=function(r,o){return C.formatZeitrange(r,o)},t.clearAllFilters=function(){const r=this;r.$store?.ui?.filters&&(r.$store.ui.filters={wochentag:[],ort:[],training:[],altersgruppe:[],searchTerm:"",activeQuickFilter:null,_customTimeFilter:"",_customFeatureFilter:"",_customLocationFilter:"",_customPersonalFilter:""}),this.applyFilters()},t.truncateText=function(r,o=30){return r.length<=o?r:r.substring(0,o)+"..."},t.removeCategoryFilter=function(r){const s=this.$store?.ui?.filters;s&&(["wochentag","ort","training","altersgruppe"].includes(r)?s[r]=[]:r==="search"?s.searchTerm="":r==="quickFilter"&&(s.activeQuickFilter=null),this.applyFilters())},t.getActiveFilterChips=function(){const o=this.$store?.ui?.filters;if(!o)return[];const s=[];if(Array.isArray(o.wochentag)&&o.wochentag.length>0&&o.wochentag.forEach(e=>{s.push({category:"wochentag",label:"Wochentag",value:e,remove:()=>this.removeFilterChip("wochentag",e),tooltip:`Klicken zum Entfernen: Wochentag - ${e}`,ariaLabel:`Wochentag ${e} entfernen`,prominent:!0,styleClass:"filter-chip-primary",minTouchTarget:44})}),Array.isArray(o.ort)&&o.ort.length>0&&o.ort.forEach(e=>{s.push({category:"ort",label:"Ort",value:e,remove:()=>this.removeFilterChip("ort",e),tooltip:`Klicken zum Entfernen: Ort - ${e}`,ariaLabel:`Ort ${e} entfernen`,prominent:!0,styleClass:"filter-chip-primary",minTouchTarget:44})}),Array.isArray(o.training)&&o.training.length>0&&o.training.forEach(e=>{s.push({category:"training",label:"Training",value:e,remove:()=>this.removeFilterChip("training",e),tooltip:`Klicken zum Entfernen: Training - ${e}`,ariaLabel:`Training ${e} entfernen`,prominent:!0,styleClass:"filter-chip-primary",minTouchTarget:44})}),Array.isArray(o.altersgruppe)&&o.altersgruppe.length>0&&o.altersgruppe.forEach(e=>{s.push({category:"altersgruppe",label:"Altersgruppe",value:e,remove:()=>this.removeFilterChip("altersgruppe",e),tooltip:`Klicken zum Entfernen: Altersgruppe - ${e}`,ariaLabel:`Altersgruppe ${e} entfernen`,prominent:!0,styleClass:"filter-chip-primary",minTouchTarget:44})}),o.searchTerm&&o.searchTerm.trim()!==""&&s.push({category:"search",label:"Suche",value:o.searchTerm,remove:()=>this.removeFilterChip("search",o.searchTerm),tooltip:`Klicken zum Entfernen: Suche - ${o.searchTerm}`,ariaLabel:`Suche ${o.searchTerm} entfernen`,prominent:!0,styleClass:"filter-chip-primary",minTouchTarget:44}),o.activeQuickFilter){const n={heute:"Heute",morgen:"Morgen",wochenende:"Wochenende",probetraining:"Probetraining",favoriten:"Favoriten","in-meiner-naehe":"In meiner Nähe"}[o.activeQuickFilter]||o.activeQuickFilter;s.push({category:"quickFilter",label:"Quick-Filter",value:n,remove:()=>this.removeFilterChip("quickFilter",o.activeQuickFilter),tooltip:`Klicken zum Entfernen: Quick-Filter - ${n}`,ariaLabel:`Quick-Filter ${n} entfernen`,prominent:!0,styleClass:"filter-chip-primary",minTouchTarget:44})}return s},t.getDisplayedFilterChips=function(){return this.getActiveFilterChips().slice(0,3)},t.getOverflowFilterCount=function(){const r=this.getActiveFilterChips();return Math.max(0,r.length-3)},t.getActiveFilterCount=function(){return this.getActiveFilterChips().length},t.removeFilterChip=function(r,o){const e=this.$store?.ui?.filters;e&&(["wochentag","ort","training","altersgruppe"].includes(r)?Array.isArray(e[r])&&(e[r]=e[r].filter(n=>n!==o)):r==="search"?e.searchTerm="":r==="quickFilter"&&(e.activeQuickFilter=null),this.applyFilters())},t.getResultsCount=function(){return this.filteredTrainings?.length||0},t.getResultsCountText=function(){const r=this.getResultsCount();return r===1?"1 Training gefunden":`${r} Trainings gefunden`},t.shouldShowFilterChips=function(){return this.getActiveFilterCount()>0},t.shouldClearButtonBeProminent=function(){return this.getActiveFilterCount()>=3},t.handleKeyboardShortcuts=function(r){const o=this;if((r.ctrlKey||r.metaKey)&&r.key==="f"&&window.matchMedia("(min-width: 1024px)").matches&&o.$store?.ui&&(r.preventDefault(),o.$store.ui.filterSidebarOpen=!o.$store.ui.filterSidebarOpen),r.key==="Escape"&&o.$store?.ui){if(o.$store.ui.activeView==="map"){o.$store.ui.activeView="list",r.preventDefault();return}if(o.$store.ui.mobileFilterOpen){o.$store.ui.mobileFilterOpen=!1,r.preventDefault();return}}},t.destroy=function(){this.updateCheckInterval&&clearInterval(this.updateCheckInterval),this.map&&this.mapManager.cleanupMap(),this.searchTimeout&&clearTimeout(this.searchTimeout)},t}const S=Object.freeze({DEBOUNCE_DELAY:50,MINIMUM_HEIGHT_CHANGE:5,MINIMUM_HEIGHT:400,MAXIMUM_HEIGHT:1e4,EXTRA_PADDING:40,SCROLL_THROTTLE:250,RESIZE_THROTTLE:100});let b={notifyTimeout:null,lastSentHeight:0,parentOrigin:null,resizeObserver:null,mutationObserver:null,isInitialized:!1,targetElement:null,eventListeners:[]};function St(){if(b.parentOrigin)return b.parentOrigin;const i=g;try{if(window.parent!==window)if(document.referrer){const t=new URL(document.referrer);b.parentOrigin=t.origin}else b.parentOrigin=i.iframe?.parentOrigin||"*"}catch(t){u("warn","[iframe-resize] Could not detect parent origin, using fallback",t),b.parentOrigin=i.iframe?.parentOrigin||"*"}return b.parentOrigin&&!le(b.parentOrigin)&&u("warn","[iframe-resize] Parent origin not in allowed list",{origin:b.parentOrigin}),b.parentOrigin||"*"}function le(i){const t=g;return t.iframe?.allowedOrigins?t.iframe.allowedOrigins.includes(i):!0}function Ft(){return ce()?window.innerHeight:At()}function ce(){const i=window;if(i.Alpine?.store)try{return i.Alpine.store("ui").mapView===!0}catch{}const t=document.querySelector('[x-show="$store.ui.mapView"]');return t?window.getComputedStyle(t).display!=="none":!1}function At(){const i=document.documentElement,t=document.body,r=document.querySelectorAll(".training-card, [data-training-card]");if(r.length>0){const e=r[r.length-1].getBoundingClientRect(),n=Math.ceil(e.bottom+window.scrollY);return Math.max(n+S.EXTRA_PADDING,i.scrollHeight,t.scrollHeight,S.MINIMUM_HEIGHT)}const o=document.querySelector("main, #app, [x-data], #trainings-container");if(o){const s=o.getBoundingClientRect();return Math.max(Math.ceil(s.bottom+window.scrollY+S.EXTRA_PADDING),S.MINIMUM_HEIGHT)}return Math.max(i.scrollHeight,t.scrollHeight,i.offsetHeight,t.offsetHeight,i.clientHeight,t.clientHeight,S.MINIMUM_HEIGHT)}function j(i=null){const t=g;window.parent!==window&&t.iframe?.enabled&&(b.notifyTimeout!==null&&clearTimeout(b.notifyTimeout),b.notifyTimeout=setTimeout(()=>{requestAnimationFrame(()=>{ue(i)})},S.DEBOUNCE_DELAY))}function ue(i=null){const t=Ft(),r=i||St();if(Math.abs(t-b.lastSentHeight)<S.MINIMUM_HEIGHT_CHANGE)return;const o=Math.max(S.MINIMUM_HEIGHT,Math.min(t,S.MAXIMUM_HEIGHT));try{const s={type:"resize",height:Math.round(o),timestamp:Date.now(),view:ce()?"map":"list",source:"fam-trainingsplan"};window.parent.postMessage(s,r),b.lastSentHeight=o,u("debug",`[iframe-resize] → ${o}px (${s.view})`,{origin:r})}catch(s){u("error","[iframe-resize] postMessage error",s)}}function Ot(i){if(!le(i.origin)){u("warn","[iframe-resize] Message from unknown origin",{origin:i.origin});return}i.data?.type==="init"&&(u("debug","[iframe-resize] Received init request"),setTimeout(()=>j(),100)),i.data?.type==="requestHeight"&&(u("debug","[iframe-resize] Received height request"),de())}function Et(i,t){const r=[],o=(n,a,l,c={})=>{n.addEventListener(a,l,c),r.push({element:n,event:a,handler:l})};o(window,"load",t),o(window,"resize",t,{passive:!0}),o(window,"orientationchange",t,{passive:!0}),document.fonts?.ready&&document.fonts.ready.then(t),window.Alpine&&(o(document,"alpine:init",t),o(document,"alpine:initialized",t),o(document,"alpine:updated",t));const e=q(t,S.SCROLL_THROTTLE);o(window,"scroll",e,{passive:!0}),o(window,"message",Ot),b.eventListeners=r,u("debug","[iframe-resize] Event listeners attached",{count:r.length})}function It(i,t){if(!window.ResizeObserver){u("warn","[iframe-resize] ResizeObserver not supported");return}try{b.resizeObserver=new ResizeObserver(t),b.resizeObserver.observe(i),b.resizeObserver.observe(document.body),u("debug","[iframe-resize] ResizeObserver attached")}catch(r){u("error","[iframe-resize] ResizeObserver setup failed",r)}}function Pt(i,t){if(!window.MutationObserver){u("warn","[iframe-resize] MutationObserver not supported");return}try{b.mutationObserver=new MutationObserver(t),b.mutationObserver.observe(i,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["style","class","x-show","x-if","hidden"]}),u("debug","[iframe-resize] MutationObserver attached")}catch(r){u("error","[iframe-resize] MutationObserver setup failed",r)}}function Z(i={}){if(b.isInitialized)return u("warn","[iframe-resize] Already initialized"),!1;const{parentOrigin:t=null,targetSelector:r="#trainings-container"}=i;t&&(b.parentOrigin=t);const o=document.querySelector(r)||document.querySelector("[x-data]")||document.querySelector("#app")||document.body;if(!o)return u("error","[iframe-resize] Target element not found"),!1;b.targetElement=o;const s=q(()=>j(),S.RESIZE_THROTTLE);It(o,s),Pt(o,s),Et(o,s),setTimeout(s,100),b.isInitialized=!0;const e=window;return e.notifyParentHeight=j,e.forceIframeResize=de,u("info","[iframe-resize] ✓ Initialized",{target:r,origin:b.parentOrigin}),!0}function de(){b.lastSentHeight=0,ue(),u("debug","[iframe-resize] Force resize triggered")}function $t(){if(window.self===window.top)return;const i=g;!i.iframe?.enabled||!i.iframe?.autoResize||(document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>{Z()}):Z())}$t();function Dt(){const i=document.activeElement;if(!i)return!1;const t=i.tagName;return["INPUT","TEXTAREA","SELECT"].includes(t)||i.hasAttribute("contenteditable")}function te(){const i=document.querySelector('input[type="search"], input[placeholder*="Suche"]');i&&i instanceof HTMLInputElement?(i.focus(),u("debug","Search input focused via keyboard shortcut")):u("warn","Search input not found")}function zt(i){const r=["Sonntag","Montag","Dienstag","Mittwoch","Donnerstag","Freitag","Samstag"][new Date().getDay()];i.filters.wochentag.includes(r)?i.showNotification(`${r} bereits gefiltert`,"info",2e3):(i.filters.wochentag.push(r),i.showNotification(`Filter: ${r}`,"success",2e3),u("info",`Today filter applied: ${r}`))}function Nt(i,t){const o={1:"Montag",2:"Dienstag",3:"Mittwoch",4:"Donnerstag",5:"Freitag",6:"Samstag",7:"Sonntag"}[i];if(!o){u("warn",`Invalid weekday number: ${i}`);return}const s=t.filters.wochentag,e=s.indexOf(o);e===-1?(s.push(o),t.showNotification(`Filter: ${o}`,"success",2e3),u("info",`Weekday filter added: ${o}`)):(s.splice(e,1),t.showNotification(`${o} entfernt`,"info",2e3),u("info",`Weekday filter removed: ${o}`))}function Ut(i){if(!i)return u("error","Alpine store not provided to keyboard shortcuts"),()=>{};const t=r=>{if((r.metaKey||r.ctrlKey)&&r.key==="k"){r.preventDefault(),te();return}if(!Dt()){if(r.key==="m"||r.key==="M"){r.preventDefault(),i.toggleMapView(),u("info","Map view toggled via keyboard shortcut (M)");return}if(r.key==="/"){r.preventDefault(),te();return}if(r.key==="h"||r.key==="H"){r.preventDefault(),zt(i);return}if(r.key>="1"&&r.key<="7"){r.preventDefault();const o=parseInt(r.key,10);Nt(o,i);return}}};return document.addEventListener("keydown",t),u("info","Keyboard shortcuts initialized (AUFGABE 12)",{shortcuts:["Cmd/Ctrl + K: Quick Search","M: Toggle Map","/: Focus Search","H: Today Filter","1-7: Weekday Filters"]}),()=>{document.removeEventListener("keydown",t),u("debug","Keyboard shortcuts cleaned up")}}window.L=Me;const V=window;function Gt(){w.plugin(pe),w.plugin(fe),w.plugin(me),w.plugin(ge),u("debug","Alpine plugins registered",{plugins:["collapse","focus","intersect","persist"]})}Gt();w.store("ui",{filterSidebarOpen:w.$persist(window.innerWidth>=1024).as("filterSidebarOpen"),sidebarCollapsed:w.$persist(!1).as("fam-trainingsplan-sidebar-collapsed"),mobileFilterOpen:!1,locationSettingsOpen:!1,mapView:!1,activeView:w.$persist("list").as("activeView"),darkMode:w.$persist(!1).as("darkMode"),showScrollTop:!1,viewMode:w.$persist("compact").as("viewMode"),groupingMode:w.$persist("wochentag").as("groupingMode"),sortBy:w.$persist(["wochentag","ort","uhrzeit","training"]).as("sortBy"),scrollDirection:"up",lastScrollY:0,manualLocationSet:w.$persist(!1).as("manualLocationSet"),manualLocation:w.$persist(null).as("manualLocation"),manualLocationAddress:w.$persist("").as("manualLocationAddress"),notification:null,notificationTimeout:null,filters:w.$persist({wochentag:[],ort:[],training:[],altersgruppe:[],searchTerm:"",activeQuickFilter:null,_customTimeFilter:"",_customFeatureFilter:"",_customLocationFilter:"",_customPersonalFilter:""}).as("trainingFilters"),setActiveView(i){["list","split","map","favorites"].includes(i)&&(this.activeView=i)},isActiveView(i){return this.activeView===i},toggleMapView(){const i=this.activeView==="map"?"list":"map";this.setActiveView(i),this.mapView=!this.mapView,this.$nextTick&&this.$nextTick(()=>{V.notifyParentHeight?.()})},showListView(){this.mapView=!1,this.$nextTick(()=>{V.notifyParentHeight?.()})},showNotification(i,t="info",r=3e3){clearTimeout(this.notificationTimeout),this.notification={message:i,type:t,show:!0},r>0&&(this.notificationTimeout=setTimeout(()=>{this.hideNotification()},r))},hideNotification(){this.notification&&(this.notification.show=!1,setTimeout(()=>{this.notification=null},300))},resetFilters(){this.filters={wochentag:[],ort:[],training:[],altersgruppe:[],searchTerm:"",activeQuickFilter:null,_customTimeFilter:"",_customFeatureFilter:"",_customLocationFilter:"",_customPersonalFilter:""}},clearAllFilters(){this.resetFilters()},hasActiveFilters(){const i=this.filters;return i.wochentag.length>0||i.ort.length>0||i.training.length>0||i.altersgruppe.length>0||i.probetraining||i.searchTerm!==""},getActiveFilterCount(){const i=this.filters;return i.wochentag.length+i.ort.length+i.training.length+i.altersgruppe.length+(i.probetraining?1:0)+(i.searchTerm?1:0)},toggleSidebar(){this.sidebarCollapsed=!this.sidebarCollapsed},updateScrollDirection(){const i=window.scrollY;this.scrollDirection=i>this.lastScrollY?"down":"up",this.lastScrollY=i}});w.store("filterOptions",{wochentage:[],orte:[],trainingsarten:[],altersgruppen:[]});function Rt(){try{const i=localStorage.getItem("trainingFilters");if(!i){u("debug","No stored filters found, skipping migration");return}const t=JSON.parse(i);if(!(typeof t.wochentag=="string"||typeof t.ort=="string"||typeof t.training=="string"||typeof t.altersgruppe=="string")){u("debug","Filters already in array format, skipping migration");return}const o={wochentag:t.wochentag?[t.wochentag]:[],ort:t.ort?[t.ort]:[],training:t.training?[t.training]:[],altersgruppe:t.altersgruppe?[t.altersgruppe]:[],searchTerm:t.searchTerm||"",activeQuickFilter:t.activeQuickFilter||null,_customTimeFilter:t._customTimeFilter||"",_customFeatureFilter:t._customFeatureFilter||"",_customLocationFilter:t._customLocationFilter||"",_customPersonalFilter:t._customPersonalFilter||""};localStorage.setItem("trainingFilters",JSON.stringify(o)),u("info","Successfully migrated filter format from strings to arrays",{before:{wochentag:typeof t.wochentag,ort:typeof t.ort,training:typeof t.training,altersgruppe:typeof t.altersgruppe},after:{wochentag:Array.isArray(o.wochentag),ort:Array.isArray(o.ort),training:Array.isArray(o.training),altersgruppe:Array.isArray(o.altersgruppe)}})}catch(i){u("error","Failed to migrate filter format",i)}}Rt();w.data("trainingsplaner",Tt);w.start();V.Alpine=w;u("info","Alpine.js initialized",{version:w.version});function Bt(){w.store("ui").darkMode?(document.documentElement.setAttribute("data-theme","dark"),u("info","Dark mode activated from stored preference")):(document.documentElement.setAttribute("data-theme","light"),u("info","Light mode activated"))}Bt();function Ht(){const i=w.store("ui");if(!i){u("error","Alpine UI store not available for keyboard shortcuts");return}Ut(i)}Ht();async function jt(){if(!g.pwa?.enabled){u("info","PWA disabled in config");return}if(!W().supportsServiceWorker){u("warn","Service Worker not supported");return}try{const{registerSW:t}=await Ce(async()=>{const{registerSW:o}=await import("./virtual_pwa-register.BD0sidaw.js");return{registerSW:o}},__vite__mapDeps([0,1,2,3])),r=t({immediate:!0,onNeedRefresh(){u("info","New content available"),g.pwa?.updateStrategy==="auto"?r(!0):Zt(r)},onOfflineReady(){u("info","App ready for offline use"),w.store("ui").showNotification("App bereit für Offline-Nutzung! 🎉","success",3e3)},onRegisteredSW(o,s){u("info","Service Worker registered",{url:o}),s&&g.pwa?.updateCheckInterval>0&&Vt(s)},onRegisterError(o){u("error","Service Worker registration failed",o)}});Wt(),u("info","PWA initialized successfully")}catch(t){u("error","PWA setup failed",t)}}function Zt(i){w.store("ui").showNotification("Neue Version verfügbar! Klicken zum Aktualisieren.","info",0);const t=r=>{r.target&&r.target.closest("[data-notification]")&&(i(!0),document.removeEventListener("click",t))};document.addEventListener("click",t)}function Vt(i){setInterval(()=>{i.update(),u("debug","Checking for updates...")},g.pwa?.updateCheckInterval||6e4)}function Wt(){const i=()=>{navigator.onLine?(w.store("ui").showNotification("Wieder online! 🌐","success",2e3),u("info","Online mode")):(w.store("ui").showNotification("Keine Internetverbindung - Offline-Modus aktiv","warning",5e3),u("warn","Offline mode"))};window.addEventListener("online",i),window.addEventListener("offline",i),navigator.onLine||i()}function qt(){if(!g.features?.enableTouchGestures||!W().isTouch)return;const i=g.ui?.touch||{};let t=0,r=0,o=0,s=!1;const e=l=>{t=l.touches[0].clientX,r=l.touches[0].clientY,o=Date.now(),window.scrollY===0&&r<100&&(s=!0)},n=l=>{if(!s)return;const d=l.touches[0].clientY-r;if(d>0){const h=document.getElementById("pull-refresh-indicator");h&&(h.style.opacity=Math.min(d/100,1).toString(),h.style.transform=`translateY(${Math.min(d/2,50)}px)`)}},a=l=>{const c=l.changedTouches[0].clientX,d=l.changedTouches[0].clientY,h=Date.now(),p=c-t,f=d-r,m=h-o,y=w.store("ui");if(s&&f>100&&m<1e3){u("info","Pull-to-refresh triggered"),y.showNotification("Aktualisiere Trainings...","info",2e3),setTimeout(()=>{window.location.reload()},500);const x=document.getElementById("pull-refresh-indicator");x&&(x.style.opacity="0",x.style.transform="translateY(0)"),s=!1;return}if(s){const x=document.getElementById("pull-refresh-indicator");x&&(x.style.opacity="0",x.style.transform="translateY(0)"),s=!1}const M=Math.abs(p)>Math.abs(f)&&m<i.swipeMaxTime,v=Math.abs(p)/m;if(!M||v<i.swipeVelocity)return;if(t>80&&t<window.innerWidth-80&&Math.abs(p)>i.swipeThreshold){const x=y.activeView;if(p<-i.swipeThreshold){const T={list:"map",map:"favorites",favorites:"list"}[x]||"list";y.setActiveView(T),u("info",`Swipe left - switching to ${T} view`);return}if(p>i.swipeThreshold){const T={list:"favorites",map:"list",favorites:"map"}[x]||"list";y.setActiveView(T),u("info",`Swipe right - switching to ${T} view`);return}}if(p<-i.swipeThreshold&&t>window.innerWidth-50){(y.filterSidebarOpen||y.mobileFilterOpen)&&(y.filterSidebarOpen=!1,y.mobileFilterOpen=!1,u("debug","Swipe left from edge - closing filter"));return}if(p>i.swipeThreshold&&t<50){window.innerWidth<(g.ui?.mobileBreakpoint||768)?y.mobileFilterOpen=!0:y.filterSidebarOpen=!0,u("debug","Swipe right from edge - opening filter");return}};document.addEventListener("touchstart",e,{passive:!0}),document.addEventListener("touchmove",n,{passive:!0}),document.addEventListener("touchend",a,{passive:!0}),u("info","Touch gestures initialized (AUFGABE 10: View switching + Pull-to-refresh)")}function Kt(){g.iframe?.enabled&&(Z({parentOrigin:g.iframe?.parentOrigin||"*",targetSelector:"#trainings-container"}),u("info","Iframe auto-resize initialized"))}function Qt(){if(!(!g.logging?.enabled||!("PerformanceObserver"in window)))try{new PerformanceObserver(t=>{t.getEntries().forEach(r=>{if(r.entryType==="navigation"){const o=r;u("debug","Page Load Performance",{dns:Math.round(o.domainLookupEnd-o.domainLookupStart),tcp:Math.round(o.connectEnd-o.connectStart),ttfb:Math.round(o.responseStart-o.requestStart),download:Math.round(o.responseEnd-o.responseStart),domInteractive:Math.round(o.domInteractive),domComplete:Math.round(o.domComplete),loadComplete:Math.round(o.loadEventEnd)})}})}).observe({entryTypes:["navigation"]})}catch(i){u("warn","Performance monitoring failed",i)}}window.addEventListener("error",i=>{u("error","Global Error",{message:i.message,filename:i.filename,lineno:i.lineno,colno:i.colno,error:i.error}),g.errors?.showUserFriendlyMessages&&w.store("ui").showNotification("Ein Fehler ist aufgetreten. Bitte Seite neu laden.","error",5e3)});window.addEventListener("unhandledrejection",i=>{u("error","Unhandled Promise Rejection",i.reason),g.errors?.showUserFriendlyMessages&&w.store("ui").showNotification("Ein Fehler ist aufgetreten. Bitte versuchen Sie es erneut.","error",5e3)});document.addEventListener("visibilitychange",()=>{document.hidden?u("debug","Page hidden - pausing updates"):u("debug","Page visible - resuming updates")});async function Yt(){try{await Promise.all([jt(),Promise.resolve(qt()),Promise.resolve(Kt())]),Qt(),u("info","🚀 App initialized",{version:g.pwa?.version||"1.0.0",env:"production",browser:W(),features:Object.entries(g.features||{}).filter(([,i])=>i).map(([i])=>i)})}catch(i){u("error","App initialization failed",i)}}Yt();export{Ce as _};
